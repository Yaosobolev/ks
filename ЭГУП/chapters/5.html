<HTML>
    <HEAD>
    <TITLE>Сетевой уровень стека TCP/IP. Протокол IP</TITLE>
    <link href="../css/style.css" rel="stylesheet" type="text/css">
    </HEAD>
<BODY>
<p class="main-title">5 Сетевой уровень стека TCP/IP. Протокол IP</p>
<a name="ch1"></a>
<p class="title">5.1 Назначение протокола IP</p>
<p>Для обмена данными в Интернете узлам необходимо программное обеспечение межсетевого протокола (IP). IP-протокол представляет собой одну из групп протоколов, которые совместно именуются TCP/IP (протокол управления передачей / межсетевой протокол). Межсетевой протокол (IP) передает данные в виде пакетов. Независимо от того, играете ли вы в видеоигру в Интернете, общаетесь с другом, отправляете электронную почту или ищете информацию, отправленные или полученные данные передаются в виде IP-пакетов.</p>
<p>В каждом IP-пакете должен быть достоверный IP-адрес источника и назначения. Без достоверной информации об адресе отправленные пакеты не попадут к узлу назначения. К источнику возвращенные пакеты не вернутся.</p>
<p>IP определяет структуру IP-адресов источника и назначения. Протокол определяет метод использования этих адресов при маршрутизации пакетов от одного узла или сети в другой (ую).</p>
<p>Все используемые в Интернете протоколы, в том числе и IP, описаны в нумерованных стандартах, которые называются документами RFC. Запрос комментариев (RFC) – серия документов (стандартов, инструкций, отчетов рабочих групп и т.д.), определяющих “устройство” и функционирование сети Интернет. Чем больше число, тем актуальнее запрос комментариев. Запросы комментариев отсылаются IETF и проходят процесс проверки. После проверки они проходят следующие стадии: предложение (начальный уровень), проект (начальное испытание), стандарт (полностью утвержден) [5].</p>
<center><img src="./img/chapter5/5.1.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.1 – Взаимодействие в сети Интернет</center>
<p>В начале IP-пакета стоит заголовок (управляющая информация, следующая перед данными при их инкапсуляции для передачи по сети) с IP-адресами источника и назначения. Кроме того, там находится контрольная информация с описанием пакета, предназначенная для сетевых устройств, например, маршрутизатором. Кроме того, она помогает контролировать поведение пакета в сети. Иногда IP-пакет называют датаграммой (логический блок информации, передаваемый по сетевому уровню передающей среды без предварительного установления виртуального канала. Датаграммы IP лежат в основе обмена информацией в Интернете).</p>
<p>В Интернете используются только уникальные IP-адреса. Существуют организации, которые контролируют распределение IP-адресов и не допускают дублирования. Поставщики услуг Интернета получают блоки IP-адресов от локального, национального или регионального интернет-регистратора (RIR). Поставщик услуг Интернета распоряжается этими адресами и предоставляет их конечным пользователям.</p>
<p>IP-конфигурацию домашних и корпоративных компьютеров определяют поставщики услуг Интернета. Обычно это происходит автоматически, когда пользователь подключается к поставщику услуг Интернета и получает доступ в Интернет.</p>
<center><img src="./img/chapter5/5.2.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.2 – Передача данных с помощью протокола IP. Часть 1</center>
<center><img src="./img/chapter5/5.3.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.3 – Передача данных с помощью протокола IP. Часть 2</center>
<center><img src="./img/chapter5/5.4.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.4 – Передача данных с помощью протокола IP. Часть 3</center>


<p>Для обмена данными в Интернете узлу необходим IP-адрес. Это логический сетевой адрес конкретного узла. Для обмена данными с другими устройствами, подключенными к Интернету, необходим правильно настроенный, уникальный IP-адрес.</p>
<p>IP-адрес присваивается сетевому интерфейсу узла. Обычно это сетевая интерфейсная плата (NIC), установленная в устройстве. Примерами пользовательских устройств с сетевыми интерфейсами могут служить рабочие станции, серверы, сетевые принтеры и IP-телефоны. Иногда в серверах устанавливают несколько NIC, у каждой из которых есть свой IP-адрес. У интерфейсов маршрутизатора, обеспечивающего связь с сетью IP, также есть IP-адрес.</p>
<p>В каждом отправленном по сети пакете есть IP-адрес источника и назначения. Эта информация необходима сетевым устройствам для передачи информации по назначению и передачи источнику ответа.</p>
<center><img src="./img/chapter5/5.5.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.5 – Маршрут пакетов в Интернете. Часть 1</center>
<center><img src="./img/chapter5/5.5.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.6 – Маршрут пакетов в Интернете. Часть 2</center>
<center><img src="./img/chapter5/5.7.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.7 – Маршрут пакетов в Интернете. Часть 3</center>
<center><img src="./img/chapter5/5.8.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.8 – Маршрут пакетов в Интернете. Часть 4</center>

<a name="ch2"></a>
<p class="title">5.2 Структура IP-адреса</p>
<p>IP-адрес представляет собой серию из 32 двоичных бит (единиц и нулей). Человеку прочесть двоичный IP-адрес очень сложно. Поэтому 32 бита группируются по четыре 8-битных байта, в так называемые октеты. Читать, записывать и запоминать IP-адреса в таком формате людям сложно. Чтобы облегчить понимание, каждый октет IP-адреса представлен в виде своего десятичного значения. Октеты разделяются десятичной точкой или запятой. Это называется точечно-десятичной нотацией.</p>
<p>При настройке IP-адрес узла вводится в виде десятичного числа с точками, например, 192.168.1.5. Вообразите, что вам пришлось бы вводить 32-битный двоичный эквивалент адреса &#8212; 11000000101010000000000100000101. Если ошибиться хотя бы в одном бите, получится другой адрес, и узел, возможно, не сможет работать в сети.</p>
<p>Структура 32-битного IP-адреса определяется межсетевым протоколом 4-ой версии (IPv4) (межсетевой протокол четвертой версии). На данный момент это один из самых распространенных в Интернете типов IP-адресов. По 32-битной схеме адресации можно создать более 4 миллиардов IP-адресов.</p>
<center><img src="./img/chapter5/5.9.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.9 – Настройка протокола IP</center>
<p>Получая IP-адрес, узел просматривает все 32 бита по мере поступления на сетевой адаптер. Напротив, людям приходится преобразовывать эти 32 бита в десятичные эквиваленты, то есть в четыре октета. Каждый октет состоит из 8 бит, каждый бит имеет значение. У четырех групп из 8 бит есть один и тот же набор значений. Значение крайнего правого бита в октете – 1, значения остальных, слева направо – 2, 4, 8, 16, 32, 64 и 128.</p>
<p>Чтобы определить значение октета, нужно сложить значения позиций, где присутствует двоичная единица.</p>
<ul>
<li>Нулевые позиции в сложении не участвуют.</li>
<li>Если все 8 бит имеют значение 0, 00000000, то значение октета равно 0.</li>
<li>Если все 8 бит имеют значение 1, 11111111, значение октета – 255 (128+64+32+16+8+4+2+1).</li>
<li>Если значения 8 бит отличаются, например, 00100111, значение октета – 39 (32+4+2+1).</li>
</ul>
<p>Таким образом, значение каждого из четырех октетов находится в диапазоне от 0 до 255.</p>
<center><img src="./img/chapter5/5.10.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.10 – Преобразование IP-адреса. Часть 1</center>
<center><img src="./img/chapter5/5.11.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.11 – Преобразование IP-адреса. Часть 2</center>
<center><img src="./img/chapter5/5.12.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.12 – Преобразование IP-адреса. Часть 3</center>
<center><img src="./img/chapter5/5.13.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.13 – Преобразование IP-адреса. Часть 4</center>

<p>Логический 32-битный IP-адрес представляет собой иерархическую систему и состоит из двух частей. Первая идентифицирует сеть, вторая &#8212; узел в сети. Обе части являются обязательными.</p>
<p>Например, если IP-адрес узла – 192.168.18.57, то первые три октета (192.168.18) представляют собой сетевую часть адреса, а последний октет (.57) является идентификатором узла. Такая система называется иерархической адресацией, поскольку сетевая часть идентифицирует сеть, в которой находятся все уникальные адреса узлов. Маршрутизаторам нужно знать только путь к каждой сети, а не расположение отдельных узлов.</p>
<p>Другой пример иерархической сети – это телефонная сеть. В телефонном номере код страны, региона и станции составляют адрес сети, а оставшиеся цифры &#8212; локальный номер телефона[7].</p>
<center><img src="./img/chapter5/5.14.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.14 – Компоненты IP-адреса</center>
<p>При IP-адресации в одной физической сети могут существовать несколько логических сетей, если сетевая часть адреса их узла отличается. Пример. Три узла в одной физической локальной сети имеют одинаковую сетевую часть в своем IP-адресе (192.168.50), а три других узла – другую сетевую часть (192.168.70). Три узла с одной сетевой частью в своих IP-адресах имеют возможность обмениваться данными друг с другом, но не могут обмениваться информацией с другими узлами без использования маршрутизации. В данном случае  имеем одну физическую сеть и две логические IP-сети.</p>


<a name="ch3"></a>
<p class="title">5.3 Взаимодействие IP-адресов и масок подсети</p>
<a name="ch3.1"></a>
<p class="title">5.3.1 Назначение масок подсети</p>
<p>Каждый IP-адрес состоит из двух частей. Как узлы определяют, где сетевая часть, а где адрес узла? Для этого используется маска подсети.</p>
<p>При настройке IP узлу присваивается не только IP-адрес, но и маска подсети. Как и IP-адрес, маска состоит из 32 бит. Она определяет, какая часть IP-адреса относится к сети, а какая – к узлу.</p>
<p>Маска сравнивается с IP-адресом побитно, слева направо. В маске подсети единицы соответствуют сетевой части, а нули &#8212; адресу узла. В приведенном примере первые три октета представляют собой адрес сети, а последний &#8212; адрес узла.</p>
<p>Отправляя пакет, узел сравнивает маску подсети со своим IP-адресом и адресом назначения. Если биты сетевой части совпадают, значит, узлы источника и назначения находятся в одной и той же сети, и пакет доставляется локально. Если нет, отправляющий узел передает пакет на интерфейс локального маршрутизатора для отправки в другую сеть.</p>
<center><img src="./img/chapter5/5.15.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.15 – Определение с помощью масок принадлежность к подсети. Часть 1</center>
<center><img src="./img/chapter5/5.15.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.16 – Определение с помощью масок принадлежность к подсети. Часть 2</center>
<center><img src="./img/chapter5/5.17.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.17 – Определение с помощью масок принадлежность к подсети. Часть 3</center>
<center><img src="./img/chapter5/5.18.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.18 – Определение с помощью масок принадлежность к подсети. Часть 4</center>

<p>В домашних офисах и небольших компаниях чаще всего встречаются следующие маски подсети: 255.0.0.0 (8 бит), 255.255.0.0 (16 бит) и 255.255.255.0 (24 бита). В маске подсети 255.255.255.0 (десятичный вариант), или 11111111.11111111.1111111.00000000 (двоичный вариант) 24 бита идентифицируют сеть, а 8 &#8212; узлы в сети.</p>
<p>Чтобы вычислить количество возможных сетевых узлов, нужно взять количество отведенных для них бит в степени 2 (2 ^ 8 = 256). Из полученного результата необходимо вычесть 2 (256-2). Дело в том, что состоящая из одних единиц (1) отведенная узлам часть IP-адреса предназначена для адреса широковещательной рассылки и не может принадлежать одному узлу. Часть, состоящая только из нулей, является идентификатором сети и тоже не может быть присвоена конкретному узлу. Возвести число 2 в степень без труда можно с помощью калькулятора, который есть в любой операционной системе Windows.</p>
<p>Иначе допустимое количество узлов можно определить, сложив значения доступных бит (128+64+32+16+8+4+2+1 = 255). Из полученного значения необходимо вычесть 1 (255-1 = 254), поскольку значение всех бит отведенной для узлов части не может равняться 1. 2 вычитать не нужно, поскольку сумма нулей равна нулю и в сложении не участвует.</p>
<p>В 16-битной маске для адресов узлов отводится 16 бит (два октета), и в одном из них все значения могут быть равны 1 (255). Это может быть и адрес широковещательной рассылки, но если другой октет не состоит из одних единиц, адрес можно использовать для узла. Не забывайте, что узел проверяет значения всех бит, а не значения одного октета.</p>
<center><img src="./img/chapter5/5.19.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.19 – Пространство IP-адресов</center>
<a name="ch3.2"></a>
<p class="title">5.3.2 Классы IP-адресов и маски подсети по умолчанию</p>
<p>IP-адрес и маска подсети совместно определяют то, какая часть IP-адреса является сетевой, а какая &#8212; соответствует адресу узла.</p>
<p>IP-адреса делятся на 5 классов. К классам A, B и C относятся коммерческие адреса, присваиваемые узлам. Класс D (адрес класса D состоит из 4 октетов. Первый октет имеет значение от 224 до 239. Класс  D используется для многоадресных рассылок) зарезервирован для многоадресных рассылок, а класс E (адрес класса Е состоит из 4 октетов. Первый октет имеет значение от 240 до 255. IP-адреса класса Е относятся к зарезервированным) – для экспериментов.</p>
<p>В адресах класса C (адрес класса С состоит из четырех октетов. Первый октет имеет значение от 192 до 223. Первые три октета идентифицируют сеть. Последний октет определяет адреса узлов. Сеть класса С может содержать 2097 152 подсети и 254 узла) сетевая часть состоит из трех октетов, а адрес узла – из одного. Выбранная по умолчанию маска подсети состоит из 24 бит (255.255.255.0). Адреса класса C обычно присваиваются небольшим сетям.</p>
<p>В адресах класса B (адрес класса В состоит из четырех октетов. Первый октет имеет значение от 128 до 191. Первые два октета идентифицируют сеть. Последние два октета определяют адреса узлов. Сеть класса В может содержать 16384 подсетей и 65534 узла) сетевая часть и адрес узла состоят из двух октетов. Выбранная по умолчанию маска подсети состоит из 16 бит (255.255.0.0). Обычно эти адреса используются в сетях среднего размера.</p>
<p>В адресах класса A (адрес класса состоит из четырех октетов. Первый октет имеет значение от 1 до 127. Три остальных октета определяют адреса узлов. Сеть класса А может содержать 16777214 узлов) сетевая часть состоит всего из одного октета, остальные отведены узлам. Выбранная по умолчанию маска подсети состоит из 8 бит (255.0.0.0). Обычно такие адреса присваиваются крупным организациям.</p>
<p>Класс адреса можно определить по значению первого октета. Например, если значение первого октета IP-адреса находится в диапазоне от 192 до 223, то это адрес класса C. Например, адрес 200.14.193.67 относится к классу С.</p>
<p>Все адреса, состоящие только из нулей (0) или единиц (1) – недействительные адреса узлов.</p>
<center><img src="./img/chapter5/5.20.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.20 – Классы IP-адресов</center>


<a name="ch4"></a>
<p class="title">5.4 Публичные и частные IP-адреса </p>
<p>Всем узлам, подключенным непосредственно к Интернету, необходим уникальный публичный IP-адрес (все IP-адреса, кроме зарезервированных частных адресов). Поскольку количество 32-битных адресов конечно, существует риск, что их не хватит. В качестве одного из решений было предложено зарезервировать некоторое количество частных адресов для использования только внутри организации. В этом случае внутренние узлы смогут обмениваться данными друг с другом без использования уникальных публичных IP-адресов.</p>
<p>В соответствии со стандартом RFC 1918 (запрос комментариев. Серия документов, основным назначением которых является распространение информации об Интернете. Большинство документов RFC представляют собой спецификации протоколов, например Telnet и протокола передачи файлов (FTP), но некоторые из них содержат профессиональный юмор или имеют историческое значение. Документы RFC доступны в онлайне из нескольких источников) было зарезервировано несколько диапазонов адресов класса A, B и C. Как видно из таблицы, в диапазон частных адресов входит одна сеть класса A, 16 сетей класса B и 256 сетей класса C. Таким образом, сетевые администраторы получили определенную степень свободы в плане предоставления внутренних адресов.</p>
<p>В очень большой сети можно использовать частную сеть класса A, где можно создать более 16 миллионов частных адресов.</p>
<p>В сетях среднего размера можно использовать частную сеть класса B с более чем 65 000 адресов.</p>
<p>В домашних и небольших коммерческих сетях обычно используется один частный адрес класса C, рассчитанный на 254 узла.</p>
<p>Одну сеть класса A, 16 сетей класса B или 256 сетей класса C могут использовать организации любого размера. Многие организации пользуются частной сетью класса A.</p>
<p>Частные адреса доступны в корпоративных сетях для всех пользователей, поскольку частные адреса маршрутизируются внутри сети и никогда не отображаются в сети Интернет.</p>
<p>Использование пространства частных адресов регулируется RFC 1918.</p>
<ul>
<li>Класс A: 10.0.0.0 &#8212; 10.255.255.255.</li>
<li>Класс B: 172.15.0.0 &#8212; 172.31.255.255.</li>
<li>Класс C: 192.168.0.0 &#8212; 192.168.255.255</li>
</ul>
<center><img src="./img/chapter5/5.21.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.21 – Диапазон частных IP-адресов</center>
<center><img src="./img/chapter5/5.22.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.22 – Пространство частных адресов</center>
<p>Узлы из внутренней сети организации могут использовать частные адреса до тех пор, пока им не понадобится прямой выход в Интернет. Соответственно, один и тот же набор адресов подходит для нескольких организаций. Частные адреса не маршрутизируются в Интернете и быстро блокируются маршрутизатором поставщика услуг Интернета.</p>
<p>Частные адреса можно использовать как меру безопасности, поскольку они видны только в локальной сети, а посторонние получить прямой доступ к этим адресам не могут.</p>
<p>Кроме того, существуют частные адреса для диагностики устройств. Они называются адресами обратной связи. Для таких адресов зарезервирована сеть 127.0.0.0 класса А.</p>
<center><img src="./img/chapter5/5.23.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.23 – Ограничение пакетов с частными адресами маршрутизаторы сети Интернет. Часть 1</center>
<center><img src="./img/chapter5/5.24.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.24 – Ограничение пакетов с частными адресами маршрутизаторы сети Интернет. Часть 2</center>

<p>Использование частных адресов имеет три преимущества:</p>
<ul>
<li>они позволяют снизить высокие затраты, связанные с приобретением публичных адресов для каждого узла;</li>
<li>они позволяют тысячам внутренних сотрудников использовать несколько публичных адресов;</li>
<li>они обеспечивают необходимый уровень безопасности, поскольку пользователи других сетей и организаций не могут видеть внутренние адреса.</li>
</ul>


<a name="ch5"></a>
<p class="title">5.5 Адреса одноадресных, широковещательных и многоадресных рассылок</p>
<p>Помимо классов, IP-адреса делятся на категории, предназначенные для одноадресных, широковещательных или многоадресных рассылок. С помощью IP-адресов узлы могут обмениваться данными в режиме “один к одному” (одноадресная рассылка), “один ко многим” (многоадресная рассылка) или “один ко всем” (широковещательная рассылка).</p>
<p>1) Одноадресная рассылка. Адрес одноадресной рассылки чаще всего встречается в сети IP. Пакет с одноадресным назначением предназначен конкретному узлу. Пример: узел с IP-адресом 192.168.1.5 (источник) запрашивает веб-страницу с сервера с IP-адресом 192.168.1.200 (адресат).</p>
<p>Для отправки и приема одноадресного пакета в заголовке IP-пакета должен указываться IP-адрес назначения. Кроме того, в заголовке кадра Ethernet должен быть MAC-адрес назначения. IP-адрес и MAC-адрес &#8212; это данные для доставки пакета одному узлу.</p>
<center><img src="./img/chapter5/5.25.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.25 – Одноадресная рассылка. Часть 1</center>
<center><img src="./img/chapter5/5.25.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.26 – Одноадресная рассылка. Часть 2</center>
<center><img src="./img/chapter5/5.27.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.27 – Одноадресная рассылка. Часть 3</center>


<p>2) Широковещательная рассылка. В пакете широковещательной рассылки содержится IP-адрес назначения, в узловой части которого присутствуют только единицы (1). Это означает, что пакет получат и обработают все узлы в локальной сети (домене широковещательной рассылки). Широковещательные рассылки предусмотрены во многих сетевых протоколах, например ARP и DHCP (протокол динамической настройки узлов, предназначенный для запроса и присвоения IP-адреса, адреса основного шлюза и адреса DNS-сервера сетевому узлу).</p>
<p>В сети класса C 192.168.1.0 с маской подсети по умолчанию 255.255.255.0 используется адрес широковещательной рассылки 192.168.1.255. Узловая часть – 255 или двоичное 11111111 (все единицы).</p>
<p>В сети класса B 172.15.0.0 с маской подсети по умолчанию 255.255.0.0 используется адрес широковещательной рассылки 172.15.255.255.</p>
<p>В сети класса A 10.0.0.0 с маской подсети по умолчанию 255.0.0.0 используется адрес широковещательной рассылки 10.255.255.255.</p>
<p>Для сетевого IP-адреса широковещательной рассылки нужен соответствующий MAC-адрес в кадре Ethernet. В сетях Ethernet используется MAC-адрес широковещательной рассылки из 48 единиц, который в шестнадцатеричном формате выглядит как FF-FF-FF-FF-FF-FF [11].</p>
<center><img src="./img/chapter5/5.28.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.28 – Широковещательная рассылка. Часть 1</center>
<center><img src="./img/chapter5/5.29.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.29 – Широковещательная рассылка. Часть 2</center>
<center><img src="./img/chapter5/5.30.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.30 – Широковещательная рассылка. Часть 3</center>

<p>3) Многоадресная рассылка. Адреса многоадресных рассылок позволяют исходному устройству рассылать пакет группе устройств.</p>
<p>Устройства, относящиеся к многоадресной группе, получают ее IP-адрес. Диапазон таких адресов &#8212; от 224.0.0.0 до 239.255.255.255. Поскольку адреса многоадресных рассылок соответствуют группам адресов (которые иногда называются группами узлов), они используются только как адресаты пакета. У источника всегда одноадресный адрес.</p>
<p>Адреса многоадресных рассылок используются, например, в дистанционных играх, в которых участвует несколько человек из разных мест. Другой пример &#8212; это дистанционное обучение в режиме видеоконференции, где несколько учащихся подключаются к одному и тому же курсу.</p>
<p>Как и одноадресным или широковещательным адресам, IP-адресам многоадресной рассылки нужен соответствующий MAC-адрес, позволяющий доставлять кадры в локальной сети. MAC-адрес многоадресной рассылки &#8212; это особое значение, которое в шестнадцатеричном формате начинается с 01-00-5E. Нижние 23 бита IP-адреса многоадресной группы преобразуются в остальные 6 шестнадцатеричных символов адреса Ethernet. Пример (см. рисунок) &#8212; шестнадцатеричное значение 01-00-5E-0F-64-C5. Каждому шестнадцатеричному символу соответствует 4 двоичных бита.</p>
<center><img src="./img/chapter5/5.31.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.31– Многоадресная рассылка. Часть 1</center>
<center><img src="./img/chapter5/5.32.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.32 – Многоадресная рассылка. Часть 2</center>
<center><img src="./img/chapter5/5.33.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.33 – Многоадресная рассылка. Часть 3</center>


<a name="ch6"></a>
<p class="title">5.6 Присвоение статических и динамических адресов</p>
<p>IP-адреса можно присваивать статически или динамически.</p>
<p>1)  Статический адрес. Используя статический адрес, сетевой администратор может вручную настраивать сетевые данные узла. Как минимум, это будет IP-адрес, маска подсети и основной шлюз.</p>
<p>У статических адресов есть несколько преимуществ. Например, их полезно присваивать принтерам, серверам и другим сетевым устройствам, которые всегда должны быть доступны сетевым клиентам. Узлы будут не способны достигать сервера, если его обычный IP-адрес изменился.</p>
<p>Статическое присвоение адресов усиливает контроль над сетевыми ресурсами, но ввод информации для каждого узла отнимает много времени. При статическом вводе узел выполняет только базовый поиск ошибок в IP-адресе. Соответственно, риск возникновения ошибки больше.</p>
<p>При использовании статической IP-адресации важно вести точный перечень адресов и устройств, которым они присвоены. Кроме того, обычно эти постоянные адреса повторно не используются.</p>
<center><img src="./img/chapter5/5.34.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.34 – Статическое присвоение IP-адреса</center>
<p>2)  Динамические адреса. Список пользователей локальной сети часто меняется. Появляются новые пользователи с ноутбуками, которые нужно подключить. Другие устанавливают новые рабочие станции. Чтобы каждой станции не приходилось вручную присваивать IP-адреса, проще всего это сделать автоматически. Для этого используется протокол под названием Dynamic Host Configuration Protocol (DHCP).</p>
<p>DHCP предусматривает механизм автоматического присвоения информации об адресе, например, IP-адреса, маски подсети, основного шлюза и других настроек.</p>
<p>Это наиболее предпочтительный способ присвоения IP-адресов узлам в большой сети, поскольку он облегчает работу специалистов службы поддержки и практически устраняет возможность ошибки.</p>
<p>Другое преимущества DHCP состоит в том, что адреса присваиваются узлам временно. Если узел выключается или уходит из сети, его адрес возвращается в пул для повторного использования. Это особенно полезно для мобильных пользователей, которые то подключаются, то отключаются.</p>
<center><img src="./img/chapter5/5.35.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.35 – Динамическое присвоение IP-адреса</center>
<a name="ch5.1"></a>
<p class="title">5.5.1 Серверы DHCP</p>
<p>Когда вы подключаетесь к беспроводной сети в аэропорту или магазине, доступ в Интернет обеспечивает DHCP. При входе в зону связи установленный на портативном компьютере клиент DHCP связывается с локальным сервером DHCP (протокол динамической настройки узлов (DHCP) представляет собой набор правил для динамического присвоения IP-адресов сетевым устройствам. DCHP-сервер осуществляет управление IP-адресам, присваивает их устройствам и контролирует их конфиценциальность) через беспроводное соединение. Сервер DHCP присваивает ноутбуку IP-адрес.</p>
<p>В качестве серверов DHCP могут выступать самые разные типы устройств при условии, что на них установлено служебное ПО DHCP. В большинстве средних и крупных сетей сервер DHCP – это локальный выделенный сервер на базе ПК.</p>
<p>В домашних сетях он обычно находится у поставщика услуг Интернета. Узел из домашней сети получает настройки IP непосредственно от поставщика услуг Интернета.</p>
<p>Во многих домашних сетях и сетях малых предприятий для подключения к модему поставщика услуг Интернета используется интегрированный маршрутизатор. В данном случае он выступает в качестве клиента и сервера DHCP. В качестве клиента он получает настройки IP от поставщика услуг Интернета, а затем, уже как сервер DHCP, передает их внутренним узлам локальной сети.</p>
<p>Помимо серверов на базе ПК и интегрированных маршрутизаторов, услуги DHCP могут предоставлять клиентам и другие сетевые устройства, например, назначенные маршрутизаторы. Такое встречается реже.</p>
<center><img src="./img/chapter5/5.35.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.36 &#8212; Серверы DHCP</center>
<a name="ch5.2"></a>
<p class="title">5.5.2 Настройка DHCP</p>
<p>При первой настройке в качестве клиента DHCP у узла нет IP-адреса, маски подсети и основного шлюза. Он получает эти данные от сервера DHCP, локального или принадлежащего поставщику услуг Интернета. На сервере DHCP настраивается диапазон, или пул, IP-адресов, которые можно присвоить клиентам DHCP.</p>
<p>Клиент, которому нужен IP-адрес, посылает сообщение о поиске DHCP в виде широковещательной рассылки с IP-адресом назначения 255.255.255.255 (32 единицы) и MAC-адресом назначения FF-FF-FF-FF-FF-FF (48 единиц). Кадр DHCP получат все узлы в сети, но ответит только сервер DHCP. Он отправляет источнику предложенный IP-адрес клиента. Узел в ответ посылает на указанный сервер запрос DHCP с подтверждением использования IP-адреса. Сервер присылает подтверждение.</p>
<p>Сервер DHCP может находиться в другой сети. ВРСЗ клиенты все же имеют возможность получить IP-адреса, если промежуточные маршрутизаторы сконфигурированы на пересылку DHCP-запросов.</p>
<center><img src="./img/chapter5/5.37.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.37 – Работа протокола DHCP</center>
<p>В большинстве домашних сетей и сетей малых предприятий услуги DHCP локальным сетевым клиентам предоставляет многофункциональное устройство. Для настройки беспроводного маршрутизатора Linksys нужно войти в веб-интерфейс: открыть обозреватель и ввести в поле “Address” IP-адрес маршрутизатора по умолчанию: 192.168.1.1. Открыть окно настройки DHCP.</p>
<p>IP-адрес 192.168.1.1 и маска подсети 255.255.255.0 выбраны для интерфейса интегрированного маршрутизатора по умолчанию. Это основной шлюз для всех узлов в локальной сети и IP-адрес встроенного сервера DHCP. По умолчанию у большинства беспроводных маршрутизаторов и других домашних интегрированных маршрутизаторов сервер DHCP включен.</p>
<p>В окне настройки DHCP можно выбрать диапазон DHCP (диапазон адресов протокола динамической настройки узлов. Непрерывный список IP-адресов в пуле DHCP) по умолчанию или указать начальный адрес диапазона DHCP (не использовать 192.168.1.1) и количество присваиваемых адресов. Кроме того, можно изменить время выделения (по умолчанию 24 часа). Функция настройки DHCP у большинства поставщиков услуг Интернета предоставляет информацию о подключенных узлах и IP-адресах, соответствующих MAC-адресах и времени выделения.</p>
<p>В таблице клиентов DHCP отображается имя клиента и тип подключения (LAN Ethernet или беспроводная связь).</p>
<center><img src="./img/chapter5/5.38.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.38 -  Настройка DHCP</center>
<a name="ch5.3"></a>
<p class="title">5.5.3 Границы сети и пространство адресов</p>
<p>Маршрутизатор создает шлюз, через который узлы одной сети могут обмениваться данными с узлами других сетей. Каждый интерфейс маршрутизатора подключается к отдельной сети.</p>
<p>Присвоенный интерфейсу IP-адрес идентифицирует непосредственно подключенную локальную сеть.</p>
<p>Каждый узел в сети обязательно использует в качестве шлюза в другие сети маршрутизатор. Соответственно, каждый узел должен знать IP-адрес интерфейса маршрутизатора, подключенного к его сети. Он называется адресом основного шлюза. Адрес можно статически настроить на уровне узла или получить динамически, с сервера DHCP.</p>
<p>Когда интегрированный маршрутизатор превращается в сервер DHCP локальной сети, он автоматически рассылает всем узлам IP-адреса нужного интерфейса. После этого все узлы в сети смогут использовать этот IP-адрес для передачи сообщений узлам поставщика услуг Интернета и получения доступа к узлам в Интернете. Обычно интегрированные маршрутизаторы становятся серверами DHCP по умолчанию.</p>
<p>IP-адрес данного интерфейса локального маршрутизатора становится адресом основного шлюза в данной конфигурации узлов. Основной шлюз предоставляется статически или через DHCP.</p>
<p>Становясь сервером DHCP, интегрированный маршрутизатор предоставляет клиентам DHCP свой внутренний IP-адрес в качестве основного шлюза. Кроме того, он рассылает узлам IP-адреса и маски подсети.</p>
<center><img src="./img/chapter5/5.39.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.39 -  Границы сети и пространство адресов</center>
<a name="ch5.4"></a>
<p class="title">5.5.4 Присвоение динамического адреса DHCP</p>
<p>Интегрированный маршрутизатор выступает в качестве сервера DHCP всех подключенных к нему кабелем Ethernet или по беспроводной связи локальных узлов. Считается, что эти узлы находятся во внутренней сети. Большинство серверов DHCP присваивают узлам из внутренней сети не маршрутизируемые публичные адреса Интернет, а частные адреса. Это означает, что по умолчанию внутренняя сеть непосредственно из Интернета недоступна.</p>
<p>Обычно выбранный по умолчанию IP-адрес интерфейса локального интегрированного маршрутизатора является частным адресом класса C. Внутренним узлам нужно присвоить адреса сети, в которой находится интегрированный маршрутизатор (статически или через DHCP). Интегрированный маршрутизатор, работающий как сервер DHCP, предоставляет адреса из этого диапазона. Кроме того, он предоставляет данные о маске подсети и IP-адресе своего интерфейса (основной шлюз).</p>
<p>Кроме того, многие поставщики услуг Интернета с помощью серверов DHCP предоставляют IP-адреса для прямого выхода интегрированного маршрутизатора пользователя в Интернет. Сеть, к которой маршрутизатор подключен в Интернете, называется внешней.</p>
<p>Подключенный к поставщику услуг Интернета интегрированный маршрутизатор работает как клиент DHCP, получая правильный IP-адрес внешней сети для интерфейса Интернет. Обычно поставщик услуг Интернета предоставляет маршрутизируемый в Интернете адрес, с помощью которого узлы могут подключаться к интегрированному маршрутизатору и к Интернету.</p>
<p>Интегрированный маршрутизатор разграничивает локальную внутреннюю сеть и внешнюю сеть.</p>
<center><img src="./img/chapter5/5.40.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.40 – Интегрированный маршрутизатор в роли DHCP-сервера и DHCP-клиента. Часть 1</center>
<center><img src="./img/chapter5/5.41.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.41 – Интегрированный маршрутизатор<em> </em>в роли DHCP-сервера и DHCP-клиента. Часть 2</center>
<center><img src="./img/chapter5/5.42.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.42 – Интегрированный маршрутизатор в роли DHCP-сервера и DHCP-клиента. Часть 3</center>


<p>Узлы могут подключаться к поставщику услуг Интернета и Интернету несколькими способами. Получение публичного или частного адреса зависит от метода подключения узла.</p>
<p>1) Прямое подключение. У некоторых клиентов есть только один компьютер с непосредственным подключением к поставщику услуг Интернета через модем. В данном случае публичный адрес с сервера DHCP поставщика услуг Интернета присваивается только одному узлу.</p>
<p>2) Подключение через интегрированный маршрутизатор. Если к Интернету нужно подключить несколько узлов, модем поставщика услуг Интернета можно соединить не с одним компьютером, а непосредственно с интегрированным маршрутизатором. Таким образом создается домашняя сеть или сеть малого предприятия. Интегрированный маршрутизатор получает от поставщика услуг Интернета публичные адреса. Внутренние узлы получают от маршрутизатора частные адреса.</p>
<p>3) Подключение через шлюз. Шлюзы объединяют в себе интегрированный маршрутизатор и модем и подключаются непосредственно к поставщику услуг Интернета. Как и в случае с интегрированными маршрутизаторами, шлюз получает от поставщика услуг Интернета публичный адрес, а ПК во внутренней сети получают от шлюза частные адреса.</p>
<center><img src="./img/chapter5/5.43.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.43 – Методы подключения узла к поставщику услуг Интернета</center>

<a name="ch7"></a>
<p class="title">5.7 Преобразование сетевых адресов</p>
<p>Интегрированный маршрутизатор получает от поставщика услуг Интернета публичный адрес, позволяющий отправлять и получать пакеты через Интернет. Он, в свою очередь, предоставляет локальным сетевым клиентам частные адреса. Поскольку в Интернете частные адреса не используется, при входе клиентов в Интернет их нужно преобразовать в уникальные публичные адреса.</p>
<p>Процесс преобразования частных адресов в маршрутизируемые в Интернете адреса называется преобразованием сетевых адресов (NAT) (Преобразование сетевых адресов. Процедура замены адреса источника или назначения в IP-пакете при прохождении через маршрутизатор или межсетевой экран. Позволяет нескольким узлам в частной сети получать доступ в Интернет с одного публичного IP-адреса). С помощью NAT частный (локальный) IP-адрес источника превращается в публичный (глобальный) адрес. Входящие пакеты проходят обратный процесс. Используя NAT, интегрированный маршрутизатор может преобразовать многие внутренние IP-адреса в один публичный.</p>
<p>Преобразовывать нужно только адреса пакетов, которые идут в другие сети. Они в обязательном порядке проходят через шлюз, где интегрированный маршрутизатор заменяет частный IP-адрес (IP-адрес, зарезервированный исключительно для использования во внутренних сетях и не подлежащий маршрутизации в Интернете. Допустимы следующие диапазоны IP-адресов: с 10.0.0.0 по 10.255.255.255, с 172.15.0.0 по 172.31.255.255 и с 192.168.0.0. по 192.168.255.255) узла-источника своим глобальным IP-адресом.</p>
<p>Хотя каждому узлу во внутренней сети присвоен уникальный частный IP-адрес, они используют один и тот же маршрутизируемый в Интернете адрес интегрированного маршрутизатора [10].</p>
<center><img src="./img/chapter5/5.44.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.44 – Преобразование сетевых адресов. Часть 1</center>
<center><img src="./img/chapter5/5.45.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.45 – Преобразование сетевых адресов. Часть 2</center>
<center><img src="./img/chapter5/5.45.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.46 – Преобразование сетевых адресов. Часть 3</center>
<center><img src="./img/chapter5/5.47.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.47 – Преобразование сетевых адресов. Часть 4</center>
<center><img src="./img/chapter5/5.48.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.48 – Преобразование сетевых адресов. Часть 5</center>
<center><img src="./img/chapter5/5.49.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.49 – Преобразование сетевых адресов. Часть 6</center>
<center><img src="./img/chapter5/5.50.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.50 – Преобразование сетевых адресов. Часть 7</center>

<a name="ch8"></a>
<p class="title">5.8 IP-адресация в LAN</strong></p>
<a name="ch8.1"></a>
<p class="title">5.8.1 Обзор IP-адресов</strong></p>
<p>Один из самых важных аспектов межсетевой связи - схема логической адресации.</p>
<p>IP-адресация представляет собой метод идентификации узлов и сетевых устройств. По мере роста Интернета и увеличения числа подключенных к нему узлов схемы IP-адресации приходилось адаптировать к этому росту.</p>
<p>Несмотря на то, что схемы IP-адресации претерпевали изменения, базовая структура IP-адресов для IPv4 остается неизменной. Чтобы отправлять и принимать сообщения в сети IP, каждому сетевому узлу необходимо иметь уникальный 32-битный IP-адрес. Поскольку людям тяжело читать и понимать большие двоичные числа, IP-адреса обычно отображаются в десятичном формате с точками в качестве разделителей. Каждый из четырех октетов такого числа преобразуется в десятичное число с разделителем. Например, IP-адрес:</strong></p>
<p>11000000.10101000.00000001.01101010</p>
<p>в десятичном представлении с точками имеет вид 192.168.1.105.</p>
<center><img src="./img/chapter5/5.51.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.51 – Отображение IP-адреса в десятичном формате с точками. Часть 1</center>
<center><img src="./img/chapter5/5.52.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.52 – Отображение IP-адреса в десятичном формате с точками. Часть 2</center>
<center><img src="./img/chapter5/5.53.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.53 – Отображение IP-адреса в десятичном формате с точками. Часть 3</center>


<p>IP-адреса представляют собой иерархическую структуру. Это нечто вроде родословного древа, где вверху находятся родители, а внизу - дети. Для сети это означает, что часть 32-битного числа идентифицирует сеть (родительский элемент), а оставшиеся биты - узел (дочерний элемент). В начале существования Интернета подключение было нужно всего нескольким организациям, и сетям присваивались только первые 8 бит (первый октет) (последовательность из восьми битов как единица данных. Вместо восьмиразрядного двоичного числа могут использоваться соответствующие десятичные и шестнадцатеричные числа. Например, октет “11011100” может быть представлен десятичным числом “220”. Численное значение октета лежит в диапазоне от 0 до 255) IP-адреса. Оставшиеся 24 бита использовались как адреса локальных узлов.</p>
<p>Тогда это имело смысл, поскольку первоначально предполагалось, что в Интернет будет выходить несколько очень больших университетов, правительственных и военных организаций. Используя в сетевой части только 8 бит, можно создать 256 отдельных сетей, более чем по 16 миллионов узлов в каждой. Вскоре стало очевидно, что к Интернету будут подключаться другие организации и даже отдельные лица, проводящие исследования или общающиеся друг с другом. Понадобилось больше сетей, и пришлось создать способ увеличения числа сетевых номеров.</p>
<center><img src="./img/chapter5/5.54.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.54 – Узловая и сетевая иерархия IP-адреса. Часть 1</center>
<center><img src="./img/chapter5/5.55.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.55 – Узловая и сетевая иерархия IP-адреса. Часть 2</center>
<center><img src="./img/chapter5/5.55.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.56 – Узловая и сетевая иерархия IP-адреса. Часть 3</center>
<center><img src="./img/chapter5/5.57.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.57 – Узловая и сетевая иерархия IP-адреса. Часть 4</center>

<p>Для увеличения количества возможных сетей 32-битное адресное пространство было разделено на пять классов. В три из них, A, B и C, входят адреса, которые можно присвоить отдельным узлам или сетям. Остальные два класса, D и E, зарезервированы для многоадресных (одиночные пакеты, копируемые сетью и пересылаемые в заданную подгруппу сетевых адресов, определенных в поле адреса назначения) рассылок и экспериментов. </p>
<p>До этого изменения маршрутизаторы проверяли только первые 8 бит IP-адреса сети. Однако сети класса B используют для идентификации сети первые 16 бит. В сетях класса C для идентификации используются первые 24 бита. С учетом этого добавления маршрутизаторы приходилось программировать таким образом, чтобы для идентификации сетей классов B и C они учитывали не только первые 8 бит.</p>
<p>Было принято решение использовать такой способ разделения сетей, при котором маршрутизаторы и узлы могли бы легко определять фактическое число бит ID сети (идентификатора сети) (часть логического адреса, идентифицирующая сеть, к которой относится узел). Класс сети определяется значениями первых нескольких бит IP-адреса, называемых старшими битами.</p>
<p>Первые несколько бит в виде 1 или 0 первого октета IP-адреса при записи в двоичном виде. Старшие биты используются для указания класса IP-адреса. Если первый бит первого октета равен 0, то IP-адрес принадлежит классу А. Для определения принадлежности адреса классу А устройству необходимо проверить только первый бит, следовательно, адрес класса А имеет старший бит, равный 0. Если первый бит первого октета равен 1, то для определения класса устройство должно проверить следующий бит. Если второй бит равен 0, то IP-адрес принадлежит классу В. В таком случае, старшие биты равны 10. Если первый бит равен 1 и второй бит равен 1, то устройство должно проверить третий бит. Если третий бит равен 0, то IP-адрес принадлежит классу С, и старшие биты равны 110. Если первый бит равен 1, второй бит равен 1, третий бит равен 1, а четвертый бит равен 0, то IP-адрес принадлежит классу D, а старшие биты равны 1110. Если первый бит равен 1, второй бит равен 1, третий бит равен 1 и четвертый равен 1, то IP-адрес принадлежит классу Е, а старшие биты равны 1111.</p>
<p>Если первый бит равен 0, сеть принадлежит классу A, и первый октет представляет идентификатор сети. Если первый бит равен 1, маршрутизатор проверяет второй бит. Если его значение равно нулю, сеть относится к классу B, и маршрутизатор считает идентификатором сети первые 16 бит. Если первые три бита равны 110, сеть относится к классу C. В адресах класса C идентификатором сети являются первые 24 бита, или три октета. Разбиение исходной 8-битной сети на более мелкие сетевые классы позволило увеличить число доступных номеров сетей от 256 до более чем двух миллионов [5].</p>
<center><img src="./img/chapter5/5.58.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.58 – IP-адреса класса А</center>
<center><img src="./img/chapter5/5.59.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.59 – IP-адреса класса В</center>
<center><img src="./img/chapter5/5.60.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.60 – IP-адреса класса С</center>
<center><img src="./img/chapter5/5.61.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.61 – IP-адреса класса D</center>
<center><img src="./img/chapter5/5.62.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.62 – IP-адреса класса E</center>

<p>В дополнение к созданию различных классов инженерная группа по развитию Интернета (Internet Engineering Task Force – IETF)  (группа по развитию состоит более чем из 80 рабочих групп, отвечающих за развитие стандартов Интернет. IETF является частью Общества Интернет (ISOC)) решила зарезервировать часть адресного пространства Интернет для частных сетей. Частные сети не имеют связи с публичными сетями. К адресам в частной сети (часть пространства IP-адреса, зарегистрированная для внутреннего использования. Адрес частной сети, используемый внутри сети и не подлежащий маршрутизации через Интернет. В протоколе IPv4 диапазону адресов частной сети присваиваются значения от 10.0.0.0 до 10.255.255.255, от 172.15.0.0 до 172.31.255.255 и от 192.168.0.0 до 192.168.255.255) нет доступа через Интернет. Благодаря этому многочисленные сети, размещенные в различных местоположениях, могут использовать одну и ту же схему частных адресов, не создавая конфликтов адресов.</p>
<p>Использование пространства частных адресов сократило число уникальных зарегистрированных IP-адресов, выделенных для организаций.</p>
<p>Один адрес класса A, 10.0.0.0 был зарезервирован для частных сетей. Кроме того, часть адресного пространства в классах B и C также была выделена для частных сетей.</p>
<p>На данный момент в большинстве сетей используется частная структура адресов. По умолчанию большинство пользовательских сетевых устройств получает частные адреса через DHCP. Маршрутизируемые в Интернете адреса присваиваются только устройствам, которые подключаются непосредственно к публичной сети.</p>
<center><img src="./img/chapter5/5.63.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.63 – Диапазон частных адресов</center>
<center><img src="./img/chapter5/5.64.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.64 – Глобальные и частные адреса</center>


<p>На рисунке 63 ISP назначает маршрутизатору с интегрированными службами публичный IP-адрес, например 209.165.201.14. На рисунке 63 шлюз по умолчанию локальной сети – 192.168.1.1. IP-адреса клиентов выделяют в диапазоне 192.168.1.101-192.168.1.150.</p>
<a name="ch8.2"></a>
<p class="title">5.8.2 Разбиение сети на подсети</strong></p>
<p>В 1980-е и 90-е годы сети продолжали расти и подключаться к Интернету, при этом многие организации создавали сети, включающие сотни и даже тысячи узлов. Казалось бы, для организации с тысячами узлов вполне достаточно сети класса B, однако возникли некоторые проблемы.</p>
<p>Во-первых, эти тысячи узлов редко размещались в одном месте. В целях повышения безопасности и улучшения управляемости некоторые организации предпочли отделить свои подразделения друг от друга. Во-вторых, основным типом пакетов, направляемых в сеть, является широковещательный пакет. Широковещательные пакеты направляются всем узлам, подключенным к одной логической сети. Когда тысячи узлов одной и той же сети отсылают широковещательный трафик при ограниченной пропускной способности каналов связи, добавлении новых узлов влечет за собой существенное падение производительности сети.</p>
<p>Чтобы решить эти проблемы, организации, занимающиеся развитием Интернета, решили разделить свои сети на мини-сети или подсети, используя процесс, получивший название "разбиение на подсети" (subnetting). Как разделить одну IP-сеть на несколько сетей таким образом, чтобы каждая подсеть рассматривалась как отдельная сеть.</p>
<p>Стандарт RFC 917 “Подсети в Интернете” определяет маски подсети как метод, используемый маршрутизаторами для изоляции части сети от IP-адреса. Когда маршрутизатор принимает пакет, он определяет соответствующий путь передачи этого пакета на основе IP-адреса узла назначения и масок подсетей, связанных с маршрутами из таблицы маршрутизации.</p>
<p>Маршрутизатор побитно считывает маску подсети слева направо. Если бит маски подсети установлен в 1, значение в данном местоположении является частью идентификатора сети. Значение 0 в маске подсети показывает, что значение в данном местоположении является частью идентификатора узла.</p>
<center><img src="./img/chapter5/5.65.gif" border="0" alt="Image not found"></center>
<center>Рисунок 5.65 – Классы IP-адресов</center>
<p>Адрес 127.0.0.1 зарезервирован для тестирования обратной связи. Все адреса, состоящие только из нулей (0) или единиц (1) – недействительные адреса узлов.</p>


<p>В иерархии исходных IP-адресов существует два уровня: сеть и узел. При схеме адресации на основе классов значения первых трех бит определяют принадлежность IP-адреса к классу А, В или С. После определения класса адреса становится ясно, сколько бит отведено для идентификатора сети и сколько - для ID узла (идентификатора узла) (часть логического адреса, которая определяет отдельный узел в сети). Для классов сетей по умолчанию используются следующие маски подсетей:</p>
<ul>
<li>класс A 255.0.0.0;</li>
<li>класс B 255.255.0.0;</li>
<li>класс C 255.255.255.0.</li>
</ul>
<p>При делении классовой сети на подсети в иерархию сети добавляется еще один уровень. Теперь их три: сеть, подсеть и узел. Как можно изменить маску подсети, чтобы обозначить новый уровень иерархии.</p>
<p>Сетевое адресное пространство одного класса A, B или C может быть разделено на несколько подсетей за счет использования бит из адресного пространства узла для задания идентификатора подсети. Рассмотрим, например, организацию, использующую адресное пространство класса C и имеющую два офиса в разных зданиях. Чтобы облегчить управление сетью, сетевые администраторы хотят иметь в каждом местоположении логически разделенные сети. Если взять два бита из адреса узла, то длина маски подсети увеличится с 24 бит по умолчанию до 26 бит или 255.255.255.192.</p>
<p>Когда биты заимствуются из узловой части адреса для идентификации подсети, на долю отдельных узлов остается меньше бит. Если два бита используются для идентификации подсети, в узловой части адреса остается только шесть бит. </p>
<center><img src="./img/chapter5/5.65.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.66 – Иерархия IP-адресов. Часть 1</center>
<center><img src="./img/chapter5/5.67.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.67 – Иерархия IP-адресов. Часть 2</center>
<center><img src="./img/chapter5/5.68.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.68 – Иерархия IP-адресов. Часть 3</center>
<center><img src="./img/chapter5/5.69.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.69 – Иерархия IP-адресов. Часть 4</center>


<p>При традиционном классовом делении на подсети одно и то же число бит используется для определения идентификаторов всех создаваемых подсетей. При таком типе деления на подсети всегда получается фиксированное количество подсетей и фиксированное количество узлов в каждой подсети. По этой причине такой метод называется делением на подсети с фиксированной длиной.</p>
<p>Решение о том, сколько бит узла выделить для идентификации подсети, является очень ответственным плановым решением. При планировании подсетей нужно учесть две вещи: количество узлов в каждой сети и количество локальных сетей. Из таблицы возможных подсетей в сети 192.168.1.0 видно, как выбор количества бит в идентификаторе подсети влияет на количество возможных подсетей и количество узлов в каждой из них.</p>
<p>Необходимо помнить, что во всех сетях IPv4 два адреса узлов зарезервированы: все нули и все единицы. Адрес со всеми нулями в узловой части является недействительным адресом узла и обычно относится ко всей сети или подсети. Адрес со всеми единицами в узловой части используется как адрес широковещательной рассылки. Когда какая-то сеть разбивается на подсети, в каждой из этих подсетей имеются узловые адреса со всеми нулями и со всеми единицами, но эти адреса нельзя использовать в качестве адресов индивидуальных узлов [12].</p>
<center><img src="./img/chapter5/5.70.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.70 – Пример разделения иерархии IP-адресов для разбиения на подсети с классовой адресацией. Часть 1</center>
<center><img src="./img/chapter5/5.71.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.71 – Пример разделения иерархии IP-адресов для разбиения на подсети с классовой адресацией. Часть 2</center>
<center><img src="./img/chapter5/5.72.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.72 – Пример разделения иерархии IP-адресов для разбиения на подсети с классовой адресацией. Часть 3</center>
<center><img src="./img/chapter5/5.73.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.73 – Пример разделения иерархии IP-адресов для разбиения на подсети с классовой адресацией. Часть 4</center>
<center><img src="./img/chapter5/5.74.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.74 – Пример разделения иерархии IP-адресов для разбиения на подсети с классовой адресацией. Часть 5</center>

<a name="ch8.3"></a>
<p class="title">5.8.3 Пользовательские маски подсети</strong></p>
<p>При делении сети маршрутизатор должен использовать модифицированную, или изменяемую, маску подсети, позволяющую отличать подсети друг от друга.</p>
<p>Маска подсети по умолчанию и изменяемая маска отличаются друг от друга тем, что маски подсетей по умолчанию изменяются только в границах октета. Например, маска подсети сети класса А по умолчанию - 255.0.0.0. Изменяемые маски забирают биты из идентификатора узла и прибавляют их к маске по умолчанию.</p>
<p>При создании изменяемой маски подсети (32-битовая маска адреса, предназначенная для определения битов IP-адреса, которые были использованы для адреса подсети. Любая маска подсети, не являющаяся маской подсети класса А, В или С по умолчанию, рассматривается как изменяемая маска подсети), нужно, прежде всего, решить, сколько бит взять из идентификатора узла и добавить к маске подсети. Число бит, которые необходимо позаимствовать, чтобы получить нужное число подсетей, можно определить с помощью следующей формулы: 2^n, где n - это число заимствуемых бит.</p>
<p>Если требуется три подсети, число бит подсети должно быть достаточным для создания трех уникальных адресов подсетей.</p>
<p>Например, если начать с адреса класса C, такого как 192.168.1.0, остается только восемь бит, из которых можно заимствовать. Каждый бит принимает только два значения: 1 или 0. Чтобы создать три подсети, необходимо занять, по крайней мере, два из восьми бит. При этом можно подключить в общей сложности четыре подсети:</p>
<ul>
<li>00 - 1я подсеть,</li>
<li>01 - 2я подсеть,</li>
<li>10 - 3я подсеть,</li>
<li>11 - 4я подсеть,</li>
</ul>
<p>В приведенном выше примере были заимствованы два бита, 2^2 = 4 или 2 x 2 = 4, поэтому было создано четыре подсети. Если бы потребовалось от пяти до восьми подсетей, пришлось бы занять три бита (2^3 = 8 или 2 x 2 x 2).</p>
<p>Число бит, выбранных для идентификатора подсети, влияет как на количество возможных подсетей, так и на число узлов, которые могут входить в каждую подсеть.</p>
<center><img src="./img/chapter5/5.75.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.75 – Разделение на подсети для двух сетей</center>
<center><img src="./img/chapter5/5.75.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.76 – Схема адресации для двух сетей</center>


<p>В подсетях, организованных по классам, число бит, необходимых для идентификатора подсети, зависит от двух факторов: числа созданных подсетей и числа узлов в каждой подсети.</p>
<p>При делении на подсети с использованием классов или с фиксированной длиной все подсети должны иметь одинаковый размер. Это означает, что максимальное число узлов, поддерживаемых каждой подсетью, одно и то же для всех созданных подсетей. Чем больше бит отдано для идентификатора подсети, тем меньше их остается для идентификаторов узлов.</p>
<p>Для определения доступного числа идентификаторов узлов в зависимости от количества оставшихся для узлов бит можно использовать ту же формулу 2^n с небольшим изменением. Поскольку в каждой подсети два адреса узлов зарезервированы, т. е. адреса со всеми нулями или всеми единицами, формула для определения числа поддерживаемых узлов принимает следующий вид 2^n - 2.</p>
<p>После того, как определено, сколько бит отводится под адрес подсети, все устройства в сети уведомляются о разбиении маской подсети. При наличии маски подсети можно определить, к какой подсети относится IP-адрес, и разработать простую схему IP-адресации в классовых подсетях.</p>
<center><img src="./img/chapter5/5.77.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.77 - Разделение на подсети для четырех сетей</center>
<center><img src="./img/chapter5/5.78.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.78 – Схема адресации для четырех сетей</center>


<center><img src="./img/chapter5/5.79.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.79 - Разделение на подсети для восьми сетей</center>
<center><img src="./img/chapter5/5.80.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.80 – Схема адресации для четырех сетей</center>

<p>Разделение на подсети позволило решить многие проблемы, существовавшие в первоначальной схеме адресации на основе классов. С его помощью организации, владевшие адресом класса A, B или C, смогли разбить свое адресное пространство на локальные подсети меньшего размера для более эффективного присвоения адресов. Большое значение разделения на подсети заключается также в том, что оно помогает минимизировать трафик и усилить меры безопасности между сетями.</p>
<p>Примером ситуации, которая могла бы потребовать разделения на подсети, является такая ситуация, когда первоначально созданная сеть становится недостаточной для клиента поставщика услуг Интернета. В этой сети первый небольшой интегрированный беспроводной маршрутизатор перегружен трафиком от проводных и беспроводных пользователей. В этой сети, в силу ее сравнительно небольшого размера, используется адресное пространство класса C.</p>
<p>Одним из возможных решений проблемы перегрузки сети является добавление второго сетевого устройства, например, более крупного маршрутизатора с интеграцией служб (ISR). При добавлении нового устройства полезно с точки зрения повышения безопасности подсоединить проводных и беспроводных пользователей к различным локальным подсетям. В этом случае первоначальный беспроводной маршрутизатор можно использовать для подсоединения к единой сети беспроводных пользователей и обеспечения их безопасности. Концентраторы или коммутаторы, подсоединяющие проводных пользователей, можно напрямую связать с новым ISR, используя другую сеть. Маршрутизатор ISR и беспроводной маршрутизатор можно в свою очередь напрямую подключить к третьей сети.</p>
<p>В этой новой сетевой конфигурации требуется, чтобы существующая сеть класса C была разделена, по крайней мере, на три подсети. При использовании классовых подсетей не менее двух бит должно быть выделено из узловой части адреса для удовлетворения требований клиента. Такая схема разбиения на подсети позволяет создать четыре отдельных сети, в каждой из которых доступно 62 адреса узлов (всего 64 возможных адреса минус два адреса со всеми нулями и всеми единицами) [10].</p>
<center><img src="./img/chapter5/5.81.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.81 – Принцип разбиения сети на подсети. Часть 1</center>
<center><img src="./img/chapter5/5.82.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.82 – Принцип разбиения сети на подсети. Часть 2</center>

<a name="ch8.4"></a>
<p class="title">5.8.4 Маски VLSM и бесклассовая междоменная маршрутизация (CIDR)</strong></p>
<p>В первоначальном проекте классовых подсетей требовалось, чтобы все подсети одной классовой сети имели один и тот же размер. Это было связано с тем, что маршрутизаторы не включали информацию о маске подсети в свои обновления маршрутизации. Маршрутизатор, запрограммированный на интерфейс с одним адресом и одной маской подсети, автоматически применял одну и ту же маску к другим подсетям данной сети в своей таблице маршрутизации. Это ограничение требовало планирования для масок подсетей фиксированной длины в схеме IP-адресации.</p>
<p>Однако маски подсетей фиксированной длины могут приводить к бесполезной растрате значительного числа IP-адресов. Например, рассмотрим организацию с одним веб-сайтом, которая имеет приблизительно 8000 узлов и три различных местоположения, в каждом из которых насчитывается соответственно 1000, 400 и 100 узлов. При маске подсети фиксированной длины каждая подсеть должна была бы поддерживать, по крайней мере, 8000 узлов, даже та, для которой достаточно всего 100 адресов.</p>
<p>Маски подсети переменной длины (VLSM) помогают устранить этот недостаток. Адресация VLSM позволяет рационально создавать адресное пространство в сетях различного размера. Это достигается путем разделения подсетей на подсети. С этой целью современные маршрутизаторы должны получать информацию о маршрутизации, которая включает IP-адрес сети и информацию маски подсети, которая показывает число бит, образующих сетевую часть IP-адреса. Технология VLSM позволяет экономить тысячи IP-адресов, которые при традиционном классовом делении на подсети были бы растрачены впустую.</p>
<p>В дополнение к VLSM, в RFC 1519 была предложена и принята технология бесклассовой междоменной маршрутизации (CIDR) (технология, основанная на агрегировании маршрута и поддерживаемая четвертой версией протокола BGP. CIDR позволяет маршрутизаторам группировать маршруты для уменьшения данных маршрутизации, пересылаемых магистральными маршрутизаторами. При использовании бесклассовой междоменной маршрутизации группа IP-сетей представляется для сетей вне группы как единое целое). CIDR игнорирует классы сетей на основе значений старших бит. В технологии CIDR идентификация сетей базируется только на числе бит в сетевом префиксе, которое соответствует числу единиц в маске подсети. Например, IP-адрес, написанный в соответствии со стандартом CIDR, имеет вид 172.15.1.1/16, где /16 означает число бит в сетевом префиксе.</p>
<center><img src="./img/chapter5/5.83.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.83 – Исходная сеть для разбиения на подсети</center>
<center><img src="./img/chapter5/5.84.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.84 – Разбиение сети на подсети с помощью масок фиксированной длины. Часть 1</center>
<center><img src="./img/chapter5/5.85.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.85 – Разбиение сети на подсети с помощью масок фиксированной длины. Часть 2</center>
<center><img src="./img/chapter5/5.85.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.86 – Маска подсети фиксированной длины. Часть 3</center>
<center><img src="./img/chapter5/5.87.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.87 – Разбиение сети на подсети с помощью масок фиксированной длины. Часть 4</center>
<center><img src="./img/chapter5/5.88.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.88 – Разбиение сети на подсети с помощью масок переменной длины (VLSM). Часть 1</center>
<center><img src="./img/chapter5/5.89.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.89 – Разбиение сети на подсети с помощью масок переменной длины (VLSM). Часть 2</center>
<center><img src="./img/chapter5/5.90.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.90 – Разбиение сети на подсети с помощью масок переменной длины (VLSM). Часть 3</center>
<center><img src="./img/chapter5/5.91.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.91 – Разбиение сети на подсети с помощью масок переменной длины (VLSM). Часть 4</center>


<p>Протоколы CIDR освободили маршрутизаторы от использования только старших бит для определения префикса сети. Устранение этого ограничения избавило от необходимости выделять зарегистрированные IP-адреса в виде класса адреса.</p>
<p>До внедрения CIDR поставщик услуг Интернета, которому требовалось 3000 адресов узлов, мог запрашивать либо полное адресное пространство класса B, либо несколько сетевых адресов класса C для удовлетворения своих нужд. В случае адресного пространства класса B поставщик услуг Интернета понапрасну терял бы тысячи зарегистрированных адресов. При использовании нескольких адресов класса C было бы затруднительно проектировать сеть ISP таким образом, чтобы ни одна ее часть не требовала более 254 адресов узлов. Кроме того, таблицы маршрутизации, содержащие много адресов класса C, могут стать слишком громоздкими и трудно управляемыми [11].</p>
<p>Игнорируя традиционные классы адресов, технология CIDR позволяет поставщику услуг Интернета затребовать блок адресов на основе того числа адресов узлов, которое ему фактически необходимо. Суперсети, создаваемые путем объединения группы адресов класса C в один большой блок, позволяют присваивать адреса более эффективно. Пример суперсети: 192.168.0.0/19. Использование первых 19 бит IP-адреса в качестве префикса сети позволяет этой суперсети содержать 8190 возможных адресов узлов. ISP может использовать суперсеть как одну большую сеть или разбить ее, если требуется, на множество мелких сетей.</p>
<p>В этом примере суперсети используется частный адрес 192.168.0.0 класса C. В реальной жизни в большинстве сетей, где используется частная адресация, применяются резервные адреса классов A или B и разбиение на подсети. Несмотря на то, что адресация на основе классов и использование масок подсетей фиксированной длины становятся все менее популярными, важно понимать, как эти методы адресации работают. Во многих устройствах все еще используется маска подсети по умолчанию, если не определена изменяемая маска подсети [10].</p>
<p>Спецификацией CIDR (RFC 1519) предусмотрены:</p>
<ul>
<li>более эффективный способ использования адресного пространства IPv4,</li>
<li>агрегирование префиксов для уменьшения размера таблиц маршрутизации.</li>
</ul>
<a name="ch8.5"></a>
<p class="title">5.8.5 Обмен данными между подсетями</strong></p>
<p>При делении сети на подсети каждая подсеть фактически представляет собой совершенно самостоятельную сеть. Поэтому, чтобы устройство из одной подсети могло обмениваться данными с устройством из другой подсети, необходим маршрутизатор, поскольку именно маршрутизаторы соединяют сети.</p>
<p>Чтобы определить, сколько узлов должно быть в каждой подсети, необходимо учесть не только отдельные узловые устройства, но и интерфейс маршрутизатора или интерфейс шлюза. У каждого интерфейса маршрутизатора должен быть IP-адрес в той же подсети, к которой подключена сеть узла.</p>
<p>В некоторых случаях возникает необходимость соединить два маршрутизатора, например, при соединении устройства Linksys и маршрутизатора 1841 ISR. В этой конфигурации необходимо обеспечить, чтобы интерфейсам связанных друг с другом маршрутизаторов были присвоены IP-адреса в одной и той же сети или подсети. Здесь общий канал показывает, что к подсети 192.168.1.16/29 подключено два маршрутизатора с IP-адресами 192.168.1.17/29 и 192.168.1.18/29.</p>
<center><img src="./img/chapter5/5.92.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.92 – Включение интерфейсов маршрутизатора в подсети. Часть 1</center>
<center><img src="./img/chapter5/5.93.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.93 – Включение интерфейсов маршрутизатора в подсети. Часть 2</center>
<center><img src="./img/chapter5/5.94.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.94 – Включение интерфейсов маршрутизатора в подсети. Часть 3</center>
<center><img src="./img/chapter5/5.95.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.95 – Включение интерфейсов маршрутизатора в подсети. Часть 4</center>
<center><img src="./img/chapter5/5.95.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.96 – Включение интерфейсов маршрутизатора в подсети. Часть 5</center>

<a name="ch9"></a>
<p class="title">5.9 Основное преобразование IP-адресов (NAT)</strong></p>
<a name="ch9.1"></a>
<p class="title">5.9.1 Принцип механизма NAT</strong></p>
<p>Маршрутизаторы необходимы для связи подсетей с внутренней сетью независимо от того, является ли диапазон IP-адресов общим или частным. Но если диапазон адресов является частным, маршруты для частных сетей нельзя прокладывать через публичный Интернет. Поэтому неясно, как же узловые устройства, использующие частную схему адресации, связываются через Интернет. Для устройства, соединяющего частную сеть с сетью поставщика услуг Интернета, должно быть разрешено преобразование сетевых адресов (NAT).</p>
<p>NAT позволяет большой группе частных пользователей получать доступ в Интернет, совместно пользуясь одним или несколькими публичными IP-адресами. Эта система работает примерно так же, как телефонная система внутри компании. По мере того, как численность персонала компании растет, сотрудники перестают подключаться непосредственно к публичной телефонной линии. Вместо этого каждому сотруднику компании присваивается добавочный номер. Это возможно потому, что не все они одновременно пользуются телефоном. Использование частных добавочных номеров позволяет организации закупать у телефонной компании меньшее число внешних телефонных линий.</p>
<p>NAT работает примерно так же, как телефонная система компании. Одна из основных причин создания NAT - возможность сэкономить зарегистрированные IP-адреса. Кроме того, NAT обеспечивает безопасность компьютеров, серверов и сетевых устройств, блокируя непосредственный доступ в Интернет с реального IP-адреса узла.</p>
<center><img src="./img/chapter5/5.97.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.97 – Принцип механизма NAT. Часть 1</center>
<center><img src="./img/chapter5/5.98.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.98 – Принцип механизма NAT. Часть 2</center>
<center><img src="./img/chapter5/5.99.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.99 – Принцип механизма NAT. Часть 3</center>
<center><img src="./img/chapter5/5.100.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.100 – Принцип механизма NAT. Часть 4</center>

<p>Многие организации хотят использовать преимущества частных адресов при подключении к Интернету. Организации создают огромные локальные и глобальные сети с частной адресацией и подключаются к Интернету с использованием преобразования сетевых адресов (NAT).</p>
<p>Технология NAT преобразует внутренние частные адреса в один или несколько публичных адресов для маршрутизации в сети Интернет. NAT меняет исходный частный IP-адрес внутри каждого пакета на публично зарегистрированный IP-адрес до передачи его в Интернет.</p>
<p>Организации малого и среднего бизнеса подключаются к ПУИ, используя единственное подключение. Локальный пограничный маршрутизатор, на котором настроена технология NAT, подключается к ПУИ. Более крупные организации могут использовать несколько подключений к ПУИ, и в каждом из этих местоположений пограничный маршрутизатор выполняет преобразование сетевых адресов.</p>
<p>Использование NAT на пограничных маршрутизаторах повышает безопасность. Внутренние частные адреса преобразуются каждый раз в разные публичные адреса. Это позволяет скрыть реальный адрес узлов и серверов предприятия. Большинство маршрутизаторов, использующих преобразование NAT, также блокируют пакеты, поступающие извне частной сети за исключением случаев, когда они поступают в ответ на запрос от внутреннего узла.</p>
<center><img src="./img/chapter5/5.101.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.101 – Преобразование частных адресов</center>
<p>Основное преимущество NAT состоит в том, что IP-адреса могут быть повторно использованы, и многие узлы одной ЛВС могут совместно пользоваться глобально уникальными IP-адресами. NAT работает прозрачно и помогает защитить пользователей частной сети от несанкционированного доступа из публичного домена.</p>
<p>Кроме того, NAT скрывает частные IP-адреса от публичных сетей. Преимущество этой технологии состоит в том, что NAT во многом работает как список управления доступом, не позволяя внешним пользователям подключаться к внутренним устройствам. Ее недостатком является то, что для доступа легитимных внешних пользователей требуются дополнительные настройки.</p>
<p>Другой недостаток состоит в том, что NAT влияет на некоторые приложения, имеющие IP-адреса в своей полезной нагрузки сообщения (содержимое сообщения), поскольку эти IP-адреса также должны преобразовываться. Это преобразование увеличивает нагрузку на маршрутизатор и снижает производительность сети.</p>
<center><img src="./img/chapter5/5.102.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.102 – Преимущества и недостатки NAT</center>
<a name="ch9.2"></a>
<p class="title">5.9.2 Термины IP NAT</strong></p>
<p>В процессе настройки NAT на маршрутизаторе используется несколько терминов, помогающих объяснить, как маршрутизатор реализует эту технологию.</p>
<ul>
<li>Внутренняя локальная (частное сетевое адресное пространство, связанное с интерфейсом маршрутизатора. Внутренняя локальная сеть используется для преодоления недостатков публичной IP-адресации) сеть относится к любой подключенной к маршрутизатору сети, которая является частью локально адресуемой ЛВС. Узлы внутренних сетей имеют свои IP-адреса, преобразуемые перед передачей внешним пунктам назначения.</li>
<li>Внешняя глобальная сеть (сеть, подключенная к маршрутизатору, которая является внешней по отношению к локальной сети и не допускает частных адресов, присвоенных узлам в локальной сети) - любая сеть, подключенная к маршрутизатору, которая является внешней по отношению к локальной сети и не допускает частных адресов, присвоенных узлам в локальной сети.</li>
<li>Внутренний локальный адрес (частный IP-адрес, настроенный на узле во внутренней сети. Внутренний локальный адрес должен быть преобразован перед его передачей из локальной адресной структуры в Интернет) - частный IP-адрес, настроенный на узле во внутренней сети. Этот адрес должен быть преобразован, прежде чем он покинет адресную структуру локальной сети.</li>
<li>Внутренний глобальный адрес (IP-адрес внутреннего узла, который доступен для маршрутизации во внешней сети. Внутренний глобальный адрес является IP-адресом, который может преобразовываться с помощью NAT) - IP-адрес внутреннего узла, доступный для маршрутизации во внешней сети. Это преобразованный IP-адрес.</li>
<li>Внешний локальный адрес (публичный IP-адрес внешнего узла, выделяемый из пространства глобальных маршрутизируемых сетевых адресов) - адрес получателя пакета, пока он находится в локальной сети. Обычно этот адрес совпадает с внешним глобальным адресом.</li>
<li>Внешний глобальный адрес - публичный IP-адрес внешнего узла. Этот адрес выделяется из пространства глобальных маршрутизируемых сетевых адресов.</li>
</ul>
<center><img src="./img/chapter5/5.103.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.103 – Пример преобразования частных IP-адресов. Часть 1</center>
<center><img src="./img/chapter5/5.104.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.104 – Пример преобразования частных IP-адресов. Часть 2</center>
<center><img src="./img/chapter5/5.105.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.105 – Пример преобразования частных IP-адресов. Часть 3</center>
<center><img src="./img/chapter5/5.105.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.106 – Пример преобразования частных IP-адресов. Часть 4</center>
<center><img src="./img/chapter5/5.107.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.107 – Пример преобразования частных IP-адресов. Часть 5</center>

<a name="ch9.3"></a>
<p class="title">5.9.3 Статическое и динамическое преобразование NAT</strong></p>
<p>Адреса могут присваиваться динамически. Динамическое преобразование сетевых адресов позволяет узлам в частной сети, имеющим частные IP-адреса, подключаться к публичной сети, например, сети Интернет. Динамическое преобразование сетевых адресов происходит тогда, когда маршрутизатор присваивает внешний глобальный адрес из предварительно определенного адреса или пула адресов внутреннему устройству частной сети.</p>
<p>Пока сеанс открыт, маршрутизатор отслеживает внутренние глобальные адреса и отправляет подтверждения инициирующим внутренним устройствам. Когда сеанс закрывается, маршрутизатор просто возвращает внутренний глобальный адрес в пул [10].</p>
<center><img src="./img/chapter5/5.108.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.108 – Динамическое преобразование NAT</center>

<p>Одно из преимуществ использования NAT состоит в том, что отдельные узлы недоступны из Интернета напрямую. Но что делать, если один или несколько узлов внутри сети выполняют услуги, доступ к которым должен осуществляться через устройства, подключенные к Интернету, и устройства из локальной частной сети.</p>
<p>Один из способов обеспечения доступа к локальному узлу из Интернета состоит в том, чтобы присвоить этому устройству статическое преобразование адреса. Статические преобразования гарантируют, что частный IP-адрес отдельного узла будет всегда преобразовываться в один и тот же зарегистрированный глобальный адрес. Это означает, что никакой другой локальный узел не получит тот же самый зарегистрированный адрес.</p>
<p>Статическое NAT позволяет узлам из публичной сети подключаться к отдельным узлам из частной сети. Если устройство во внутренней сети должно быть доступно извне, следует использовать статическое NAT (статическое преобразование сетевых адресов – тип протокола преобразования, в котором внутреннему узлу с фиксированным частным IP-адресом постоянно привязан фиксированный внешний IP-адрес).</p>
<p>В случае необходимости статическое и динамическое NAT могут быть настроены одновременно.</p>
<center><img src="./img/chapter5/5.109.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.109 – Статическое преобразование NAT</center>

<p>Статическое преобразование NAT (механизм преобразования сетевых адресов, в котором внутреннему узлу с фиксированным частным IP-адресом постоянно привязан фиксированный IP-адрес) сопоставляет единый внутренний локальный адрес (частный IP-адрес, настраиваемый на узле во внутренней сети. Внутренний локальный адрес должен быть преобразован перед его передачей из локальной адресной структуры в Интернет) с единым глобальным или публичным адресом. Это сопоставление позволяет всегда связывать определенный внутренний локальный адрес с одним и тем же публичным адресом. Статическое преобразование NAT гарантирует, что внешние устройства всегда получают доступ к внутреннему устройству. В качестве примера можно привести веб-серверы и FTP-серверы, доступные для публики.</p>
<p>Динамическое преобразование NAT (процесс преобразования сетевых адресов, который преобразует локальный IP-адрес в глобальный IP-адрес путем назначения первого доступного IP-адреса в пуле публичных адресов внутри узла.  Узел  использует назначенный глобальный IP-адрес на протяжении всего сеанса. При завершении сеанса глобальный адрес возвращается в пул для использования другими узлами) использует пул доступных публичных Интернет-адресов и назначает их внутренним адресам. Динамическое преобразование NAT назначает внутреннему устройству первый доступный IP-адрес из пула публичных адресов. Этот узел использует назначенный глобальный IP-адрес на протяжении всего сеанса. По завершении сеанса внешний глобальный адрес возвращается в пул и может использоваться другим узлом.</p>
<p>Для обмена данными между внутренними узлами используется внутренний локальный адрес. Публичный адрес, назначенный организации, называется внутренним глобальным адресом (IP-адрес внутреннего ущла, который доступен  для маршрутизации во внешней сети. Внутренний глобальный адрес является IP-адресом, который может преобразовываться с помощью NAT). Внутренний глобальный адрес иногда используется как адрес внешнего интерфейса пограничного маршрутизатора.</p>
<p>Маршрутизатор NAT управляет преобразованиями внутренних локальных и глобальных адресов, поскольку на нем хранится таблица, содержащая все пары адресов.</p>
<center><img src="./img/chapter5/5.110.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.110 – Этапы статического преобразования NAT. Часть 1</center>
<center><img src="./img/chapter5/5.111.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.111 – Этапы статического преобразования NAT. Часть 2</center>
<center><img src="./img/chapter5/5.112.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.112 – Этапы статического преобразования NAT. Часть 3</center>
<center><img src="./img/chapter5/5.113.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.113 – Этапы статического преобразования NAT. Часть 4</center>
<center><img src="./img/chapter5/5.114.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.114 – Этапы статического преобразования NAT. Часть 5</center>
<center><img src="./img/chapter5/5.115.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.115 – Этапы статического преобразования NAT. Часть 6</center>
<center><img src="./img/chapter5/5.115.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.116 – Этапы динамического преобразования NAT. Часть 1</center>
<center><img src="./img/chapter5/5.117.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.117 – Этапы динамического преобразования NAT. Часть 2</center>
<center><img src="./img/chapter5/5.118.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.118 – Этапы динамического преобразования NAT. Часть 3</center>
<center><img src="./img/chapter5/5.119.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.119 – Этапы динамического преобразования NAT. Часть 4</center>
<center><img src="./img/chapter5/5.120.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.120 – Этапы динамического преобразования NAT. Часть 5</center>
<center><img src="./img/chapter5/5.121.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.121 – Этапы динамического преобразования NAT. Часть 6</center>
<center><img src="./img/chapter5/5.122.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.122 – Этапы динамического преобразования NAT. Часть 7</center>
<center><img src="./img/chapter5/5.123.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.123 – Этапы динамического преобразования NAT. Часть 8</center>
<center><img src="./img/chapter5/5.124.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.124 – Этапы динамического преобразования NAT. Часть 9</center>
<center><img src="./img/chapter5/5.125.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.125 – Этапы динамического преобразования NAT. Часть 9</center>

<a name="ch9.4"></a>
<p class="title">5.9.4 Преобразование сетевых адресов на основе портов (PAT)</strong></p>
<p>Если зарегистрированный пул IP-адресов (диапазон зарегистрированных IP-адресов, используемых с преобразованием NAT) организации очень небольшой, или если у нее есть всего один IP-адрес, к публичной сети все равно могут одновременно подключаться несколько пользователей благодаря механизму, который называется перегрузкой NAT или преобразованием адресов портов (PAT) (стандарт, используемый для уменьшения числа внутренних частных IP-адресов. PAT позволяет организациям резервировать адреса в пуле глобальных адресов с сохранением возможности трансляции портов источника в TCP-соединениях или UDP-каналах. Затем различные локальные адреса сопоставляются с одним и тем же глобальным адресом с помощью предоставления PAT уникальных данных. PAT является поднабором функциональных возможностей NAT). PAT преобразует несколько локальных адресов в один глобальный IP-адрес.</p>
<p>Когда узел источника отправляет сообщение узлу назначения, он использует сочетание IP-адреса и номера порта и таким образом отслеживает каждый отдельный сеанс связи с адресатом. В режиме PAT шлюз преобразует адрес локального источника и номер порта из пакета в один глобальный IP-адрес и уникальный номер порта выше 1024. Хотя каждый узел получает одинаковый глобальный IP-адрес, номер порта остается уникальным.</p>
<p>Ответный трафик адресуется на преобразованный IP-адрес и номер порта узла. В таблице маршрутизатора находится список внутренних IP-адресов и номеров портов, которые преобразуются во внешние адреса. Ответный трафик направляется на соответствующий внутренний адрес и номер порта. Поскольку в наличии есть более 64 000 портов, маршрутизатору вряд ли не хватит адресов, как это могло бы случиться при динамическом преобразовании NAT.</p>
<center><img src="./img/chapter5/5.125.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.126 – Преобразование сетевых адресов на основе портов (PAT)</center>
<p>Поскольку каждое преобразование специфично для локального адреса и локального порта, каждое подключение, при котором генерируется новый порт источника, требует отдельного преобразования. Например, 10.1.1.1:1025 нужно отдельно преобразовать из 10.1.1.1:1025.</p>
<p>Преобразование действует только на время соединения, так что после завершения обмена данными пользователь не сохраняет данное сочетание глобального IP-адреса и порта.</p>
<p>Пользователи из внешней сети не смогут установить надежное соединение с узлом сети, где используется PAT. Дело не только в том, что локальный или глобальный номер порта невозможно прогнозировать, но и в том, что шлюз даже не создает преобразование, пока внутренний узел не установит соединение.</p>
<center><img src="./img/chapter5/5.127.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.127 – Механизм преобразования сетевых адресов на основе портов (PAT) в действии. Часть 1</center>
<center><img src="./img/chapter5/5.128.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.128 – Механизм преобразования сетевых адресов на основе портов (PAT) в действии. Часть 2</center>
<center><img src="./img/chapter5/5.129.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.129 – Механизм преобразования сетевых адресов на основе портов (PAT) в действии. Часть 3</center>
<center><img src="./img/chapter5/5.130.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.130 – Механизм преобразования сетевых адресов на основе портов (PAT) в действии. Часть 4</center>
<center><img src="./img/chapter5/5.131.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.131 – Механизм преобразования сетевых адресов на основе портов (PAT) в действии. Часть 5</center>

<p>Один из наиболее популярных вариантов динамического преобразования NAT называется преобразованием адреса и номера порта (PAT), также известное как перегрузка NAT (динамически транслирует несколько внутренних локальных адресов в один публичный адрес для того, чтобы доступ к сети Интернет был у нескольких клиентов). PAT динамически преобразует множество внутренних локальных адресов в один публичный адрес.</p>
<p>Когда узел источника отправляет сообщение узлу назначения, он использует сочетание IP-адреса и номера порта и, таким образом, отслеживает каждый отдельный сеанс связи. При использовании PAT шлюз преобразует сочетание локального адреса и номера порта источника в единый глобальный IP-адрес и уникальный номер порта, значение которого превышает 1024.</p>
<p>В таблице маршрутизатора находится список внутренних IP-адресов и номеров портов, которые преобразуются во внешние адреса. Хотя все узлы преобразуются в один и тот же глобальный IP-адрес, номер порта, связанный с сеансом связи, уникален.</p>
<p>Поскольку доступно более 64 000 портов, маловероятно, что на маршрутизаторе могут кончиться адреса.</p>
<p>Функциями PAT могут эффективно пользоваться как корпоративные, так и домашние сети. PAT встраивается в интегрированные маршрутизаторы и активизируется по умолчанию.</p>
<center><img src="./img/chapter5/5.132.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.132 – Процесс преобразования адресов портов (PAT). Часть 1</center>
<center><img src="./img/chapter5/5.133.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.133 – Процесс преобразования адресов портов (PAT). Часть 2</center>
<center><img src="./img/chapter5/5.134.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.134 – Процесс преобразования адресов портов (PAT). Часть 3</center>
<center><img src="./img/chapter5/5.135.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.135 – Процесс преобразования адресов портов (PAT). Часть 4</center>
<center><img src="./img/chapter5/5.135.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.136 – Процесс преобразования адресов портов (PAT). Часть 5</center>
<center><img src="./img/chapter5/5.137.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.137 – Процесс преобразования адресов портов (PAT). Часть 6</center>
<center><img src="./img/chapter5/5.138.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.138 – Процесс преобразования адресов портов (PAT). Часть 7</center>
<center><img src="./img/chapter5/5.139.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.139 – Процесс преобразования адресов портов (PAT). Часть 8</center>
<center><img src="./img/chapter5/5.140.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.140 – Процесс преобразования адресов портов (PAT). Часть 9</center>
<center><img src="./img/chapter5/5.141.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.141 – Процесс преобразования адресов портов (PAT). Часть 10</center>
<center><img src="./img/chapter5/5.142.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.142 – Процесс преобразования адресов портов (PAT). Часть 11</center>

<a name="ch9.5"></a>
<p class="title">5.9.5 Проблемы IP NAT</strong></p>
<p>Пользователи подключаются к Интернету из частных сетей, даже не подозревая о том, что маршрутизатор использует NAT. Вместе с тем, важный момент заключается в том, что преобразование NAT создает дополнительную нагрузку для поддержки преобразований IP-адреса и порта.</p>
<p>Некоторые приложения увеличивают рабочую нагрузку маршрутизатора, поскольку включают в инкапсулированные данные IP-адрес. Маршрутизатору приходится заменять комбинации IP-адресов и портов источника в пакете и адреса источника в заголовке IP.</p>
<p>Из-за того, что маршрутизатору приходится выполнять дополнительную работу, для внедрения NAT требуется хорошее планирование сети, тщательный подбор оборудования и правильная конфигурация.</p>
<p>Функция NAT теперь настолько часто используется в интегрированных сетевых устройствах для дома и небольших компаний, что некоторые полагают, будто для настройки нужно только установить соответствующий флажок. По мере расширения бизнеса и возникновения потребности в более сложных шлюзах и маршрутизаторах, настройка устройств для использования NAT усложняется [7].</p>

<a name="ch10"></a>
<p class="title">5.10 Маски подсетей</strong></p>
<a name="ch10.1"></a>
<p class="title">5.10.1 Представление масок</strong></p>
<p>Чтобы использовать разделение сети на подсети для создания иерархической модели, необходимо четко понимать структуру маски подсети.</p>
<p>Маска подсети указывает, находятся ли узлы в одной и той же сети. Маска подсети - это 32-битное значение для различения битов сети и битов узлов. Она состоит из строки единиц, за которой следует строка нулей. Единицы соответствуют сети, а нули - узлу.</p>
<p>В адресах класса А используется маска подсети по умолчанию вида 255.0.0.0 или запись с косой чертой вида /8.</p>
<p>В адресах класса B используется маска по умолчанию вида 255.255.0.0 или /15.</p>
<p>В адресах класса С используется маска по умолчанию вида 255.255.255.0 или /24.</p>
<p>Запись /x означает число битов в маске подсети, составляющую сетевую часть адреса.</p>
<p>В корпоративной сети маски подсети различаются длиной. Сегменты сети ЛВС часто содержат разное число узлов, следовательно, неэффективно использовать маску подсети одной и той же длины для всех создаваемых подсетей.</p>
<center><img src="./img/chapter5/5.143.jpg" border="0" alt="Image not found"></center>
<center>Рисунок 5.143 – Представление маски подсети и число возможных узлов</center>
<p>Чтобы вычислить количество узлов, нужно возвести число 2 в степень, равную количеству доступных битов узла, а затем вычесть из полученного числа 2.</p>

<a name="ch10.2"></a>
<p class="title">5.10.2 Расчет подсетей с использованием двоичного представления</strong></p>
<p>Для обмена данными между узлами IP-адрес и маска подсети узла-отправителя сравнивается с IP-адресом и маской подсети узла назначения. Это позволяет определить, находятся ли два адреса в одной и той же локальной сети.</p>
<p>Маска подсети - это 32-битное значение для различения битов сети и битов узла в IP-адресе. Маска подсети состоит из строки единиц, за которой следует строка нулей. Единицы указывают число сетевых битов, а нули - число битов узла в IP-адресе. Сравниваются сетевые биты адреса отправителя и адреса назначения. Если оказывается, что они находятся в одной и той же сети, то пакет можно доставить локально. Если они не совпадают, то пакет направляется на шлюз по умолчанию.</p>
<p>Например, предположим, что необходимо передать сообщения с узла Н1, имеющего IP-адрес 192.168.1.44 и маску подсети 255.255.255.0 или /24, на узел Н2, имеющий IP-адрес 192.168.1.66 и маску подсети 255.255.255.0. В этом случае оба узла используют маску подсети по умолчанию, равную 255.255.255.0, что означает, что сетевые биты заканчиваются на границе третьего октета. На обоих узлах используются одинаковые сетевые биты 192.168.1, следовательно, они находятся в одной и той же сети.</p>
<center><img src="./img/chapter5/5.144.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.144 – Процесс определения принадлежности У1 и У2 к одной сети. Часть 1</center>
<center><img src="./img/chapter5/5.145.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.145 – Процесс определения принадлежности У1 и У2 к одной сети. Часть 2</center>


<p>Хотя достаточно легко определить сетевую и узловую части IP-адреса, когда маска подсети заканчивается на границе сети, процесс определения сетевых битов выполняется точно так же, даже если сетевая часть составляет не целый октет. Например, IP-адрес узла Н1 - 192.168.13.21 с маской подсети 255.255.255.248, или /29. Это означает, что из 32 битов 29 образуют сетевую часть адреса. Сетевые биты содержатся в первых трех октетах и части четвертого октета. В этом случае значение идентификатора сети - 192.168.13.15.</p>
<p>Чтобы узел Н1 с IP-адресом 192.168.13.21/29 мог обмениваться данными с другим узлом, Н2, с адресом 192.168.13.25/29, необходимо сравнивать сетевую часть адреса этих двух узлов, чтобы определить, находятся ли они в одной и той же локальной сети. В этом случае сетевое значение узла Н1 составляет 192.168.13.16, а сетевое значение узла Н2 - 192.168.13.24. Узлы Н1 и Н2 расположены в разных сетях, и для обмена данными между ними необходимо использовать маршрутизатор [5].</p>
<center><img src="./img/chapter5/5.145.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.146 – Определение принадлежности У1 к одной сети</center>
<center><img src="./img/chapter5/5.147.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.147 – Определение принадлежности У2 к одной сети</center>

<a name="ch10.3"></a>
<p class="title">5.10.3 Процесс базового разбиения на подсети</strong></p>
<p>Используя схему иерархической адресации, можно многое узнать, глядя на IP-адрес и запись маски подсети косой чертой (/х). Например, IP-адрес 192.168.1.75 /26 содержит следующие сведения:</p>
<ul>
<li>1)	Десятичная маска подсети. Обозначение /26 означает маску подсети 255.255.255.192.</li>
<li>2)	Число создаваемых подсетей. Например, если начато с маски подсети по умолчанию /24, то тогда 2 дополнительных бита узла заимствованы для сети. Это позволяет создать 4 подсети (2^2 = 4).</li>
<li>3)	Число узлов, пригодных для использования в каждой подсети. Шесть битов оставлены для узла, что дает 62 узла в каждой подсети (2^6 = 64 - 2 = 62).</li>
<li>4)	Сетевой адрес. Используя маску подсети для определения размещения сетевых битов, можно получить значение сетевого адреса. В этом примере это значение равно 192.168.1.64.</li>
<li>5)	Первый применимый адрес узла. Среди битов узла не могут содержаться все нули, поскольку они соответствуют сетевому адресу подсети. Следовательно, первым применимым адресом узла в подсети .64 будет .65.</li>
<li>6)	Широковещательный адрес. Среди битов узла не могут содержаться все единицы, поскольку они соответствуют широковещательному адресу подсети. В этом случае в качестве адреса широковещательной рассылки используется .127. Сетевой адрес следующей подсети начинается с .128.</li>
</ul>
<center><img src="./img/chapter5/5.148.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.148 – Пример схемы адресации для четырех сетей</center>
<a name="ch10.4"></a>
<p class="title">5.10.4 Маски подсети переменной длины (VLSM)</strong></p>
<p>Базового разбиения на подсети достаточно для небольших сетей, но оно не обеспечивает гибкости, необходимой для крупных корпоративных сетей.</p>
<p>Маски подсети переменной длины (VLSM) (технология, используемая для задания различных масок подсети для одного основного номера сети с целью идентификации различных подсетей. VLSM может помочь оптимизировать доступное пространство IP-адресов) обеспечивают эффективное использование адресного пространства. Они также позволяют использовать иерархическую IP-адресацию, за счет которой маршрутизаторы могут эффективно применять суммирование маршрутов (объединение маршрутов - консолидация объявленных адресов в таблице маршрутизации. Объединение маршрутов уменьшает число маршрутов в таблице маршрутизации, трафик обновления маршрутизации и полные издержки маршрута. Объединение маршрутов известно также под названием “агрегирование маршрутов”). Суммирование маршрутов снижает размер таблиц маршрутизации в распределительных и основных маршрутизаторах. При уменьшении размера таблиц маршрутизации ЦПУ требуется меньше времени для поиска маршрутов.</p>
<p>VLSM - это концепция, используемая при разделении подсети на подсети. Они были изначально разработаны для повышения эффективности адресации. С внедрением частной адресации основное преимущество VLSM в настоящее время - организация и объединение.</p>
<p>VLSM поддерживается не всеми протоколами маршрутизации. Классовые протоколы маршрутизации (например, RIPv1) не включают поле маски подсети на обновление маршрутизации. Если маска подсети назначена интерфейсу маршрутизатора, он считает, что всем пакетам одного класса назначена одна и та же маска подсети.</p>
<p>Бесклассовые протоколы маршрутизации поддерживают использование VLSM, поскольку маска подсети передается со всеми пакетами с обновлением маршрутизации. К бесклассовым протоколам маршрутизации относятся RIPv2, EIGRP и OSPF.</p>
<p>Преимущества VLSM:</p>
<ul>
<li>позволяет эффективно использовать адресное пространство</li>
<li>позволяет использовать маски подсети разной длины</li>
<li>разбивает блок адресов на менее крупные блоки</li>
<li>позволяет суммировать маршруты</li>
<li>обеспечивает большую гибкость при конструировании сети</li>
<li>поддерживает иерархические корпоративные сети</li>
</ul>
<center><img src="./img/chapter5/5.149.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.149 – Пример разбиения сети на подсети</center>
<p>VLSM позволяет использовать для каждой подсети свою маску. После разделения сетевого адреса на подсети при дальнейшем дроблении этих подсетей создаются под-подсети.</p>
<p>Например, сеть 10.0.0.0/8 с маской подсети /16 делится на 256 подсетей, каждая из которых может поддерживать 16 382 узла.</p>
<ul>
<li>10.0.0.0/16</li>
<li>10.1.0.0/16</li>
<li>10.2.0.0/16 до 10.255.0.0/16</li>
</ul>
<p>Применив маску подсети /24 к любой из этих подсетей /16 (например, 10.1.0.0/16), можно получить разбиение на 256 подсетей. В каждой из этих новых подсетей можно поддерживать 254 узла.</p>
<ul>
<li>10.1.1.0/24</li>
<li>10.1.2.0/24</li>
<li>10.1.3.0/24 до 10.1.255.0/24</li>
</ul>
<p>Применив маску подсети /28 к любой из этих подсетей /24 (например, 10.1.3.0/28), можно получить разбиение на 16 подсетей. В каждой из этих новых подсетей можно поддерживать 14 узлов. </p>
<ul>
<li>10.1.3.0/28</li>
<li>10.1.3.16/28</li>
<li>10.1.3.32/28 до 10.1.3.240/28</li>
</ul>
<center><img src="./img/chapter5/5.150.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.150 – Применение  VLSM. Часть 1</center>
<center><img src="./img/chapter5/5.151.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.151 – Применение  VLSM. Часть 2</center>
<center><img src="./img/chapter5/5.152.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.152 – Применение  VLSM. Часть 3</center>

<a name="ch10.5"></a>
<p class="title">5.10.5 Внедрение адресации VLSM</strong></p>
<p>Конструирование схемы IP-адресации с использованием VLSM требует опыта и планирования. В этом практическом упражнении к сети предъявляются следующие требования:</p>
<ul>
<li>главный офис в Атланте = 58 адресов узлов;</li>
<li>главный офис в Перте = 26 адресов узлов;</li>
<li>главный офис в Сиднее = 10 адресов узлов;</li>
<li>главный офис в Корпус-Кристи = 10 адресов узлов;</li>
<li>каналы связи через сети WAN = 2 адреса узлов (каждый).</li>
</ul>
<p>Для поддержки самого большого участка сети, состоящего из 58 узлов, необходима подсеть /25. Использование схемы базового разбиения на подсети просто нерационально, поскольку в результате создается только четыре подсети. Этого недостаточно для выделения адресов для каждого из семи необходимых сегментов сети LAN/WAN. Использование схемы адресации VLSM решает эту проблему.</p>
<center><img src="./img/chapter5/5.153.jpg" border="0" vspace="15" alt="Image not found"></center>
<p class="img">Рисунок 5.153 – Проектирование схемы адресации для крупной сети</p>


<p>При реализации схемы разбиения на подсети VLSM, планируя требования к подсети, всегда следует учитывать возможное увеличение числа узлов. Следует перечислить требования к сетям, от самых крупных к самым мелким [10].</p>
<center><img src="./img/chapter5/5.154.jpg" border="0" vspace="15" alt="Image not found"></center>
<p class="img">Рисунок 5.154 – Инструкция по расчету и применению схемы адресации VLSM. Часть 1</p>
<center><img src="./img/chapter5/5.155.jpg" border="0" vspace="15" alt="Image not found"></center>
<p class="img">Рисунок 5.155 – Инструкция по расчету и применению схемы адресации VLSM. Часть 2</p>
<center><img src="./img/chapter5/5.155.jpg" border="0" vspace="15" alt="Image not found"></center>
<p class="img">Рисунок 5.156 – Инструкция по расчету и применению схемы адресации VLSM. Часть 3</p>
<center><img src="./img/chapter5/5.157.jpg" border="0" vspace="15" alt="Image not found"></center>
<p class="img">Рисунок 5.157 – Инструкция по расчету и применению схемы адресации VLSM. Часть 4</p>
<center><img src="./img/chapter5/5.158.jpg" border="0" vspace="15" alt="Image not found"></center>
<p class="img">Рисунок 5.158 – Инструкция по расчету и применению схемы адресации VLSM. Часть 5</p>


<p>Для помощи при планировании адресации существует множество инструментальных средств.</p>
<p>1)	Схема VLSM. В одном из методов используется схема VLSM, чтобы определить, какие блоки адресов доступны и какие из них уже назначены.</p>
<p>2)	Круг VLSM. В другом методе используется подход круга. Круг делится на все уменьшающиеся сегменты, соответствующие более мелким подсетям.</p>
<p>Эти методы предотвращают назначение уже выделенных адресов. Они также позволяют избежать назначения перекрывающихся диапазонов адресов.</p>
<center><img src="./img/chapter5/5.159.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.159 – Диапазон адресов класса С</center>


<a name="ch11"></a>
<p class="title">5.11 Классовая и бесклассовая маршрутизация</strong></p>
<p>Такие технологии, как VLSM, позволяют преобразовать систему классовой адресации IPv4 в бесклассовую систему. Бесклассовая адресация сделала возможным экспоненциальные темпы роста Интернета.</p>
<p>Классовые адреса состоят из трех основных классов IP-адресов и связанной маски подсети по умолчанию:</p>
<ul>
<li>Класс A (255.0.0.0 или /8).</li>
<li>Класс B (255.255.0.0 или /16).</li>
<li>Класс C (255.255.255.0 или /24).</li>
</ul>
<p>В компании, использующей сетевые адреса класса А, доступно более 16 миллионов адресов узлов. При использовании сетевых адресов класса В доступно 65 000 узлов, а класса С - только 254 узла. Поскольку в обращении имеется ограниченное число адресов классов А и В, многие компании приобретают несколько адресов класса С, чтобы иметь достаточное количество адресов для удовлетворения потребностей своих сетей.</p>
<p>В результате приобретение огромного количества адресов класса С привело к исчерпанию адресного пространства класса С быстрее, чем изначально планировалось.</p>
<center><img src="./img/chapter5/5.160.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.160 – Число сетей и узлов на сеть для каждого класса</center>
<p>В классовых IP-адресах значение первого октета (первых трех битов) определяет, является ли главная сеть сетью класса A, B или C. В каждой главной сети используется маска подсети по умолчанию 255.0.0.0, 255.255.0.0 или 255.255.255.0 соответственно.</p>
<p>Классовые протоколы маршрутизации (например, RIPv1) не включают поле маски подсети с обновлением маршрутизации. Поскольку маска подсети не включена, получающий маршрутизатор делает определенные предположения.</p>
<p>Если при использовании классового протокола маршрутизатор передает обновление о сети, разделенной на подсети, например, 172.15.1.0/24, на маршрутизатор, соединяющий интерфейс которого расположен в той же самой главной сети, что и обновление (например, 172.15.2.0/24), тогда:</p>
<ul>
<li>передающий маршрутизатор объявляет полный сетевой адрес, но не объявляет маску подсети. В этом случае адрес сети - 172.15.1.0;</li>
<li>принимающий маршрутизатор, на котором настроен интерфейс 172.15.2.0/24, использует маску подсети настроенного интерфейса и применяет его к объявленной сети. Следовательно, в этом примере принимающий маршрутизатор делает предположение, что маска подсети 255.255.255.0 относится к сети 172.15.1.0.</li>
</ul>
<p>Если маршрутизатор передает обновление о сети, разделенной на подсети, например, 172.15.1.0/24, на маршрутизатор, соединяющий интерфейс которого расположен в другой главной сети (например, 192.168.1.0/24), то</p>
<ul>
<li>передающий маршрутизатор объявляет только адрес главной классовой сети, а не адрес в подсети. В этом случае объявляемый адрес сети - 172.15.0.0;</li>
<li>принимающий маршрутизатор делает предположение о маске подсети по умолчанию для этой сети. Маска подсети по умолчанию для адреса класса B - 255.255.0.0.</li>
</ul>
<center><img src="./img/chapter5/5.161.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.161 – Обновление классовой маршрутизации от маршрутизатора R1до маршрутизатора R2</center>
<center><img src="./img/chapter5/5.162.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.162 – Обновление классовой маршрутизации от маршрутизатора R1до маршрутизатора R2</center>


<p>С учетом быстрого истощения адресов IPv4 инженерная группа по развитию Интернета (IETF) (группа по развитию состоит из более чем 80 рабочих групп, отвечающих за развитие стандартов Интернет. IETF является частью Общества Интернет) создала технологию бесклассовой маршрутизации внутри домена (CIDR) (бесклассовая маршрутизация. Технология, основанная на агрегировании маршрута и поддерживаемая четвертой версией протокола BGP, который позволяет маршрутизаторам группировать маршруты для уменьшения количества данных, пересылаемых магистральными маршрутизаторами. При использовании бесклассовой маршрутизации внутри домена группа IP-сетей представляется для сетей вне группы как единой целое). В CIDR адресное пространство IPv4 используется более эффективно для агрегации или объединения адресов, что позволяет снизить размер таблиц маршрутизации.</p>
<p>Для использования CIDR необходим протокол бесклассовой маршрутизации (стандарт, который определяет правила пересылки данных о маске подсети со всеми пакетами обновления маршрутизации. Протокол бесклассовой маршрутизации необходим в случаях,когда маска является недопустимой или не может быть опеределена по значению первого октета. Протоколами бесклассовой маршрутизации являются протокола RIPv2, EIGRP и OSPF) (например, RIPv2 или EIGRP) или статическая маршрутизация. Для маршрутизаторов, совместимых с технологией CIDR, понятие класса адреса не используется. Маска подсети сети определяет сетевую часть адреса. Она также называется сетевым префиксом или длиной префикса (идентифицирует число бит, использующиеся в сети, длина префикса также известна под названием “сетевой префикс”). Сетевой адрес больше не определяется классом адреса.</p>
<p>ПУИ назначают блоки IP-адресов сетям на основе требований клиентов, которые варьируются от нескольких узлов до сотен и тысяч узлов. Используя CIDR и VLSM, ПУИ больше не должны в качестве длины префикса использовать только /8, /16 или /24.</p>
<center><img src="./img/chapter5/5.163.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.163 – Блоки IP-адресов сетей</center>
<p>К протоколам бесклассовой маршрутизации, которые могут поддерживать VLSM и CIDR, относятся протоколы внутреннего шлюза RIPv2, EIGRP, OSPF и IS-IS. ПУИ также используют протоколы внешних шлюзов, такие как протокол BGP.</p>
<p>Отличие протоколов классовой и бесклассовой маршрутизации заключается в том, что протоколы бесклассовой маршрутизации включают в обновления маршрутизации сведения о маске подсети и о сетевых адресах. Протоколы бесклассовой маршрутизации необходимы, когда маску нельзя вычислить или определить по значению первого октета.</p>
<p>Если в бесклассовом протоколе маршрутизатор передает обновление о сети (например, 172.15.1.0) на маршрутизатор, соединяющий интерфейс которого расположен в той же самой главной сети, что и обновление (например, 172.15.2.0/24), тогда</p>
<ul>
<li>передающий маршрутизатор объявляет все подсети вместе со сведениями о маске подсети. [9]</li>
</ul>
<p>Если маршрутизатор передает обновление о сети, разделенной на подсети (например, 172.15.1.0/24) на маршрутизатор, соединяющий интерфейс которого расположен в другой главной сети (например, 192.168.1.0/24), то</p>
<ul>
<li>передающий маршрутизатор по умолчанию объединяет все подсети и объявляет главную классовую сеть. Этот процесс часто называется объединением на границе сети. Хотя большинство протоколов бесклассовой маршрутизации допускает объединение на границе сети по умолчанию, процесс объединения можно отключить;</li>
<li>при отключении объединения передающий маршрутизатор объявляет все подсети вместе со сведениями о маске подсети.</li>
</ul>
<center><img src="./img/chapter5/5.164.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.164 – Пример бесклассового протокола. Часть 1</center>
<center><img src="./img/chapter5/5.165.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.165 – Пример бесклассового протокола. Часть 2</center>
<center><img src="./img/chapter5/5.165.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.166 – Пример бесклассового протокола. Часть 3</center>
<center><img src="./img/chapter5/5.167.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.167 – Пример бесклассового протокола. Часть 4</center>


<a name="ch12"></a>
<p class="title">5.12 CIDR и суммирование маршрутов</strong></p>
<a name="ch12.1"></a>
<p class="title">5.12.1 Понятие агрегирования маршрутов</strong></p>
<p>Быстрый рост сети Интернет привел к значительному увеличению числа маршрутизаторов в сетях во всем мире. Этот рост привел к большой нагрузке на маршрутизаторы сети Интернет. Схема адресации VLSM позволяет использовать объединение маршрутов, что сокращает число объявляемых маршрутизаторов.</p>
<p>При объединении маршрутов происходит группировка смежных сетей или подсетей с использованием единого адреса. Объединение маршрутов, также называемое агрегированием маршрутов (объединение маршрутов), происходит на границе сети (место, в котором происходит объединение маршрутов в пограничном маршрутизаторе) на пограничном маршрутизаторе.</p>
<p>Объединение сокращает число записей в обновлениях маршрутизации и записей в локальных таблицах маршрутизации. Оно также снижает использование полосы пропускания для обновлений маршрутизации и приводит к ускорению поиска в таблицах маршрутизации.</p>
<p>Термин “объединение маршрутов” означает то же самое, что и организация суперсетей (процесс объединения адресов смежного класса, изданных Сообществом Интернет. Примером организации суперсети является случай, когда группа адресов класса С с 200.100.15.0 по 200.100.31.0 объединяется в адрес 200.100.15.0 с маской 25.255.224.0. Также известна под названием бесклассовая маршрутизация между доменами). Процесс организации суперсетей противоположен процессу разделения сети на подсети. Он позволяет объединить несколько более мелких смежных сетей вместе.</p>
<p>Если сетевые биты превышают значение по умолчанию для этого класса, то это соответствует подсети. В качестве примера рассмотрим адрес 172.15.3.0/25. Для адреса класса В, если значение любого сетевого префикса превышает /16, то это – подсеть.</p>
<p>Если сетевые биты меньше, чем значение по умолчанию для этого класса, то это соответствует суперсети. В качестве примера рассмотрим адрес 172.15.0.0/14. Для адреса класса В сетевой префикс меньше /16 соответствует суперсети.</p>
<center><img src="./img/chapter5/5.168.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.168 – Пример объединения маршрутов</center>
<p>Пограничный маршрутизатор объявляет ПУИ все известные сети внутри предприятия. При наличии восьми разных сетей маршрутизатор должен объявить все восемь. Если бы каждое предприятие следовало этому правилу, это бы привело к огромным таблицам маршрутизации у ПУИ.</p>
<p>Используя объединение маршрутов, маршрутизатор группирует смежные сети вместе и объявляет их как одну большую группу. Например, в телефонной книге компании используется единый список для главного офиса, но при этом можно позвонить непосредственно на добавочный номер каждого сотрудника.</p>
<p>Объединение выполнить проще, если используется иерархическая схема адресации. Чтобы группировать сети предприятия с использованием CIDR, следует назначить ему сходные сети [10].</p>
<center><img src="./img/chapter5/5.169.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.169 – Расчет суммарного маршрута</center>

<a name="ch12.2"></a>
<p class="title">5.12.2 Расчет объединения маршрутов</strong></p>
<p>Чтобы рассчитать объединенный маршрут, необходимо объединить сети в единый адрес. Этот процесс выполняется в три этапа.</p>
<p>Шаг 1. Перечислите сети в двоичном формате.</p>
<p>Шаг 2. Подсчитайте число самых левых совпадающих битов для определения маски для объединенного маршрута. Это число соответствует сетевому префиксу или маске подсети для объединенного маршрута. В качестве примера можно привести /14 или 255.252.0.0.</p>
<p>Шаг 3. Определите адрес объединенной сети. Скопируйте совпадающие биты, а затем добавьте нулевые биты в конец. Быстрее всего использовать наименьшее сетевое значение. </p>
<p>Если не используется смежная иерархическая схема адресации, объединение маршрутов может оказаться невозможным. Если сетевые адреса не имеют общих битов слева направо, объединенную маску применить невозможно.</p>
<center><img src="./img/chapter5/5.170.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.170 – Процесс объединения маршрутов. Часть 1</center>
<center><img src="./img/chapter5/5.171.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.171 – Процесс объединения маршрутов. Часть 2</center>
<center><img src="./img/chapter5/5.172.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.172 – Процесс объединения маршрутов. Часть 3</center>

<a name="ch12.3"></a>
<p class="title">5.12.3 Несмежные сети</strong></p>
<p>Администратор настраивает объединение маршрутов вручную, или эта функция выполняется автоматически с использованием протокола маршрутизации. К примерам протоколов маршрутизации, выполняющих автоматическое объединение, относятся протоколы RIPv1 и EIGRP. Важно контролировать процесс объединения, чтобы маршрутизаторы не объявляли неверные сети.</p>
<p>Предположим, что три маршрутизатора используются для подсоединения к интерфейсам Ethernet, используя адреса с подсетями сетей класса С (например, 192.168.3.0). Три маршрутизатора также подключены друг к другу через последовательные интерфейсы, настроенные с использованием другой главной сети (например, 172.15.100.0/24). Классовая маршрутизация приводит к тому, что каждый маршрутизатор объявляет главную сеть класса С без маски подсети. В результате средний маршрутизатор получает объявления об одной и той же сети из двух разных направлений. Такой сценарий называется несмежной сетью (адрес в сети, который отделен сетью или подсетью от другой сети).</p>
<p>Несмежные сети вызывают ненадежную или неоптимальную маршрутизацию. Для избегания этой ситуации администратор может:</p>
<ul>
<li>изменить, по возможности, схему адресации;</li>
<li>использовать протокол бесклассовой маршрутизации (например, RIPv2 или OSPF);</li>
<li>отключить автоматическое объединение;</li>
<li>вручную выполнить объединение на границе класса.</li>
</ul>
<center><img src="./img/chapter5/5.173.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.173 – Несмежные сети</center>

<a name="ch13"></a>
<p class="title">5.13 Протокол IP шестой версии  (IPv6)</strong></p>
<a name="ch13.1"></a>
<p class="title">5.13.1 Возможности протокола IPv6</strong></p>
<p>IP-протокол версии 6 - стандарт сетевого уровня для сетевого взаимодействия пакетов, на который в конечном итоге перейдут все узлы TCP/IP. В этой версии используется 128-битовая структура адресации. Протокол IPv6 является наследником протокола IPv4 для общего использования в сети Интернет.</p>
<p>Разделение сетей на подсети, частная IP-адресация и преобразование NAT разработаны для того, чтобы временно решить проблему нехватки IP-адресов. Эти методы, хотя и оказались полезными, не увеличили количество IP-адресов. В качестве ответа на дефицит адресов в 1998 году был предложен протокол IPv6 (IP-протокол версии 6 - стандарт сетевого уровня для сетевого взаимодействия с коммутацией пакетов, на который в конечном итоге перейдут все узлы TCP/IP. В этой версии используется 128-битовая структрура адресации. Протокол IPv6 является наследником протокола IPv4 для общего использования в сети Интернет), описанный в документе RFC 2460.</p>
<p>Хотя первоначально таким образом предполагалось решить проблему нехватки IP-адресов IPv4, были и другие причины его появления. С момента первоначальной стандартизации IPv4 Интернет заметно разросся. При этом обнаружились преимущества и недостатки протокола IPv4, а также пути обновления и добавления новых возможностей [3].</p>
<p>Вот общий список улучшений, предложенных в IPv6:</p>
<ul>
<li>расширение адресного пространства;</li>
<li>более совершенное управление адресным пространством;</li>
<li>упрощенное управление TCP/IP;</li>
<li>модернизация функций маршрутизации;</li>
<li>усовершенствованная поддержка многоадресных рассылок, безопасности и мобильности.</li>
</ul>
<p>При разработке IPv6 предполагалось решить как можно больше таких проблем.</p>
<center><img src="./img/chapter5/5.174.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.174 – Стандарты IP-сетей</center>
<p>В IPv6 используются 128-битные IP-адреса, а возможный размер адресного пространства составляет 2^128. В десятичном выражении это, приблизительно, 3 с 38 нулями. Если адресное пространство IPv4 представить в виде маленького детского шарика, то пространство IPv6 — это нечто размером с планету Сатурн.</p>
<p>Работать со 128-битными числами сложно, поэтому в адресах IPv6 128 бит представлены в виде 32 шестнадцатеричных чисел, разделенных на восемь групп, в каждой группе 4 шестнадцатеричных числа, и разделителем между группами является двоеточие. Адреса IPv6 состоят из трех частей. Первые три блока адреса занимает глобальный префикс, присвоенный организации регистратором доменных имен в Интернете. Идентификаторы подсети и интерфейса присваивает администратор сети.</p>
<p>Сетевым администраторам потребуется какое-то время, чтобы приспособиться к новой структуре IPv5. До того, как IPv6 станет общепринятым стандартом, администраторам еще будет нужен способ более эффективного использования частных адресных пространств.</p>
<center><img src="./img/chapter5/5.175.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.175 – Получение адреса IPv5. Часть 1</center>
<center><img src="./img/chapter5/5.175.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.176 - Получение адреса IPv5. Часть 2</center>
<center><img src="./img/chapter5/5.177.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.177 - Получение адреса IPv5. Часть 3</center>
<center><img src="./img/chapter5/5.178.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.178 - Получение адреса IPv5. Часть 4</center>
<center><img src="./img/chapter5/5.179.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.179 - Получение адреса IPv5. Часть 5</center>

<a name="ch13.2"></a>
<p class="title">5.13.2 Сравнение адресации по протоколам IPv4 и IPv6</strong></p>
<p>Адресное пространство IPv4 предусматривает примерно 4,3 миллиарда адресов. Из этого адресного пространства примерно 3,7 миллиарда адресов фактически могут быть назначены. Другие адреса зарезервированы для специальных целей, например, для многоадресной рассылки (одиночные пакеты, копируемые сетью и пересылаемые в заданную подсеть сетевых адресов. Адреса многоадресной рассылки определены в поле адреса назначения), частного адресного пространства, тестирования обратной связи и исследований. Диапазонов адресов IPv4, доступных для назначения, не много. Некоторые ПУИ постепенно начинают назначения адресов IPv5.</p>
<p>Адрес IPv6 - это128-битовое двоичное значение, которое может быть отображено в виде 32 шестнадцатеричных цифр (система исчисления с основанием 15. Шестнадцатеричное счисление использует цифры от 0 до 9, которые соответствуют их обычному значению, и буквы от А до F, которые представляют значения от 10 до 15. В шестнадцатеричной системе единичному приращению, разряд перед ним кратен 16, например 16^2=256). Он обеспечивает 3,4X 10^38 IP-адресов.</p>
<center><img src="./img/chapter5/5.180.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.180 – Сравнение адресного пространства IPv4 и IPv6</center>
<p>IPv6 предусматривает эффективное усовершенствование IPv4. К числу этих усовершенствований относятся:</p>
<ul>
<li>мобильность и безопасность;</li>
<li>упрощенный заголовок;</li>
<li>форматирование адреса.</li>
</ul>
<p>1)	Мобильность и безопасность. Мобильность  дает возможность людям с устройствами мобильной сети свободно перемещаться в пределах сети. Мобильный IP (мобильный протокол Интернет. Стандарт IETF для сетей на основе протоколов IPv4 и IPv6, который позволяет мобильному устройству перемещаться без разрыва соединения. Мобильность является свойством протокола IPv6) - это стандарт IETF, доступный как для IPv4, так и для IPv5. Этот стандарт позволяет мобильным устройствам без разрывов соединений перемещаться в пределах установленных сетевых подключений. IPv4 не поддерживает этот вид мобильности. Мобильность - это функция протокола IPv5.</p>
<p>IPSec (безопасность IP. Набор открытых стандартов, который обеспечивает конфиденциальность, целостность и аутентификацию данных между узлами обменивающимися данными. IPSec обеспечивает работу сетевых средств защиты на IP-уровне. IPSec  использует IKE для обработки согласования протоколов и алгоритмов на основе локальной политики и для генерации ключей шифрования и проверки подлинности, используемый IPSec. IPSec может защищать один или несколько потоков данных между парами узлов, между парами шлюзов безопасности или между шлюзом безопасности и узлом) - это стандарт IETF для защиты IP-сетей. Он доступен как для IPv4, так и для IPv5. Функции защиты IP-сетей в большой степени идентичны в обеих средах. IPSec лучше интегрирован в протокол IPv6 и может быть включен на любом узле IPv5.</p>
<p>2)	Упрощенный заголовок. Заголовок, используемый в IPv6, повышает эффективность маршрутизации путем сокращения количества записей в таблицах маршрутизации.</p>
<p>С протоколом IPv6 широковещательные рассылки не связаны. В случае с IPv4 создаваемые широковещательные рассылки вызывают высокий уровень трафика в сети. Такой трафик порождает явление, известное как широковещательный шторм, и работа всей сети прекращается. Протокол IPv6 заменяет широковещательные рассылки многоадресными и произвольными.</p>
<center><img src="./img/chapter5/5.181.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.181 – Упрощенный заголовок протокола IPv6</center>
<p>3)	Формирование адреса. Двоеточие отделяет записи друг от друга в рядах из восьми 16-битовых шестнадцатеричных полей, представляющих адреса IPv5. Шестнадцатеричные цифры А, В, С, D, Е и F, присутствующие в адресах IPv6, нечувствительны к регистру.</p>
<p>В отличие от IPv4, формат строки IPve-адреса не постоянен. Для представлений строк IРv6-адресов применяются следующие правила:</p>
<ul>
<li>начальные 0 в поле необязательны - 09С0 равно 9С0, а 0000 равно 0;</li>
<li>одна или несколько групп 0 могут быть опущены или заменены “::”- только одно “::”допустимое в адресе;</li>
<li>неопределенный адрес обозначается “::” поскольку содержит только 0.</li>
</ul>
<p>С помощью обозначения “::” значительно сокращается размер большинства адресов. Например, FF01:0:0:0:0:0:0:1 становится FF01::1. Это форматирование противопоставляется 32-битовому десятичному представлению IPv4 с точками. Основной тип IPv6-адреса называется одноадресной рассылкой (сообщение, отправляемое по сети одному получателю).</p>
<p>При одноадресной рассылке пакеты отправляются одному конкретному устройству на конкретный адрес. При многоадресных рассылках пакет отправляется каждому члену группы. При адресации любому устройству группы пакет отправляется одному любому члену группы устройств, которому назначен адрес произвольной рассылки. Для большей эффективности при отправке пакета на адрес произвольной рассылки он доставляется на ближайший интерфейс. По этой причине адрес произвольной рассылки может также рассматриваться как адрес типа “один из ближайших”.</p>
<center><img src="./img/chapter5/5.182.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.182– Представление адресов IPv6</center>
<ul>
<li>глобальный;</li>
<li>зарезервированный (частный, обратной связи, неопределенный).</li>
</ul>
<p>Глобальные адреса одноадресной рассылки. Узел IPv6 является эквивалентом зарегистрированного адреса узла IPv4. Зарегистрированные адреса узлов IPv6 называются глобальными адресами одноадресной рассылки. Блок глобальных адресов одноадресной рассылки имеет структуру, которая позволяет объединять префиксы маршрутизации (шаблон для сопоставления некторых маршрутов в таблице маршрутизации). При таком объединении сокращается число записей в таблице маршрутизации. Объединение глобальных адресов одноадресной рассылки выполняется снизу вверх через организации вплоть до ПУИ.</p>
<p>Зарезервированные адреса. IETF резервирует часть адресного пространства IPv6 для различных целей. В отличие от IPv4 протокол IPv6 поддерживает значительно большее число зарезервированных адресов. Протокоп IPv6 резервирует 1/256-ую часть от общего адресного пространства IPv5. Некоторые другие типы адресов IPv6 происходят из этого блока, например, частные адреса и адреса обратной связи.</p>
<p>Подобно IPv4, блок адресов IPv6 оставлен для частных адресов. У частных адресов значение первого октета FE имеет шестнадцатеричное представление. Следующая шестнадцатеричная цифра-значение от 8 до F [1].</p>
<center><img src="./img/chapter5/5.183.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.183 – Адреса одноадресной и многоадресной рассылки протокола IPv6</center>
<a name="ch13.3"></a>
<p class="title">5.13.3 Переход от протокола IPv4 к IPv6</strong></p>
<p>Множество вариантов перехода. Существует несколько способов интеграции структуры IPv6 в существующую сеть IPv4. Переход от протокола IPv4 к IPv6 вовсе не обязательно делать за один раз. Тремя наиболее распространенными способами перехода являются:</p>
<ul>
<li>двойной стек (две похожие системы протоколов, работающие одновременно на одном устройстве. Например, стратегия для перехода с протокола IPv4 на протокол IPv6 заключается в одновременном использовании обоих стеков протоколов на одном и том же устройстве. Это позволяет одновременно сосуществовать протоколам IPv4 и IPv6);</li>
<li>туннелирование (метод передачи данных через сети, в которых используются разные протоколы. С помощью туннелирования пакеты данных инкапсулируются для формирования новых пакетов, которые соответствуют протоколам, используемым в промежуточных сетях);</li>
<li>передача и трансляция.</li>
</ul>
<p>При переходе с помощью двойного стека в сетевом устройстве реализуются сразу две конфигурации протокола: IPv4 и IPv5. Оба стека протокола работают на одном устройстве. Этот способ позволяет протоколам IPv4 и IPv6 существовать одновременно.</p>
<p>Туннелирование - это способ, который становится все более популярным по мере распространения IPv5. Туннелирование предполагает инкапсуляцию пакета одного протокола в другой протокол. Например, пакет IPv6 можно инкапсулировать в протокол IPv4. Существует множество способов туннелирования между протоколами IPv6 и IPv4. Некоторые из них требуют настройки вручную, другие - более автоматические.</p>
<p>ОС Cisco IOS выпусков 12.3(2)T и выше включает трансляцию сетевых адресов-преобразование протоколов (NAT-PT) (устройство, расположенное между сеть IPv6 и сетью IPv4 для трансляции пакетов IPv6 в пакеты IPv4 и обратно) между IPv6 и IPv4. Такое преобразование предполагает прямую связь между узлами, использующими разные версии IP-протокола.
Полный глобальный переход от протокола IPv4 к IPv6 в ближайшем будущем может и не состояться. Однако IPv6 уже интегрирован в некоторых частях мира, где адреса IPv4 были выработаны ранее.</p>
<center><img src="./img/chapter5/5.184.jpg" border="0" vspace="15" alt="Image not found"></center>
<center>Рисунок 5.184 – Двойной стек</center>


    <p class="title">Контрольные вопросы для закрепления изученного материала</p>
<ol>
<li> Назовите основное назначение протокола IP.</li>
<li> Перечислите классы IP-адресов и маски подсети по умолчанию.</li>
<li>Что такое публичные и частные IP-адреса?</li>
<li> Укажите, в чем преимущество использование масок для разбиение сети на подсети?</li>
<li>В чем заключается преобразование IP-адресов (NAT)?</li>
</ol>

</BODY>
</HTML>