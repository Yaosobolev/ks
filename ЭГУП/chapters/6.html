<HTML>

	<TITLE>Глава 6. Введение в маршрутизацию</TITLE>

<HEAD>
  <link rel="stylesheet" type="text/css" href="../css/style.css">
</HEAD>

<BODY>

	<p class="main-title">6 Введение в маршрутизацию</p>

    <a name="ch1"></a>
	<p class="title">6.1 Применение протоколов маршрутизации</p>
    <a name="ch1.1"></a>
	<p class="title">6.1.1 Основы маршрутизации</p>

	<p>В процессе развития внутренней сети предприятия может появиться необходимость разбиения сети на множество более мелких фрагментов, что обычно связано с решением организационных задач или с требованиями безопасности. Такое разделение сети реализуется с помощью создания нескольких подсетей. Разбиение на подсети подразумевает использование маршрутизатора, который управляет передачей данных из одной подсети в другую.</p>
	<p>При передаче пакетов через сети от источника к назначению маршрутизатор использует таблицы, которые содержат сведения о сетях, подключенных локально, и интерфейсах, через которые осуществляется подключение. Каждый из интерфейсов подключен к разным IP-сегментам сети.</p>
	<p>Маршрутизатор принимает решение о маршрутизации на основе информации, хранящейся в таблице маршрутизации. В таблицах маршрутизации также содержатся сведения о маршрутах или путях, по которым маршрутизатор связывается с удаленными сетями, не подключенными локально.</p>
	<p>Эти маршруты могут назначаться администратором статически или выделяться маршрутизатору динамически, посредством другого маршрутизатора или программного протокола маршрутизации [12].</p>

	<center><img src="./img/chapter6/6.1.jpg"></center>
	<p class="img">Рисунок 6.1 &ndash; Использование маршрутизатором таблицы маршрутизации для выбора оптимального маршрута для пакета. Часть 1</p>
	<center><img src="./img/chapter6/6.2.jpg"></center>
	<p class="img">Рисунок 6.2 &ndash; Использование маршрутизатором таблицы маршрутизации для выбора оптимального маршрута для пакета. Часть 2</p>
	<center><img src="./img/chapter6/6.3.jpg"></center>
	<p class="img">Рисунок 6.3 &ndash; Использование маршрутизатором таблицы маршрутизации для выбора оптимального маршрута для пакета. Часть 3</p>
	<center><img src="./img/chapter6/6.4.jpg"></center>
	<p class="img">Рисунок 6.4 &ndash; Использование маршрутизатором таблицы маршрутизации для выбора оптимального маршрута для пакета. Часть 4</p>
	<center><img src="./img/chapter6/6.5.jpg"></center>
	<p class="img">Рисунок 6.5 &ndash; Использование маршрутизатором таблицы маршрутизации для выбора оптимального маршрута для пакета. Часть 5</p>
	<center><img src="./img/chapter6/6.6.jpg"></center>
	<p class="img">Рисунок 6.6 &ndash; Использование маршрутизатором таблицы маршрутизации для выбора оптимального маршрута для пакета. Часть 6</p>
	<center><img src="./img/chapter6/6.7.jpg"></center>
	<p class="img">Рисунок 6.7 &ndash; Использование маршрутизатором таблицы маршрутизации для выбора оптимального маршрута для пакета. Часть 7</p>
	<center><img src="./img/chapter6/6.8.jpg"></center>
	<p class="img">Рисунок 6.8 &ndash; Использование маршрутизатором таблицы маршрутизации для выбора оптимального маршрута для пакета. Часть 8</p>
	<center><img src="./img/chapter6/6.9.jpg"></center>
	<p class="img">Рисунок 6.9 &ndash; Использование маршрутизатором таблицы маршрутизации для выбора оптимального маршрута для пакета. Часть 9</p>
	<center><img src="./img/chapter6/6.10.jpg"></center>
	<p class="img">Рисунок 6.10 &ndash; Использование маршрутизатором таблицы маршрутизации для выбора оптимального маршрута для пакета. Часть 10</p>


	<p>Каждый маршрутизатор принимает решения о направлении пересылки пакетов на основании таблицы маршрутизации. Таблица маршрутизации содержит набор правил. Каждое правило в наборе описывает шлюз или интерфейс, используемый маршрутизатором для доступа к определенной сети.</p>
	<p>Маршрут состоит из четырех основных компонентов:</p>
	<ul type="square">
		<li>значение получателя;</li>
		<li>маска подсети;</li>
		<li>адрес шлюза или интерфейса;</li>
		<li>стоимость маршрута (значение, обычно определяемое на основе числа переходов, пропускной способности передающей среды и других критериев и присваиваемое сетевым администратором. Используется для сравнения различных путей через межсетевую среду) или метрика маршрута.</li>
	</ul>

	<p>Чтобы переслать пакет получателю, маршрутизатор извлекает IP-адрес получателя из пакета и находит соответствующее правило в таблице маршрутизации. Затем производится поиск соответствующего получателя в таблице маршрутизации.</p>
	<p>Значения получателей в таблице маршрутизации соответствуют адресам сетей получателей. Следует обратить внимание на то, что IP-адрес получателя в пакете состоит из двух частей - адреса подсети и адреса узла. Чтобы определить наличие маршрута к IP-адресу получателя в таблице, маршрутизатор должен найти соответствие между IP-адресом сети и одним из значений в таблице маршрутизации. Для этого маршрутизатор должен определить, какие биты IP-адреса относятся к адресу подсети, а какие - как адресу узла.</p>
	<p>Маршрутизатор просматривает значения маски подсети в каждом из потенциальных маршрутов в таблице. Маршрутизатор применяет каждую из масок подсети к IP-адресу получателя в пакете и сравнивает полученный адрес сети с адресами отдельных маршрутов в таблице: при обнаружении совпадающего адреса пакет пересылается на соответствующий интерфейс или к соответствующему шлюзу; если адрес сети соответствует нескольким маршрутам в таблице маршрутизации, маршрутизатор использует маршрут с наиболее точным или наиболее длинным совпадающим фрагментом адреса сети.</p>
	<p>Иногда для одной сети адресата существует несколько маршрутов с равной стоимостью: маршрут, используемый маршрутизатором, выбирается на основе правил протокола маршрутизации;</p>
	<p>В отсутствие совпадающих маршрутов маршрутизатор направляет сообщение на шлюз, указанный в маршруте по умолчанию, если он настроен. В других случаях пакет просто игнорируется [13].</p>

	<center><img src="./img/chapter6/6.11.jpg"></center>
	<p class="img">Рисунок 6.11 &ndash; Использование маршрутизатором сетевого адреса для выбора оптимального маршрута для пакета. Шаг 1. Применяет маску подсети</p>
	<center><img src="./img/chapter6/6.12.jpg"></center>
	<p class="img">Рисунок 6.12 &ndash; Использование маршрутизатором сетевого адреса для выбора оптимального маршрута для пакета. Шаг 2. Просматривает таблицу маршрутизации</p>
	<center><img src="./img/chapter6/6.13.jpg"></center>
	<p class="img">Рисунок 6.13 &ndash; Использование маршрутизатором сетевого адреса для выбора оптимального маршрута для пакета. Шаг 3. Передает пакет</p>



	<p>В таблице маршрутизации могут содержаться маршруты нескольких типов:</p>
	<ol>
		<li>Прямые маршруты. При включении питания маршрутизатора активируются настроенные интерфейсы. После выхода этих интерфейсов в рабочий режим маршрутизатор будет хранить адреса непосредственно подключенных локальных сетей в виде прямых маршрутов в таблице маршрутизации. В маршрутизаторах Cisco такие маршруты обозначаются в таблице маршрутизации префиксом C. Они автоматически обновляются при перенастройке или отключении маршрута.</li>
		<li>Статические маршруты. Сетевой администратор может вручную настроить статический маршрут в конкретную сеть. Статические маршруты не изменяются до тех пор, пока администратор не перенастроит их вручную. В таблице маршрутизации эти маршруты обозначаются буквой S.</li>
		<li>Динамические (динамически обновляемые) маршруты. Динамические маршруты автоматически создаются и обновляются протоколами маршрутизации. Протоколы маршрутизации реализуются в программах, которые выполняются на маршрутизаторах и осуществляют обмен сведениями о маршрутизации с другими маршрутизаторами в сети. Динамически обновляемые маршруты обозначаются в таблице маршрутизации приставкой, характеризующей тип протокола, создавшего маршрут. Например, R обозначает протокол маршрутной информации (RIP) (стандарт маршрутизации на базе векторов расстояния, который использует число переходов в качестве матрицы маршрутизации).</li>
		<li>Маршрут по умолчанию. Для сетей, путь к которым отсутствует в таблице маршрутизации, используется шлюз, указанный в маршруте по умолчанию. Обычно маршруты по умолчанию указывают следующий маршрутизатор на пути к ISP. Сетевой адрес и маска подсети обозначаются как 0.0.0.0, в результате чего получается маршрут четырех нулей. Если в подсети присутствует только один маршрутизатор, он автоматически выбирается для маршрута по умолчанию, поскольку обмен трафиком с локальной сетью в обоих направлениях может осуществляться только через него.</li>
	</ol>

	<p>В таблицах маршрутизации отсутствует сквозная информация обо всех путях от исходной сети к сети назначения. В этой таблице содержатся только данные о следующем переходе по этому пути. Следующим переходом обычно является непосредственно подключенная сеть, сведения о которой находятся в таблице маршрутизации.</p>
	<p>При использовании статического маршрута следующий переход может быть любым IP-адресом, если он доступен для этого маршрутизатора. В итоге сообщение передается на маршрутизатор, непосредственно подключенный к узлу-адресату, после чего сообщение считается доставленным. Информация о маршрутизации между всеми промежуточными маршрутизаторами по этому пути представляется в виде сетевых адресов, а не определенных узлов. Только для последнего маршрутизатора адрес назначения в таблице маршрутизации указывает не на сеть, а на определенный узел [14].</p>

	<center><img src="./img/chapter6/6.14.jpg"></center>
	<p class="img">Рисунок 6.14 &ndash; Таблица маршрутизации, содержащая различные типы маршрутов</p>
	<a name="ch1.2"></a>
	<p class="title">6.1.2 Протоколы маршрутизации</p>

	<p>Маршруты могут меняться весьма резко. Проблемы с кабелями и оборудованием могут привести к недоступности получателей через установленные интерфейсы. Маршрутизаторам необходим способ быстрого обновления маршрутов без участия администратора.</p>
	<p>Для динамического управления информацией, поступающей с собственных интерфейсов и других маршрутизаторов, маршрутизаторы используют протоколы маршрутизации. Можно также настроить протоколы маршрутизации для управления маршрутами, заданными вручную.</p>
	<p>Динамическая маршрутизация позволяет исключить трудоемкую процедуру настройки статических маршрутов. Динамическая маршрутизация позволяет маршрутизаторам реагировать на изменения в сети и корректировать таблицы маршрутизации без вмешательства сетевого администратора.</p>
	<p>Протокол динамической маршрутизации определяет все доступные маршруты, помещает наилучшие маршруты в таблицу маршрутизации и удаляет маршруты, ставшие недействительными. Способ, которым протокол маршрутизации определяет наилучший маршрут к сети назначения, называется алгоритмом маршрутизации (математическая формула и процедуры для определения оптимального маршрута трафика от конкретного источника к конкретному адресату). Алгоритмы маршрутизации подразделяются на два класса: вектор расстояния (класс алгоритма маршрутизации, используемый всеми маршрутизаторами при передаче узлам всей сети различной информации посредством широковещательных или многоадресных рассылок. Маршрутизатор, настроенный с протоколом маршрутизации на основе векторов расстояний, оценивает расстояние и направление до пункта назначения для выбора наилучшего маршрута) и маршрутизация на основе состояния канала (класс алгоритма маршрутизации, который обновляет информацию о соседних устройствах в соответствии с изменениями в топологии сети с использованием информации о состоянии каналов. Информация о состоянии каналов включает IP-адрес интерфейса и маску подсети, статус канала, тип сети, стоимость канала и соседние маршрутизаторы на данном канале. Маршрутизатор, настроенный с использованием протокола маршрутизации на основе состояния каналов, оценивает стоимость канала в направлении пункта назначения для выбора наилучшего пути). Каждый из них предполагает использование различных методов для определения оптимального маршрута в сеть назначения. </p>
	<p>При каждом изменении топологии сети в результате изменения конфигурации или сбоя также требуется перестройка таблиц маршрутизации в точном соответствии с новой топологией. Состояние обновления всех маршрутизаторов в сети с учетом нового маршрута называется схождением маршрутизаторов.</p>
	<p>Тип используемого алгоритма маршрутизации очень важен для динамической маршрутизации. Для обмена маршрутами между двумя маршрутизаторами необходимо, чтобы они оба использовали один протокол и, следовательно, один алгоритм маршрутизации.</p>

	<center><img src="./img/chapter6/6.15.jpg"></center>
	<p class="img">Рисунок 6.15 &ndash; Использование маршрутизаторами протоколов маршрутизации для получения информации об удаленных сетях. Часть 1</p>
	<center><img src="./img/chapter6/6.16.jpg"></center>
	<p class="img">Рисунок 6.16 &ndash; Использование маршрутизаторами протоколов маршрутизации для получения информации об удаленных сетях. Часть 2</p>
	<center><img src="./img/chapter6/6.17.jpg"></center>
	<p class="img">Рисунок 6.17 &ndash; Использование маршрутизаторами протоколов маршрутизации для получения информации об удаленных сетях. Часть 3</p>
	<center><img src="./img/chapter6/6.18.jpg"></center>
	<p class="img">Рисунок 6.18 &ndash; Использование маршрутизаторами протоколов маршрутизации для получения информации об удаленных сетях. Часть 4</p>
	<center><img src="./img/chapter6/6.19.jpg"></center>
	<p class="img">Рисунок 6.19 &ndash; Использование маршрутизаторами протоколов маршрутизации для получения информации об удаленных сетях. Часть 5</p>
	<center><img src="./img/chapter6/6.20.jpg"></center>
	<p class="img">Рисунок 6.20 &ndash; Использование маршрутизаторами протоколов маршрутизации для получения информации об удаленных сетях. Часть 6</p>
	<center><img src="./img/chapter6/6.21.jpg"></center>
	<p class="img">Рисунок 6.21 &ndash; Использование маршрутизаторами протоколов маршрутизации для получения информации об удаленных сетях. Часть 7</p>



	<p>Алгоритм маршрутизации на основе вектора состояния предусматривает периодическую пересылку копий таблицы маршрутизации между маршрутизаторами. для отражения изменений топологии.</p>
	<p>Алгоритм маршрутизации на основе вектора расстояния анализирует информацию, поступающую от других маршрутизаторов, в свете двух основных критериев:</p>

	<ul type="square">
		<li>расстояние &ndash; насколько удалена сеть от данного маршрутизатора;</li>
		<li>вектор &ndash; в каком направлении следует пересылать пакеты для данной сети.</li>
	</ul>

	<p>Расстояние в маршруте представляется стоимостью или метрикой, которая может характеризовать один из следующих параметров:</p>

	<ul type="square">
		<li>число переходов маршрута;</li>
		<li>административные накладные расходы;</li>
		<li>полоса пропускания;</li>
		<li>скорость передачи;</li>
		<li>вероятность задержек;</li>
		<li>надежность.</li>
	</ul>

	<p>Компонент вектора или направления в маршруте представляет собой адрес следующего перехода к сети, указанной в маршруте.</p>
	<p>Аналогией для векторов расстояния могут быть дорожные знаки с указанием направлений на развязках автострад. Знак указывает направление к месту назначения и сообщает расстояние до него. По мере движения по автостраде появляется следующий знак, указывающий на то же место назначения, но расстояние становится короче. Если расстояния сокращаются, трафик следует по оптимальному маршруту [11].</p>

	<center><img src="./img/chapter6/6.22.jpg"></center>
	<p class="img">Рисунок 6.22 &ndash; Маршрутизация на основе вектора состояния</p>

	<p>Каждый маршрутизатор, использующий векторы расстояний, сообщает сведения о маршрутизации своим соседям. Соседние маршрутизаторы являются участниками сети с прямым подключением. Интерфейс, ведущий в каждую сеть с прямым подключением, имеет расстояние, равное 0. </p>
	<p>Каждый маршрутизатор получает таблицу маршрутизации с непосредственно подключенных соседних маршрутизаторов. Для примера, маршрутизатор R2 получает информацию с маршрутизатора R1. Маршрутизатор R2 увеличивает значение метрики (в данном случае - число переходов маршрута) (метрика маршрутизации, которая отслеживает число переходов, проводимых пакетами данных между источником и получателем. Протокол RIP  использует число переходов в качестве своей единственной метрики), отражая тот факт, что теперь путь к сети назначения стал на один переход длиннее. Затем маршрутизатор R2 рассылает новую таблицу маршрутизации своим соседям, включая маршрутизатор R3. Этот поэтапный процесс продолжается во всех направлениях между соседними маршрутизаторами.</p>
	<p>В конечном итоге каждый маршрутизатор получит от соседних маршрутизаторов информацию о других, более удаленных, сетях. Каждой записи сети в таблице маршрутизатора соответствует вектор накопленного расстояния, указывающий удаленность сети в данном направлении.</p>
	<p>Продолжая процесс определения в сети векторов расстояния, маршрутизаторы находят оптимальный путь к сетям, подключенным не напрямую, на основе накопленных метрик от каждого из соседей. Оптимальный путь - это путь с кратчайшим расстоянием или наименьшей метрикой.</p>
	<p>Обновление таблиц маршрутизации также происходит при изменении топологии, например, при добавлении новой сети или выходе из строя маршрутизатора, в результате которого сеть становится недостижима. Как и при обнаружении сетей, обновление топологии происходит поэтапно и состоит в обмене копиями таблиц маршрутизации между маршрутизаторами.</p>

	<center><img src="./img/chapter6/6.23.jpg"></center>
	<p class="img">Рисунок 6.23 &ndash; Работа протокола на базе векторов расстояния. Часть 1</p>
	<center><img src="./img/chapter6/6.24.jpg"></center>
	<p class="img">Рисунок 6.24 &ndash; Работа протокола на базе векторов расстояния. Часть 2</p>
	<center><img src="./img/chapter6/6.25.jpg"></center>
	<p class="img">Рисунок 6.25 &ndash; Работа протокола на базе векторов расстояния. Часть 3</p>
	<center><img src="./img/chapter6/6.26.jpg"></center>
	<p class="img">Рисунок 6.26 &ndash; Работа протокола на базе векторов расстояния. Часть 4</p>
	<center><img src="./img/chapter6/6.27.jpg"></center>
	<p class="img">Рисунок 6.27 &ndash; Работа протокола на базе векторов расстояния. Часть 5</p>
	<center><img src="./img/chapter6/6.28.jpg"></center>
	<p class="img">Рисунок 6.28 &ndash; Работа протокола на базе векторов расстояния. Часть 6</p>
	<center><img src="./img/chapter6/6.29.jpg"></center>
	<p class="img">Рисунок 6.29 &ndash; Работа протокола на базе векторов расстояния. Часть 7</p>
	<center><img src="./img/chapter6/6.30.jpg"></center>
	<p class="img">Рисунок 6.30 &ndash; Работа протокола на базе векторов расстояния. Часть 8</p>
	<center><img src="./img/chapter6/6.31.jpg"></center>
	<p class="img">Рисунок 6.31 &ndash; Работа протокола на базе векторов расстояния. Часть 9</p>
	<center><img src="./img/chapter6/6.32.jpg"></center>
	<p class="img">Рисунок 6.32 &ndash; Работа протокола на базе векторов расстояния. Часть 10</p>
	<center><img src="./img/chapter6/6.33.jpg"></center>
	<p class="img">Рисунок 6.33 &ndash; Работа протокола на базе векторов расстояния. Часть 11</p>


	<a name="ch1.3"></a>
	<p class="title">6.1.3 Общие протоколы внутренней маршрутизации</p>

	<p>Протокол маршрутной информации (RIP) - это протокол маршрутизации на основе векторов расстояния, который нашел широкое применение в тысячах сетей по всему миру. Впервые он был опубликован в рамках документа RFC 1058.</p>
	<p>Основные характеристики RIP:</p>

	<ul type="square">
		<li>RIP является протоколом на основе вектора расстояния;</li>
		<li>использует число переходов в качестве метрики (сведения об алгоритме маршрутизации, используемые для определения наилучшего маршрута в сети. Метрики хранятся в таблице маршрутизации. Метрики содержат сведения о полосе пропускания, стоимости передачи, задержке, числе переходов, нагрузке, максимальном размере передаваемого блока данных, стоимости маршрута и сведения о его надежности) для выбора маршрута;</li>
		<li>относит число переходов выше 15 к недостижимым маршрутам;</li>
		<li>по умолчанию рассылает содержимое таблицы маршрутизации каждые 30 секунд.</li>
	</ul>

	<p>Получив обновление таблицы маршрутизации с новым или изменившимся маршрутом, маршрутизатор отражает эти изменения в своей таблице маршрутизации. На каждом маршрутизаторе при добавлении маршрута в таблицу число переходов увеличивается на единицу. В качестве следующего перехода маршрутизатор использует адрес непосредственно подключенного маршрутизатора в локальной сети, с которого поступило обновление.</p>
	<p>Незамедлительно после обновления таблицы маршрутизации маршрутизатор начинает рассылать обновления маршрутизации, информируя об изменении другие маршрутизаторы в сети. Эти обновления, называемые обновление при изменении (информация обновления, отсылаемая маршрутизатором при изменении в сети), рассылаются независимо от регулярных обновлений, рассылаемых маршрутизаторами, использующими протокол RIP.</p>

	<center><img src="./img/chapter6/6.34.jpg"></center>
	<p class="img">Рисунок 6.34 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 1</p>
	<center><img src="./img/chapter6/6.35.jpg"></center>
	<p class="img">Рисунок 6.35 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 2</p>
	<center><img src="./img/chapter6/6.36.jpg"></center>
	<p class="img">Рисунок 6.36 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 3</p>
	<center><img src="./img/chapter6/6.37.jpg"></center>
	<p class="img">Рисунок 6.37 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 4</p>
	<center><img src="./img/chapter6/6.38.jpg"></center>
	<p class="img">Рисунок 6.38 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 5</p>
	<center><img src="./img/chapter6/6.39.jpg"></center>
	<p class="img">Рисунок 6.39 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 6</p>
	<center><img src="./img/chapter6/6.40.jpg"></center>
	<p class="img">Рисунок 6.40 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 7</p>
	<center><img src="./img/chapter6/6.41.jpg"></center>
	<p class="img">Рисунок 6.41 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 8</p>
	<center><img src="./img/chapter6/6.42.jpg"></center>
	<p class="img">Рисунок 6.42 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 9</p>
	<center><img src="./img/chapter6/6.43.jpg"></center>
	<p class="img">Рисунок 6.43 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 10</p>
	<center><img src="./img/chapter6/6.44.jpg"></center>
	<p class="img">Рисунок 6.44 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 11</p>
	<center><img src="./img/chapter6/6.45.jpg"></center>
	<p class="img">Рисунок 6.45 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 12</p>
	<center><img src="./img/chapter6/6.46.jpg"></center>
	<p class="img">Рисунок 6.46 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 13</p>
	<center><img src="./img/chapter6/6.47.jpg"></center>
	<p class="img">Рисунок 6.47 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 14</p>
	<center><img src="./img/chapter6/6.48.jpg"></center>
	<p class="img">Рисунок 6.48 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 15</p>
	<center><img src="./img/chapter6/6.49.jpg"></center>
	<p class="img">Рисунок 6.49 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 16</p>
	<center><img src="./img/chapter6/6.50.jpg"></center>
	<p class="img">Рисунок 6.50 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 17</p>
	<center><img src="./img/chapter6/6.51.jpg"></center>
	<p class="img">Рисунок 6.51 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 18</p>
	<center><img src="./img/chapter6/6.52.jpg"></center>
	<p class="img">Рисунок 6.52 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 19</p>
	<center><img src="./img/chapter6/6.53.jpg"></center>
	<p class="img">Рисунок 6.53 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 20</p>
	<center><img src="./img/chapter6/6.54.jpg"></center>
	<p class="img">Рисунок 6.54 &ndash; Рассылка обновлений таблиц маршрутизации с использованием протокола RIP. Часть 21</p>


	<a name="ch1.3.1"></a>
	<p class="title">6.1.3.1 Протокол RIP</p>

	<p>Протокол RIP (протокол маршрутной информации. Стандарт маршрутизации на базе векторов расстояния, который использует число переходов в качестве матрицы маршрутизации) имеет простую логику и несложен в реализации. Эти преимущества принесли RIP широкую популярность [12].</p>
	<p>Однако RIP обладает и недостатками:</p>

	<ul type="square">
		<li>допускается не более 15 переходов, т.е. сеть может содержать не более 16 последовательно соединенных маршрутизаторов;</li>
		<li>непосредственно подключенным соседним маршрутизаторам периодически рассылаются полные копии всей таблицы маршрутизации - в крупных сетях каждое обновление может сопровождаться значительным всплеском трафика;</li>
		<li>длительное схождение после изменений в крупных сетях.</li>
	</ul>

	<p>В настоящее время существуют две версии RIP: RIPv1 и RIPv2. RIPv2 имеет ряд преимуществ по сравнению с RIPv1. RIPv1 обычно используется в тех случаях, когда оборудование не поддерживает RIPv2. Наиболее значимым различием двух версий протокола является поддержка бесклассовой маршрутизации в RIPv2 за счет включения маски подсети в обновления маршрутов. RIPv1 не предусматривает отправку масок подсетей в обновлениях и руководствуется масками, принятыми для различных подсетей по умолчанию.</p>

	<center><img src="./img/chapter6/6.55.jpg"></center>
	<p class="img">Рисунок 6.55 &ndash; Недостатки протокола RIP. 15 переходов</p>
	<center><img src="./img/chapter6/6.56.jpg"></center>
	<p class="img">Рисунок 6.56 &ndash; Недостатки протокола RIP. Обновления таблицы маршрутизации</p>
	<center><img src="./img/chapter6/6.57.jpg"></center>
	<p class="img">Рисунок 6.57 &ndash; Недостатки протокола RIP. Медленно сходится</p>


	<a name="ch1.3.2"></a>
	<p class="title">6.1.3.2 Протокол EIGRP</p>

	<p>Усовершенствованный протокол внутренней маршрутизации между шлюзами (EIGRP) (усовершенствованный протокол внутренней маршрутизации между шлюзами. Запатентованный протокол маршрутизации Cisco, который объединяет протокол маршрутизации на базе векторов расстояний и протокол маршрутизации по состоянию канала. Протокол EIGRP использует алгоритм DUAL для определения маршрута. Усовершенствованный протокол внутренней маршрутизации между шлюзами известен также под названием “протокол IGRP”) - это собственный усовершенствованный протокол маршрутизации Cisco с использованием вектора расстояния. EIGRP был разработан с целью преодоления ограничений других протоколов маршрутизации с вектором расстояний, таких как RIP. К этим ограничениям относятся использование числа переходов в качестве метрики и предел в 15 переходов.</p>
	<p>В EIGRP используется несколько метрик, включая значение полосы пропускания, настраиваемое вручную, и задержка при прохождении пакета по конкретному маршруту.</p>
	<p>Протокол EIGRP имеет следующие характеристики:</p>

	<ul type="square">
		<li>расчет стоимости маршрута на основе нескольких метрик;</li>
		<li>возможности протоколов на основе вектора расстояния, связанные со следующим переходом и метрикой, объединены с дополнительными функциями баз данных и обновлений;</li>
		<li>максимальное число переходов - 224.</li>
	</ul>

	<p>В отличие от RIP, EIGRP не ограничивается использованием содержимого таблицы маршрутизации маршрутизатора. Для EIGRP создаются две дополнительные таблицы базы данных: таблица соседних маршрутизаторов и таблица топологии.</p>
	<p>В таблице соседних маршрутизаторов хранятся данные о соседних маршрутизаторах в локальных сетях, подключенных напрямую. Эта таблица содержит такую информацию, как IP-адрес, тип и полоса пропускания интерфейса.</p>
	<p>EIGRP формирует таблицу топологии на основе извещений от соседних маршрутизаторов. Таблица топологии содержит все маршруты, объявленные соседними маршрутизаторами. Для расчета кратчайшего пути по сети к месту назначения в протоколе EIGRP применяется алгоритм диффузионного обновления (алгоритм DUAL) (математический алгоритм, использующий EIGRP-протокол и обеспечивающий отсутствие петель путем непрерывного расчета маршрута. Алгоритм диффузионного обновления позволяет синхронизироваться маршрутизаторам, задействованным в изменении топологии сети, не затрагивая маршрутизаторы, которые не задействованы в изменении топологии сети). Рассчитанный путь помещается в таблицу маршрутизации. Таблица топологии позволяет маршрутизатору, на котором используется протокол EIGRP, определять оптимальный альтернативный маршрут при изменениях в сети. Если в таблице маршрутизации отсутствуют альтернативные маршруты, EIGRP опрашивает соседние маршрутизаторы для нахождения нового маршрута к месту назначения [14].</p>
	<p>В отличие от протокола RIP, предназначенного для небольших сетей, в которых число переходов между маршрутизаторами не превышает 15, протокол EIGRP наилучшим образом подходит для крупных более сложных сетей, объединяющих до 224 переходов и требующих быстрого схождения.</p>

	<center><img src="./img/chapter6/6.58.jpg"></center>
	<p class="img">Рисунок 6.58 &ndash; Обмен данными о маршрутизации при использовании протокола EGRP</p>
	<a name="ch1.3.3"></a>
	<p class="title">6.1.3.3 Протоколы на основе состояния канал</p>

	<p>Маршрутизаторы, использующие алгоритм маршрутизации на основе вектора расстояния, располагают ограниченными сведениями об удаленных сетях и совсем не имеют информации об удаленных маршрутизаторах. Алгоритм маршрутизации, основанный на состоянии канала, ведет полную базу данных об удаленных маршрутизаторах и схеме их соединений.</p>
	<p>В маршрутизации на основе состояния канала присутствуют следующие атрибуты:</p>

	<ul type="square">
		<li>таблица маршрутизации - список известных маршрутов и интерфейсов;</li>
		<li>объявление о состоянии канала (LSA) (пакет широковещательной рассылки, используемый протоколом на базе состояния канала, который содержит сведения о соседях и стоимости маршрута. Эти сведения используются принимающими маршрутизаторами для поддержания таблиц маршрутизации в актуальном состоянии. Объявления о состоянии канала известно также под названием “пакет состояния канала”) - компактный пакет для обмена сведениями о маршрутизации между маршрутизаторами. LSA описывает состояние интерфейсов (каналов связи) маршрутизатора и содержит другие сведения, например IP-адрес каждого канала;</li>
		<li>топологическая база данных (информация, получаемая от маршутизаторов и используемая для построения таблицы маршрутов и определения наилучшего пути к сети назначения) - концентрирует информацию, извлеченную маршрутизатором из всех LSA;</li>
		<li>алгоритм SPF (алгоритм кратчайшего пути) - расчет дерева SPF на основе информации из базы данных. Дерево SPF представляет собой карту сети с точки зрения конкретного маршрутизатора. Содержимое этого дерева используется при построении таблицы маршрутизации.</li>
	</ul>

	<p>При получении LSA с других маршрутизаторов алгоритм SPF путем анализа информации в базе данных создает дерево SPF. Руководствуясь деревом SPF, алгоритм SPF вычисляет кратчайшие пути к другим сетям. При изменении базы данных о состоянии каналов связи, вызванном поступлением нового пакета LSA, алгоритм SPF повторно рассчитывает оптимальные пути и обновляет таблицу маршрутизации.</p>

	<center><img src="./img/chapter6/6.59.jpg"></center>
	<p class="img">Рисунок 6.59 &ndash; Работа протоколов на базе состояния канала. Часть 1</p>
	<center><img src="./img/chapter6/6.60.jpg"></center>
	<p class="img">Рисунок 6.60 &ndash; Работа протоколов на базе состояния канала. Часть 2</p>
	<center><img src="./img/chapter6/6.61.jpg"></center>
	<p class="img">Рисунок 6.61 &ndash; Работа протоколов на базе состояния канала. Часть 3</p>
	<center><img src="./img/chapter6/6.62.jpg"></center>
	<p class="img">Рисунок 6.62 &ndash; Работа протоколов на базе состояния канала. Часть 4</p>
	<center><img src="./img/chapter6/6.63.jpg"></center>
	<p class="img">Рисунок 6.63 &ndash; Работа протоколов на базе состояния канала. Часть 5</p>


	<a name="1.3.4"></a>
	<p class="title">6.1.3.4 OSPF</p>

	<p>Протокол предпочтения кратчайшего пути OSPF (алгоритм маршрутизации для протокола IGP на основе иерархии состоянии канала, который заменил протокол RIP. Протокол OSPF позволяет выполнять маршрутизацию по критерию наименьшей стоимости, маршрутизации с обходными путями и распределение нагрузки) представляет собой открытый протокол маршрутизации на основе состояния каналов связи, описанный в RFC 2328. Его основными характеристиками являются:</p>

	<ul type="square">
		<li>использование алгоритма SPF для расчета пути к месту назначения с наименьшей стоимостью;</li>
		<li>рассылка обновлений маршрутов только при изменении топологии; периодическая рассылка полной таблицы маршрутизации не производится;</li>
		<li>ускоренная сходимость;</li>
		<li>поддержка VLSM и изолированных подсетей;</li>
		<li>аутентификация маршрутов.</li>
	</ul>

	<p>В сетях с поддержкой OSPF маршрутизаторы обмениваются извещениями об изменениях состояния каналов связи, например, о появлении новых подсетей или о сбоях или восстановлении линий связи.</p>
	<p>При изменении топологии сети, например, все маршрутизаторы, на которых влияет данное изменение, рассылают остальным маршрутизаторам сети извещения LSA для обновления маршрутов. Все маршрутизаторы вносят соответствующие изменения в базы данных топологий, перестраивают деревья SPF для поиска кратчайшего пути к каждой сети и обновляют маршруты в своих таблицах маршрутизации.</p>
	<p>Протокол OSPF более требователен к ресурсам маршрутизаторов, таким, как оперативная память и вычислительные мощности процессора, и является сложным сетевым протоколом, требующим от инженерного персонала углубленных знаний [14].</p>

	<center><img src="./img/chapter6/6.64.jpg"></center>
	<p class="img">Рисунок 6.64 &ndash; Работа протокола OSPF</p>
	<a name="ch1.4"></a>
	<p class="title">6.1.4 Маршрутизация в организационных подразделениях</p>

	<p>Каждый протокол маршрутизации использует свою систему метрик. Метрики, используемые в одном протоколе, не применимы в другом. Так как используются различные метрики, два различных протокола маршрутизации могут выбрать различные маршруты к одному и тому же получателю. Например, протокол RIP выбирает путь на основе наименьшего количества переходов сети, а протокол EIGRP руководствуется сведениями о наиболее широкой полосе пропускания каналов связи и наименьшим временем задержки.</p>
	<p>Метрики, используемые протоколами маршрутизации IP, могут основываться на следующих параметрах:</p>

	<ul type="square">
		<li>число переходов - количество маршрутизаторов, через которые предстоит пройти пакету;</li>
		<li>полоса пропускания - “ширина” указанного канала связи;</li>
		<li>загрузка - степень занятости канала трафиком;</li>
		<li>задержка - время, которое требуется для передачи пакета по каналу;</li>
		<li>надежность - вероятность возникновения сбоев связи, рассчитанная на основе статистики прошлых сбоев;</li>
		<li>стоимость - определяется приложением IOS или сетевым администратором для выбора предпочтительного маршрута; стоимость может определять метрику, или комбинацию метрик, или политику.</li>
	</ul>

	<p>Один маршрутизатор может использовать несколько протоколов одновременно. Кроме того, при необходимости сетевые администраторы могут настраивать статические маршруты. Если в результате расчетов по двум различным алгоритмам имеется два различных маршрута к одному получателю, как маршрутизатор решает, какой из них использовать.</p>
	<p>В этой ситуации маршрутизатор использует параметр, который известен как административное расстояние (AD) (объявленное расстояние. Расстояние, для которого широковещательная рассылка выполняется вышестоящим соседом. Административное расстояние. Степень доверия к источнику информации о маршруте. Для маршрутизаторов административное расстояние выражается в виде числового значения от 0 до 255. Чем выше значение, тем ниже степень доверия. Административный домен. Группа узлов, принадлежащих одному домену). Эта величина выражает степень доверия к источнику информации о маршруте. Чем ниже AD, тем больше можно доверять маршруту. Например, статическому маршруту присвоено значение AD, равное 1, а маршрут, рассчитанный по алгоритму RIP, имеет значение AD - 120; при получении двух различных маршрутов к одному получателю маршрутизатор выбирает маршрут с наименьшим значением AD. При наличии выбора между статическим маршрутом и маршрутом, рассчитанным по RIP, выбирается статический маршрут. Кроме того, маршрут в непосредственно подключенную сеть с AD, равным 0, имеет приоритет перед статическим маршрутом с AD, равным 1 [16].</p>

	<center><img src="./img/chapter6/6.65.jpg"></center>
	<p class="img">Рисунок 6.65 &ndash; Административные расстояния различных протоколов маршрутизации</p>

	<p>Иногда необходимо использовать несколько протоколов маршрутизации, например, при слиянии двух уже существующих сетей. Тем не менее, при проектировании новой сети рекомендуется использовать только один протокол маршрутизации для всей сети. Наличие одного протокола упрощает как сопровождение сети, так и поиск неполадок в ней. Выбор протокола маршрутизации может оказаться трудной задачей даже для опытных проектировщиков сетей.</p>
	<p>Статические маршруты бывают приемлемы для небольших сетей только с одним шлюзом в Интернет. В такой топологии динамическая маршрутизация требуется редко.</p>
	<p>По мере роста организации и появления новых маршрутизаторов в топологии можно перейти к использованию протокола RIPv2, не требующему сложной настройки и успешно работающему в небольших сетях. RIP может применяться до тех пор, пока размер сети не превысит 15 маршрутизаторов.</p>
	<p>В более крупных сетях широкое применение нашли протоколы EIGRP и OSPF, однако простых правил для выбора одного из них не существует. При выборе протокола следует рассматривать каждую сеть в отдельности, руководствуясь тремя основными критериями:</p>

	<ul type="square">
		<li>Простота управления. Какую информацию о собственном состоянии хранит протокол.</li>
		<li>Простота настройки. Сколько команд в среднем требуется выполнить для настройки. Можно ли задать одинаковую конфигурацию сразу для нескольких маршрутизаторов в сети.</li>
		<li>Эффективность. Какую долю полосы пропускания отнимает протокол маршрутизации в установившемся режиме и каков верхний предел используемой полосы пропускания при схождении в результате крупных событий.</li>
	</ul>

	<center><img src="./img/chapter6/6.66.jpg"></center>
	<p class="img">Рисунок 6.66 &ndash; Выбор протоколов маршрутизации в зависимости от типа компании. Малые компании</p>
	<center><img src="./img/chapter6/6.67.jpg"></center>
	<p class="img">Рисунок 6.67 &ndash; Выбор протоколов маршрутизации в зависимости от типа компании. Небольшая или средняя компания</p>
	<center><img src="./img/chapter6/6.68.jpg"></center>
	<p class="img">Рисунок 6.68 &ndash; Выбор протоколов маршрутизации в зависимости от типа компании. Средняя компания</p>
	<center><img src="./img/chapter6/6.69.jpg"></center>
	<p class="img">Рисунок 6.69 &ndash; Выбор протоколов маршрутизации в зависимости от типа компании. Крупная компания</p>
	<center><img src="./img/chapter6/6.70.jpg"></center>
	<p class="img">Рисунок 6.70 &ndash; Выбор протоколов маршрутизации в зависимости от типа компании. Очень большая компания</p>
	<center><img src="./img/chapter6/6.71.jpg"></center>
	<p class="img">Рисунок 6.71 &ndash; Выбор протоколов маршрутизации в зависимости от типа компании. Глобальная корпорация</p>


	<a name="ch2"></a>
	<p class="title">6.2 Протоколы внешней маршрутизации</p>
    <a name="ch2.1"></a>
	<p class="title">6.2.1 	Автономные системы</p>

	<p>Архитектура маршрутизации за годы существования Интернета эволюционировала в распределенную систему взаимосвязанных сетей. При сегодняшнем масштабе Интернета и многообразии составляющих его сетей ни одна организация не справится с управлением информацией обо всех маршрутах к каждому получателю в мире.</p>
	<p>Для преодоления этой сложности Интернет поделен на объединения сетей, называемые автономными системами (AS) (объединение сетей с общим администрированием и общей стратегией маршрутизации. Автономные системы подразделяются на области. Автономной  системе должен быть назначен уникальный 16-битный номер, устанавливаемый Комитетом по цифровым адресам в Интернете (IANA)), контролируемые разными независимыми организациями и компаниями.</p>
	<p>AS представляет собой несколько сетей, для которых применяется единая внутренняя политика маршрутизации, в ведении одного административного органа. Идентификатором AS служит уникальный номер автономной системы (ASN) (идентификация AS для использования при маршрутизации пакетов в сети Интернет). ASN в Интернете подчиняются правилам контроля и регистрации.</p>
	<p>Самым распространенным примером AS является поставщик услуг Интернета (ISP). Большинство предприятий, подключенных к Интернету через поставщика услуг Интернета, входят в состав домена маршрутизации этого поставщика. AS администрируется ISP и содержит не только маршруты для собственных сетей, но и маршруты ко всем сетям корпоративных и других клиентов, подключенных к ISP.</p>

	<center><img src="./img/chapter6/6.72.jpg"></center>
	<p class="img">Рисунок 6.72 &ndash; Автономные системы</p>

	<p>Один и тот же номер ASN распространяется на все сетевые устройства в домене маршрутизации AS.</p>
	<p>ISP A представляет собой автономную систему, чей домен маршрутизации включает в себя местное предприятие, напрямую подключенное к ISP для доступа в Интернет. Это предприятие не имеет отдельного ASN, а использует в данных о маршрутизации номер автономной системы ISP A (ASN 100).</p>
	<p>Также на иллюстрации показана крупная корпорация с офисами в Гонконге и Нью-Йорке. Поскольку эти офисы расположены в разных странах, каждый из них для доступа в Интернет подключается к местному поставщику услуг Интернета. Следовательно, корпорация пользуется услугами двух различных ISP. К какой AS и с каким номером ASN она будет принадлежать.</p>
	<p>Наличие двух ISP - B и C, через которые компания подключена к Интернету, создает сложности с организацией маршрутов. Для трафика из Интернета нет информации, на основе которой можно было бы выбрать одну из AS, используемых глобальной корпорацией. Чтобы решить эту проблему, корпорация регистрирует собственную AS, которой присваивается ASN 400.</p>

	<center><img src="./img/chapter6/6.73.jpg"></center>
	<p class="img">Рисунок 6.73 &ndash; Использование нескольких автономных систем</p>
	<a name="ch2.2"></a>



	<p class="title">6.2.2 Маршрутизация через Интернет</p>

	<p>Протоколы внутренних шлюзов (IGP) (Интернет-протокол, используемый для обмена данными маршрутизации в пределах автономной системы. В качестве примера наиболее распространенных Интернет-протоколов IGP можно называть EIGRP, OSPF и RIP) используются для обмена сведениями о маршрутизации с автономной системой или отдельной организацией. Цель протокола внутренней маршрутизации - нахождение оптимального пути во внутренней сети. IGP реализуется внутренними маршрутизаторами, т.е. маршрутизаторами внутри организации. Примеры протоколов внутренних шлюзов - RIP, EIGRP и OSPF.</p>
	<p>В отличие от IGP, протоколы внешних шлюзов (EGP) (стандарт для обмена информацией о маршруте между автономными системами. Протокол внешнего шлюза является устаревшим протоколом, который заменен протоколом BGP) предназначены для обмена информацией между различными автономными системами. Поскольку разные автономные системы находятся в компетенции разных администраторов и могут использовать различные внутренние протоколы, то протокол, применяемый на межсетевом уровне, должен обеспечивать взаимодействие разнородных систем. EGP отвечает за преобразование информации о внешних маршрутах, делая возможной ее успешную обработку в каждой сети автономной системы.</p>
	<p>Протоколы EGP выполняются на внешних маршрутизаторах, Внешние маршрутизаторы также называются граничными шлюзами.</p>
	<p>В отличие от внутренних маршрутизаторов, которые обмениваются друг с другом информацией об отдельных маршрутах по протоколам IGP, внешние маршрутизаторы обмениваются информацией о путях к различным сетям, используя внешние протоколы. Назначение протоколов внешней маршрутизации - поиск оптимального пути через Интернет в виде последовательности автономных систем.</p>
	<p>Самый распространенный внешний протокол маршрутизации в Интернете сегодня - протокол граничного шлюза (BGP) (стандарт внешней маршрутизации, который поддерживает агрегирование маршрутов и используется для подключения поставщика услуг к сети Интернет). По оценкам 95% автономных систем используют BGP. Текущая версия BGP - четвертая (BGP-4), актуальное описание которой содержится в документе RFC 4271.</p>

	<center><img src="./img/chapter6/6.74.jpg"></center>
	<p class="img">Рисунок 6.74 &ndash; Протоколы внутренних и внешних шлюзов</p>

	<p>Каждая автономная система отвечает за информирование других автономных систем о сетях, которые через нее доступны. Обмен этими сведениями о достижимости (мера достижимости сети. Обмен сведениями о достижимости осуществляется посредством протоколов внешней маршрутизации, таких как BGP) осуществляется по протоколам внешней маршрутизации, которые реализуются выделенными маршрутизаторами - граничными шлюзами.</p>
	<p>Маршрутизация пакетов через Интернет осуществляется в несколько этапов:</p>

	<ol>
		<li>Узел-источник отправляет пакет, предназначенный для удаленного узла в другой автономной системе.</li>
		<li>Поскольку IP-адрес адресата пакета находится за пределами локальной сети, внутренние маршрутизаторы продолжают передавать пакет, выбирая маршруты по умолчанию, пока в итоге пакет не достигнет внешнего маршрутизатора на границе локальной автономной системы.</li>
		<li>Внешний маршрутизатор ведет базу данных по всем автономным системам, с которыми он связан. Эта база данных достижимости (характеристика, используемая протоколами маршрутизации для оценки доступности места назначения) сообщает маршрутизатору, что путь к сети адресата проходит через несколько AS и что следующий переход проходит через напрямую подключенный внешний маршрутизатор на соседней автономной системе.</li>
		<li>Внешний маршрутизатор направляет пакет на следующий переход, которым является внешний маршрутизатор в соседней автономной системе.</li>
		<li>Пакет достигает соседней автономной системы, где внешний маршрутизатор обращается к собственной базе данных достижимости и пересылает пакет к следующей автономной системе в пути.</li>
		<li>Процесс повторяется на каждой автономной системе до тех пор, пока внешний маршрутизатор автономной системы-адресата не распознает IP-адрес получателя пакета как относящийся к внутренней сети данной автономной системы [16].</li>
	</ol>

	<center><img src="./img/chapter6/6.75.jpg"></center>
	<p class="img">Рисунок 6.75 &ndash; Передача пакетов в сети Интернет с помощью автономных систем</p>
	<center><img src="./img/chapter6/6.76.jpg"></center>
	<p class="img">Рисунок 6.76 &ndash; Передача пакетов в сети Интернет с помощью автономных систем. Шаг 1</p>
	<center><img src="./img/chapter6/6.77.jpg"></center>
	<p class="img">Рисунок 6.77 &ndash; Передача пакетов в сети Интернет с помощью автономных систем. Шаг 2</p>
	<center><img src="./img/chapter6/6.78.jpg"></center>
	<p class="img">Рисунок 6.78 &ndash; Передача пакетов в сети Интернет с помощью автономных систем. Шаг 3</p>
	<center><img src="./img/chapter6/6.79.jpg"></center>
	<p class="img">Рисунок 6.79 &ndash; Передача пакетов в сети Интернет с помощью автономных систем. Шаг 4</p>
	<center><img src="./img/chapter6/6.80.jpg"></center>
	<p class="img">Рисунок 6.80 &ndash; Передача пакетов в сети Интернет с помощью автономных систем. Шаг 5</p>
	<center><img src="./img/chapter6/6.81.jpg"></center>
	<p class="img">Рисунок 6.81 &ndash; Передача пакетов в сети Интернет с помощью автономных систем. Шаг 6</p>
	<center><img src="./img/chapter6/6.82.jpg"></center>
	<p class="img">Рисунок 6.82 &ndash; Передача пакетов в сети Интернет с помощью автономных систем. Шаг 7</p>


	<a name="ch2.3"></a>
	<p class="title">6.2.3 Протоколы внешней маршрутизации и поставщики услуг Интернета</p>

	<p>Протоколы внешних шлюзов предоставляют много полезных функций для ISP. Внешние протоколы не только позволяют пересылать трафик через Интернет удаленным получателям, они также служат для ISP механизмом установки и реализации политик и локальных настроек, позволяющих оптимизировать пересылку транзитного трафика (пакеты, генерируемые внешними узлами или маршрутизаторами, которые передаются через назначенные автономные системы к другим автономным системам. Граничный шлюз используется для разрешения или запрещения транзитного трафика) через ISP и исключить перегрузку внутренних маршрутов.</p>
	<p>Корпоративные клиенты требуют надежного предоставления услуг доступа в Интернет, и ISP стремятся обеспечить непрерывную работу Интернет-канала для этих клиентов. Для этого они предусматривают запасные маршруты и маршрутизаторы на случай отказа основного маршрута. При нормальной работе ISP сообщает другим автономным системам основной маршрут. Если этот маршрут прекращает функционировать, ISP рассылает по внешнему протоколу сообщение с обновлением маршрута, указывая запасной маршрут.</p>

	<center><img src="./img/chapter6/6.83.jpg"></center>
	<p class="img">Рисунок 6.83 &ndash; Рассылка информации об основных и запасных маршрутах с помощью и протоколов внешних шлюзов</p>

	<p>Передача сообщений в Интернете называется трафиком. Интернет-трафик может быть отнесен к одной из двух категорий.</p>
	<p>Локальный трафик (пакеты, сформированные и направляемые маршрутизаторами и протоколами маршрутизации. Локальный трафик остается в пределах автономной системы) - трафик, пересылаемый внутри автономной системы и изначально возникший в ее пределах или адресованный получателю в пределах этой автономной системы. Аналогия – движение транспорта в пределах улицы.</p>
	<p>Транзитный трафик - трафик, возникший за пределами автономной системы, который может пересылаться по сетям внутри автономной системы получателям за ее пределами. Аналогия - движение транспорта в пределах улицы.</p>
	<p>Пересылка трафика между автономными системами надежно контролируется. Важно иметь возможность ограничения или запрета обмена определенными видами сообщений с автономной системой по соображениям безопасности или для предотвращения перегрузки.</p>
	<p>Многие автономные системы не предназначены для транзитного трафика. Транзитный трафик может привести к перегрузке и выходу из строя маршрутизаторов, если их ресурсов окажется недостаточно для обработки большого объема трафика.</p>

	<center><img src="./img/chapter6/6.84.jpg"></center>
	<p class="img">Рисунок 6.84 &ndash; Передача транзитного трафика</p>
	<a name="ch3"></a>
	<p class="title">6.3 Маршрутизация с помощью протоколов на основе векторов расстояния</p>

	<p>Протоколы динамической маршрутизации подразделяются на две основные категории: протокол векторов расстояния (тип стандартов, которые используют расстояние для выбора наилучшего маршрута. Примерами протокола векторного расстояния могут служить протоколы RIP, IGRP и EIGRP) и протоколы на базе состояния канала (тип стандартов, например OSPF и IS-IS, используемых при иерархическом проектировании сетей. Протоколы на базе состояния канала помогают управлять процессами коммутации пакетов в больших сетях).</p>
	<p>Маршрутизаторы, работающие по протоколам маршрутизации на основе векторов расстояния, совместно используют сведения о сетях с напрямую подключенными соседями. Соседние маршрутизаторы далее передают эти сведения своим соседям, пока они не будут известны всем маршрутизаторам корпоративной сети.</p>
	<p>Маршрутизатор, работающий по протоколу на основе векторов расстояния, не знает весь путь до адреса назначения, ему известно только расстояние до удаленной сети и направление, или вектор (сегмент данных SNA-сообщения. Вектор состоит из поля длины - кода, который описывает тип вектора и данные, относящиеся к вектору). Он получает необходимые сведения от напрямую подключенных соседей.</p>
	<p>Как и все протоколы маршрутизации, протоколы на основе векторов расстояния используют метрику (сведения об алгоритме маршрутизации, используемые для определения наилучшего маршрута в сети. Метрики хранятся в таблице маршрутизации. Метрики содержат сведения о полосе пропускания, стоимости передачи, задержке, числе переходов, нагрузке, максимальном размере передаваемого блока данных, стоимости маршрута и сведения о его надежности) для определения оптимального маршрута. Протоколы на основе векторов расстояния рассчитывают оптимальный маршрут, исходя из расстояния от маршрутизатора до сети. Пример использования метрики - количество переходов, то есть числа маршрутизаторов (переходов) между маршрутизатором и адресом назначения [16].</p>

	<center><img src="./img/chapter6/6.85.jpg"></center>
	<p class="img">Рисунок 6.85 &ndash; Маршрутизация между двумя маршрутизаторами</p>

	<p>Протоколам на основе векторов расстояния обычно требуется менее сложная настройка и управление по сравнению с протоколами на основе состояния канала. Они могут выполняться маршрутизаторами более старых моделей с меньшей мощностью и требуют меньшего объема памяти и вычислений.</p>
	<p>Маршрутизаторы, использующие протоколы на основе векторов расстояния, выполняют широковещательную  или многоадресную (одиночные пакеты, копируемые сетью и пересылаемые в заданную подсеть сетевых адресов. Адреса многоадресной рассылки определенной в поле адреса назначения) рассылку всей таблицы маршрутизации своим соседям через равные интервалы времени. Если маршрутизатор получает более одного маршрута до адреса назначения, он рассчитывает и передает маршрут с наименьшей метрикой.</p>
	<p>Этот способ передачи сведений маршрутизации в больших сетях отличается малой скоростью. В определенный момент у некоторых маршрутизаторов может не быть последних сведений о сети. Это ограничивает масштабируемость протоколов и вызывает проблемы, например, петли маршрутизации.</p>
	<p>Протоколы RIP версии 1 и 2 являются обычными протоколами на основе векторов расстояния, а протокол EIGRP - протоколом на основе векторов расстояния с расширенными возможностями. Протокол RIPng (протокол маршрутной информации следующего поколения. Стандарт маршрутизации на базе векторов расстояния с ограничением до 15 переходов, который использует разделенный горизонт и обратный запрет для предотвращения петель маршрутизации. Стандарт основан на протоколе IPv4 RIPv2 и похож на протокол RIPv2, но использует IPv6 для транспортировки. Адрес группы рассылки FF02::9 идентифицирует все маршрутизаторы, поддерживающие протокол RIPng), новая версия протокола RIP, был специально разработан для поддержки IPv6.</p>

	<center><img src="./img/chapter6/6.86.jpg"></center>
	<p class="img">Рисунок 6.86 &ndash; Преимущества и недостатки маршрутизации с помощью протоколов на основе векторов расстояния</p>
	<a name="ch3.1"></a>
	<p class="title">6.3.1 Протокол RIP</p>
    <a name="ch3.1.1"></a>
	<p class="title">6.3.1.1 Функции протокола RIP</p>

	<p>Протокол RIPv1 был первым и единственным протоколом IP-маршрутизации на ранних этапах развития сетей. Протокол RIPv1 не отправляет сведения о маске подсети в форме обновлений маршрутов, и поэтому не поддерживает VLSM и CIDR.</p>
	<p>Протокол RIPv1 автоматически объединяет сети на классовой границе назначение подсетям единой сети класса А, B или С с помощью протоколов, например, с помощью протокола RIP и EIGRP, трактуя все сети как классы по умолчанию A, B и C. Если сети непрерывные, например, 192.168.1.0, 192.168.2.0 и так далее, это не представляет серьезной проблемы.</p>
	<p>Но если сети являются несмежными, например, сети 192.168.1.0 и 192.168.2.0 разделены сетью 10.0.1.0, протокол RIPv1 не сможет правильно передать маршруты.</p>
	<p>По умолчанию протокол RIPv1 выполняет широковещательную передачу обновлений маршрутов всем подключенным маршрутизаторам через каждые 30 секунд.</p>
	<p>У протокола RIPv2 много функций, схожих с RIPv1. Кроме того, он предусматривает важные усовершенствования. RIPv2 - это протокол бесклассовой маршрутизации (характеристика протокола, позволяющая пересылать маску подсети вместе со всеми пакетами обновления маршрутизации. Протоколами бесклассовой маршрутизации являются протоколы RIPv2, EIGRP и OSPF), который поддерживает VLSM и CIDR. Поле маски подсети включено в обновления версии 2, что позволяет использовать несмежные сети. Кроме того, протокол RIPv2 дает возможность отключить автоматическое объединение маршрутов.</p>
	<p>Обе версии протокола RIP рассылают всю таблицу маршрутизации из всех задействованных интерфейсов в форме обновлений. RIPv1 выполняет широковещательную рассылку этих обновлений для 255.255.255.255. Это требует от всех устройств широковещательной сети (например, сеть Ethernet) обработки данных. RIPv2 выполняет многоадресную рассылку своих обновлений для 224.0.0.9. Многоадресная рассылка предусматривает меньшую пропускную способность, чем широковещательные рассылки. Устройства, не настроенные для работы с протоколом RIPv2, отклоняют многоадресные рассылки на канальном уровне.</p>
	<p>Злоумышленники нередко внедряют неверные обновления, чтобы маршрутизатор отправлял данные на ошибочный адрес назначения или чтобы значительно снизить производительность сети. Неверные сведения также могут оказаться в таблице маршрутизации из-за ошибочной настройки или неисправной работы маршрутизатора. Шифрование сведений маршрутизации защищает содержимое таблицы маршрутизации от маршрутизаторов, не имеющих пароля и учетных данных. Протокол RIPv2 имеет механизм аутентификации, а RIPv1 - нет.</p>
	<p>Несмотря на множество усовершенствований протокола RIPv2, он не является совершенно другим протоколом. Протокол RIPv2 имеет многие из функций RIPv1, например:</p>

	<ul type="square">
		<li>метрику числа переходов;</li>
		<li>максимальное число переходов, равное 15;</li>
		<li>TTL, равное 16 переходам;</li>
		<li>стандартный интервал обновления, равный 30 секундам;</li>
		<li>запрет маршрута (установка метрики маршрута равно 16 для прекращения трафика по маршруту. RIP немедленно посылает обновление по событию, запрещая маршрут), обратный запрет (обновление маршрутизации, которое указывает на невозможность достижения сети или подсети; это не означает, что сеть недостижима, поскольку не будет включаться в обновления. Обновления обратного запрета пересылаются для урегулирования больших петель маршрутизации. Реализация протокола IGRP использует обновления обратного запрета), разделение горизонта (способ маршрутизации, который не допускает образование петель путем запрета передачи пакетов через интерфейс маршрутизатора, в котором они были получены) и удержания (переводит маршрутизатор в состояние, в котором он не будет оповещать о маршрутах, ни  принимать их в течение заданного периода времени, называемого временем удержания. Удержание используется для удаления неверных сведений о маршруте из всех маршрутизаторов в сети. Маршрутизатор обычно переходит в режим удержания при выходе из строя канала в маршруте) во избежание петель;</li>
		<li>обновления с помощью UDP-порта 520;</li>
		<li>административное расстояние, равное 120;</li>
		<li>заголовок сообщения, вмещающий до 25 маршрутов без аутентификации [16]. </li>
	</ul>

	<p>При запуске маршрутизатора каждый интерфейс, настроенный для работы с протоколом RIP, отправляет сообщение запроса (при включении маршрутизатора это сообщение пересылается каждым RIP-интерфейсом для запроса у всех RIP-соседей их таблиц маршрутизации). Это сообщение запрашивает у всех соседей, работающих по протоколу RIP, отправку полных таблиц маршрутизации. Соседи, работающие по протоколу RIP, отправляют сообщение ответа (ответ на сообщение, пересылаемое каждым RIP-настраиваемым интерфейсом, которое содержит запрос у всех RIP-соседей их таблиц маршрутизации) с известными записями о сети. Получающий маршрутизатор оценивает каждый маршрут, исходя из следующих условий:</p>

	<ul type="square">
		<li>если запись маршрута новая, получающий маршрутизатор устанавливает маршрут в таблице маршрутизации;</li>
		<li>если маршрут уже есть в таблице, а запись поступила из другого источника, существующая запись будет заменена в таблице маршрутизации, если число переходов в новой записи лучше;</li>
		<li>если маршрут уже есть в таблице и запись поступила из того же источника, существующая запись будет заменена, даже если метрика не лучше.</li>
	</ul>

	<p>Запущенный маршрутизатор потом отправляет обновление при включении (сообщение, содержащее таблицу маршрутизации маршрутизатора, которая пересылается соседним маршрутизаторам в сети при включении маршрутизатора) со всех интерфейсов, работающих по протоколу RIP и имеющих свои таблицы маршрутизации. Соседи, работающие по протоколу RIP, уведомляются о новых маршрутах.</p>

	<center><img src="./img/chapter6/6.87.jpg"></center>
	<p class="img">Рисунок 6.87 &ndash; Реализация процесса “запрос-отклик” между маршрутизаторами. Часть 1</p>
	<center><img src="./img/chapter6/6.88.jpg"></center>
	<p class="img">Рисунок 6.88 &ndash; Реализация процесса “запрос-отклик” между маршрутизаторами. Часть 2</p>
	<center><img src="./img/chapter6/6.89.jpg"></center>
	<p class="img">Рисунок 6.89 &ndash; Реализация процесса “запрос-отклик” между маршрутизаторами. Часть 3</p>
	<center><img src="./img/chapter6/6.90.jpg"></center>
	<p class="img">Рисунок 6.90 &ndash; Реализация процесса “запрос-отклик” между маршрутизаторами. Часть 4</p>



	<p>При условии, что маршрутизаторы отправляют и обрабатывают надлежащие версии обновлений маршрутов, протоколы RIPv1 и RIPv2 полностью совместимы. По умолчанию протокол RIPv2 отправляет и получает обновления только версии 2. Если в сети необходимо использовать обе версии протокола RIP, администратор сети настраивает протокол RIPv2 для отправки и получения версий 1 и 2. По умолчанию RIPv1 отправляет обновления версии 1, а получает версии 1 и 2.</p>
	<p>В корпоративной сети может понадобиться использование двух версий протокола RIP. Например, в части сети может осуществляться переход на протокол RIPv2, а другая по-прежнему работает с RIPv1. Изменение глобальной конфигурации RIP на режим конкретного интерфейса позволяет маршрутизаторам поддерживать обе версии протокола RIP.</p>


    <a name="ch3.1.2"></a>
    <p class="title">6.3.1.2 Проблемы с протоколом RIP</p>


	<p>При использовании протокола RIP может возникнуть ряд проблем, связанных с производительностью и безопасностью.</p>
	<p>1 Первая проблема касается точности таблицы маршрутизации. Обе версии протокола RIP автоматически объединяют подсети на границе класса. Это означает, что протокол RIP опознает подсети как единую сеть класса A, B или C. В корпоративных сетях обычно используется бесклассовая IP-адресация и несколько подсетей, некоторые из которых не связаны между собой, в результате чего образуются несмежные подсети.</p>
	<p>В отличие от RIPv1 в протоколе RIPv2 функцию автоматического объединения можно отключить. Если функция отключена, RIPv2 будет извещать обо всех подсетях со сведениями маски подсети. Это необходимо для обеспечения точности таблицы маршрутизации.</p>

	<center><img src="./img/chapter6/6.91.jpg"></center>
	<p class="img">Рисунок 6.91 &ndash; Использование протокола RIP без автоматического обновления</p>

	<p>2 Другая проблема &ndash; широковещательный режим обновлений RIP. Как только конфигурация RIP выдает команду network для той или иной сети, протокол RIP сразу же начинает рассылку уведомлений со всех интерфейсов, входящих в эту сеть. Эти обновления могут быть нужны не на всех участках сети. Например, интерфейс локальной сети Ethernet передает эти обновления всем устройствам в своем сетевом сегменте, что создает нецелесообразный трафик. Обновление маршрутов также может быть перехвачено любым устройством. Это делает сеть более уязвимой.</p>
	<p>При ограничении количества интерфейсов, извещающих о маршрутах RIP, повышается безопасность и ужесточается контроль над трафиком.</p>

	<center><img src="./img/chapter6/6.92.jpg"></center>
	<p class="img">Рисунок 6.92 &ndash; Широковещательный режим обновлений RIP</p>

	<p>Сети, использующей протокол RIP, необходимо время для конвергенции. Пока не будут обновлены все маршрутизаторы и у них не будет одного и того же представления сети, некоторые из них могут содержать в таблицах маршрутизации недопустимые маршруты.</p>
	<p>Ошибки в сведениях о сети могут вызвать в обновлениях маршрутов и трафике петли, которые ведут счет до бесконечности (ситуация, при которой маршрутизаторы непрерывно увеличивают число переходов к конкретной сети, когда алгоритм маршрутизации является медленно сходящимся. Обычно, для предотвращения “счета до бесконечности” устанавливается произвольное ограничение сила переходов). В протоколе маршрутизации RIP бесконечность возникает при числе переходов, равном 16.</p>
	<p>Петли маршрутизации отрицательно сказываются на производительности сети. В протоколе RIP предусмотрено несколько функций для устранения этой проблемы. Эти функции часто используются в сочетании:</p>

	<ul type="square">
		<li>обратный запрет (обновление маршрутизации, которое указывает на невозможность достижения сети или подсети; это не означает, что сеть недостижима, поскольку не будет включаться в обновления. Обновления обратного запрета пересылаются для отклонения больших петель маршрутизации. Реализация протокола IGRP использует обновления обратного запрета);</li>
		<li>разделение горизонта (способ маршрутизации, который не допускает образование петель путем запрета передачи пакетов через интерфейс маршрутизатора, в котором они были получены);</li>
		<li>таймер удержания (переводит маршрутизатор в состояние, в котором он не будет ни оповещать о маршрутах, ни принимать их в течение заданного периода времени, называемого временем удержания. Удержание используется для удаления неверных сведений о маршруте из всех маршрутизаторов в сети. Маршрутизатор обычно переходит в режим удержания при выходе из строя канала в маршруте);</li>
		<li>обновления при включении (сообщение, содержащее таблицу маршрутизации маршрутизатора, которая пересылается соседними маршрутизаторами в сети при включении маршрутизатора).</li>
	</ul>

	<p>Обратный запрет определяет для метрики маршрута значение 16, и он становится недостижим. Поскольку протокол RIP определяет бесконечность как 16 переходов, сеть далее 15 переходов недостижима. Если сеть становится неактивной, маршрутизатор изменяет метрику для этого маршрута на 16, чтобы для всех других маршрутизаторов она была недостижима. Эта функция предотвращает отправку сведений протоколом маршрутизации по запретным маршрутам.</p>

	<center><img src="./img/chapter6/6.93.jpg"></center>
	<p class="img">Рисунок 6.93 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Петля маршрутизации. Часть 1</p>
	<center><img src="./img/chapter6/6.94.jpg"></center>
	<p class="img">Рисунок 6.94 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Петля маршрутизации. Часть 2</p>
	<center><img src="./img/chapter6/6.95.jpg"></center>
	<p class="img">Рисунок 6.95 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Петля маршрутизации. Часть 3</p>
	<center><img src="./img/chapter6/6.96.jpg"></center>
	<p class="img">Рисунок 6.96 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Петля маршрутизации. Часть 4</p>
	<center><img src="./img/chapter6/6.97.jpg"></center>
	<p class="img">Рисунок 6.97 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Петля маршрутизации. Часть 5</p>
	<center><img src="./img/chapter6/6.98.jpg"></center>
	<p class="img">Рисунок 6.98 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Петля маршрутизации. Часть 6</p>
	<center><img src="./img/chapter6/6.99.jpg"></center>
	<p class="img">Рисунок 6.99 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Петля маршрутизации. Часть 7</p>
	<center><img src="./img/chapter6/6.100.jpg"></center>
	<p class="img">Рисунок 6.100 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Петля маршрутизации. Часть 8</p>

	<center><img src="./img/chapter6/6.101.jpg"></center>
	<p class="img">Рисунок 6.101 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 1</p>
	<center><img src="./img/chapter6/6.102.jpg"></center>
	<p class="img">Рисунок 6.102 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 2</p>
	<center><img src="./img/chapter6/6.103.jpg"></center>
	<p class="img">Рисунок 6.103 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 3</p>
	<center><img src="./img/chapter6/6.104.jpg"></center>
	<p class="img">Рисунок 6.104 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 4</p>
	<center><img src="./img/chapter6/6.105.jpg"></center>
	<p class="img">Рисунок 6.105 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 5</p>
	<center><img src="./img/chapter6/6.106.jpg"></center>
	<p class="img">Рисунок 6.106 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 6</p>
	<center><img src="./img/chapter6/6.107.jpg"></center>
	<p class="img">Рисунок 6.107 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 7</p>
	<center><img src="./img/chapter6/6.108.jpg"></center>
	<p class="img">Рисунок 6.108 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 8</p>
	<center><img src="./img/chapter6/6.109.jpg"></center>
	<p class="img">Рисунок 6.109 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 9</p>
	<center><img src="./img/chapter6/6.110.jpg"></center>
	<p class="img">Рисунок 6.110 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 10</p>
	<center><img src="./img/chapter6/6.111.jpg"></center>
	<p class="img">Рисунок 6.111 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 11</p>
	<center><img src="./img/chapter6/6.112.jpg"></center>
	<p class="img">Рисунок 6.112 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 12</p>
	<center><img src="./img/chapter6/6.113.jpg"></center>
	<p class="img">Рисунок 6.113 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 13</p>
	<center><img src="./img/chapter6/6.114.jpg"></center>
	<p class="img">Рисунок 6.114 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 14</p>
	<center><img src="./img/chapter6/6.115.jpg"></center>
	<p class="img">Рисунок 6.115 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 15</p>
	<center><img src="./img/chapter6/6.116.jpg"></center>
	<p class="img">Рисунок 6.116 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 16</p>
	<center><img src="./img/chapter6/6.117.jpg"></center>
	<p class="img">Рисунок 6.117 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 17</p>
	<center><img src="./img/chapter6/6.118.jpg"></center>
	<p class="img">Рисунок 6.118 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Счет до бесконечности. Часть 18</p>



	<p>Противопетельная функция в протоколе RIP увеличивает его стабильность, но увеличивает и время конвергенции.</p>
	<p>Разделение горизонта предотвращает образование петель. При передаче несколькими маршрутизаторами друг другу одних и тех же маршрутов в сети могут образовываться петли маршрутизации. Разделение горизонта требует, чтобы маршрутизатор, получающий сведения маршрутизации для интерфейса, не мог отправить обновление для той же сети из этого же интерфейса.</p>
	<p>Таймер удержания стабилизирует маршруты. Таймер удержания отказывается принимать обновления маршрутов с большей метрикой для той же сети назначения на период, когда маршрут становится неактивным. Если в течение времени удержания (переводит маршрутизатор в состояние, в котором он не будет ни оповещать о маршрутах, ни принимать их в течение заданного периода времени, называемого временем удержания. Удержание используется для удаления неверных сведений о маршруте из всех маршрутизаторов в сети. Маршрутизатор обычно переходит в режим удержания при выходе из строя канала в маршруте) исходный маршрут снова становится активным или маршрутизатор получает сведения о маршруте с более низкой метрикой, маршрутизатор устанавливает маршрут в таблице маршрутизации и немедленно начинает им пользоваться [12].</p>
	<p>Время удержания по умолчанию равно 180 секундам, в шесть раз больше стандартного периода обновления. Значение по умолчанию можно изменить. Однако любой период удержания увеличивает время конвергенции и отрицательно отражается на производительности сети.</p>
	<p>Если возникает ошибка маршрута, протокол RIP не будет ждать следующего периодического обновления. Вместо этого RIP отправляет немедленное обновление, называемое обновлением при включении. Оно извещает об ошибочном маршруте, увеличив метрику до 16 и, тем самым, налагая на него запрет. Это обновление присваивает маршруту статус удержания, в то время как протокол RIP пытается обнаружить альтернативный маршрут с лучшей метрикой.</p>

	<center><img src="./img/chapter6/6.119.jpg"></center>
	<p class="img">Рисунок 6.119 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Разделение горизонта. Часть 1</p>
	<center><img src="./img/chapter6/6.120.jpg"></center>
	<p class="img">Рисунок 6.120 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Разделение горизонта. Часть 2</p>
	<center><img src="./img/chapter6/6.121.jpg"></center>
	<p class="img">Рисунок 6.121 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Разделение горизонта. Часть 3</p>
	<center><img src="./img/chapter6/6.122.jpg"></center>
	<p class="img">Рисунок 6.122 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Разделение горизонта. Часть 4</p>
	<center><img src="./img/chapter6/6.123.jpg"></center>
	<p class="img">Рисунок 6.123 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Разделение горизонта. Часть 5</p>
	<center><img src="./img/chapter6/6.124.jpg"></center>
	<p class="img">Рисунок 6.124 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Разделение горизонта. Часть 6</p>
	<center><img src="./img/chapter6/6.125.jpg"></center>
	<p class="img">Рисунок 6.125 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Разделение горизонта. Часть 7</p>

	<center><img src="./img/chapter6/6.126.jpg"></center>
	<p class="img">Рисунок 6.126 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Таймер удержания. Часть 1</p>
	<center><img src="./img/chapter6/6.127.jpg"></center>
	<p class="img">Рисунок 6.127 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Таймер удержания. Часть 2</p>
	<center><img src="./img/chapter6/6.128.jpg"></center>
	<p class="img">Рисунок 6.128 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Таймер удержания. Часть 3</p>
	<center><img src="./img/chapter6/6.129.jpg"></center>
	<p class="img">Рисунок 6.129 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Таймер удержания. Часть 4</p>
	<center><img src="./img/chapter6/6.130.jpg"></center>
	<p class="img">Рисунок 6.130 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Таймер удержания. Часть 5</p>
	<center><img src="./img/chapter6/6.131.jpg"></center>
	<p class="img">Рисунок 6.131 &ndash; Проблемы конвергенции сети при использовании протокола RIP. Таймер удержания. Часть 6</p>



	<p>Протокол маршрутизации на основе векторов расстояния прост в настройке и требует минимальное количество ресурсов маршрутизаторов для работы.</p>
	<p>Однако упрощенная метрика числа переходов, используемая протоколом RIP, &ndash; это не самый точный способ определения оптимального пути в сложных сетях. Кроме того, из-за ограничения протокола RIP в 15 переходов дальние сети могут определяться как недостижимые.</p>
	<p>Протокол RIP выполняет периодические обновления таблицы маршрутизации, занимая полосу пропускания, даже если изменений в сети не было. Маршрутизаторы должны принять и обработать эти обновления, чтобы определить, содержат ли они сведения об обновленных маршрутах.</p>
	<p>Передаваемым от маршрутизатора к маршрутизатору обновлениям необходимо время, чтобы достичь всех областей сети. В результате маршрутизаторы могут располагать неточным представлением о сети. Из-за большого времени конвергенции могут образовываться петли маршрутизации, расходуя ценную пропускную способность.</p>
	<p>Перечисленные свойства ограничивают применимость протокола маршрутизации RIP в корпоративной среде.</p>

	<center><img src="./img/chapter6/6.132.jpg"></center>
	<p class="img">Рисунок 6.132 &ndash; Ограничения для метрики числа переходов RIP. Часть 1</p>
	<center><img src="./img/chapter6/6.133.jpg"></center>
	<p class="img">Рисунок 6.133 &ndash; Ограничения для метрики числа переходов RIP. Часть 2</p>
	<center><img src="./img/chapter6/6.134.jpg"></center>
	<p class="img">Рисунок 6.134 &ndash; Ограничения для метрики числа переходов RIP. Часть 3</p>
	<center><img src="./img/chapter6/6.135.jpg"></center>
	<p class="img">Рисунок 6.135 &ndash; Ограничения для метрики числа переходов RIP. Часть 4</p>
	<center><img src="./img/chapter6/6.136.jpg"></center>
	<p class="img">Рисунок 6.136 &ndash; Ограничения для метрики числа переходов RIP. Часть 5</p>


	<a name="ch3.2"></a>
	<p class="title">6.3.2 Усовершенствованный протокол внутренней маршрутизации между шлюзами (EIGRP)</p>
	<a name="ch3.2.1"></a>
	<p class="title">6.3.2.1 Функции протокола EIGRP</p>

	<p>Ограничения протокола RIP привели к разработке более усовершенствованных протоколов. Специалистам по сетям необходим был протокол с поддержкой VLSM и CIDR, легкой масштабируемостью и малым временем конвергенции в сложных корпоративных сетях.</p>
	<p>И в компании Cisco разработали собственный протокол маршрутизации на основе векторов расстояния - протокол EIGRP. Он наделен расширенными возможностями, устраняющими многие ограничения других протоколов на основе векторов расстояния. Помимо ряда функций, общих с протоколом RIP, протокол EIGRP имеет много усовершенствованных возможностей.</p>
	<p>Несмотря на относительно простую настройку EIGRP, лежащие в его основе функции и параметры носят сложный характер. В него входит множество функциональных возможностей, ранее не встречавшихся ни в одном другом протоколе маршрутизации. В силу всех этих факторов протокол EIGRP - оптимальный выбор для больших многопротокольных сетей, в которых используются, в основном, устройства компании Cisco.</p>

	<center><img src="./img/chapter6/6.137.jpg"></center>
	<p class="img">Рисунок 6.137 &ndash; Преимущества протокола EIGRP</p>

	<p>Двумя основными задачами протокола EIGRP являются обеспечение беспетлевой среды маршрутизации и быстрой конвергенции. С этими целями протокол EIGRP задействует способ расчета оптимального маршрута, отличный от протокола RIP. Им используется составная метрика (метод, используемый в EIGRP-сети для расчета наилучшего маршрута для древоподобной маршрутизации и быстрой конвергенции), которая, главным образом, основана на пропускной способности и задержке. По сравнению с числом переходов эта метрика более точна в определении расстояния до сети назначения. </p>
	<p>Алгоритм диффузионного обновления (DUAL) (математический алгоритм, использующий EIGRP-протокол и обеспечивающий отсутствие петель путем непрерывного расчета маршрута. Алгоритм диффузного обновления позволяет синхронизироваться маршрутизаторам, задействованным в изменении топологии сети, не затрагивая маршрутизаторы, которые не задействованы в изменении топологии сети), используемый в протоколе EIGRP, гарантирует отсутствие петель при расчете маршрутов. Когда в топологии сети происходит изменение, алгоритм DUAL одновременно синхронизирует все затронутые маршрутизаторы. По этим причинам административное расстояние для протокола EIGRP равно 90, а для протокола RIP &ndash; 120. Малое число отражает увеличение надежности протокола EIGRP и повышение точности метрики. Если маршрутизатор получает маршруты до одного и того же адреса назначения и от RIP, и от EIGRP, он предпочтет маршрут, определенный протоколом EIGRP, маршруту, полученному от протокола RIP.</p>
	<p>Протокол EIGRP отмечает маршруты, полученные по другому протоколу маршрутизации, как внешние. Поскольку сведения, используемые для расчета этих маршрутов, менее надежны, чем метрика EIGRP, маршрутам присваивается большее административное расстояние [13].</p>

	<center><img src="./img/chapter6/6.138.jpg"></center>
	<p class="img">Рисунок 6.138 &ndash; Административное расстояние различных протоколов</p>

	<p>Протокол EIGRP &ndash; хороший выбор для сложных корпоративных сетей, в которых использованы, в основном, маршрутизаторы компании Cisco. Максимальное число переходов протокола, равное 224, позволяет поддерживать большие сети. Протокол EIGRP может отображать более одной таблицы маршрутизации, поскольку он может собирать и хранить сведения маршрутизации для разных протоколов маршрутизации, например, для IP и IPX. В таблице маршрутизации EIGRP отображаются маршруты, полученные как внутри, так и снаружи локальной системы. </p>
	<p>В отличие от других протоколов на основе векторов расстояния протокол EIGRP не отправляет полные таблицы в форме своих обновлений. EIGRP выполняет многоадресную рассылку частичных обновлений, касающихся конкретных изменений, только тем маршрутизаторам, которым эти сведения необходимы, а не всем маршрутизаторам области. Эти обновления называются частичными обновлениями (свойство, связанное с протоколами маршрутизации на базе состояния канала, например, с протоколом EIGRP. Ограниченное обновление содержит заданные параметры и доставляется только маршрутизаторам, которым эта информация необходима), поскольку отражают конкретные параметры. </p>
	<p>Вместо отправки периодических обновлений маршрутов протокол EIGRP отсылает небольшие пакеты приветствия (пакет, предназначенный для многоадресной рассылки с целью определения устройств в сети и проверки соединения. Пакет приветствия используется маршрутизатором для определения наилучшего из имеющихся каналов) для обновления сведений о своих соседях. Из-за малого размера и частичные обновления, и пакеты приветствия позволяют сохранить пропускную способность, по-прежнему обновляя сведения о сети.</p>

	<center><img src="./img/chapter6/6.139.jpg"></center>
	<p class="img">Рисунок 6.139 &ndash; Частичные обновления EIGRP. Часть 1</p>
	<center><img src="./img/chapter6/6.140.jpg"></center>
	<p class="img">Рисунок 6.140 &ndash; Частичные обновления EIGRP. Часть 2</p>
	<center><img src="./img/chapter6/6.141.jpg"></center>
	<p class="img">Рисунок 6.141 &ndash; Частичные обновления EIGRP. Часть 3</p>
	<center><img src="./img/chapter6/6.142.jpg"></center>
	<p class="img">Рисунок 6.142 &ndash; Частичные обновления EIGRP. Часть 4</p>
	<center><img src="./img/chapter6/6.143.jpg"></center>
	<p class="img">Рисунок 6.143 &ndash; Частичные обновления EIGRP. Часть 5</p>
	<center><img src="./img/chapter6/6.144.jpg"></center>
	<p class="img">Рисунок 6.144 &ndash; Частичные обновления EIGRP. Часть 6</p>
	<center><img src="./img/chapter6/6.145.jpg"></center>
	<p class="img">Рисунок 6.145 &ndash; Частичные обновления EIGRP. Часть 7</p>
	<center><img src="./img/chapter6/6.146.jpg"></center>
	<p class="img">Рисунок 6.146 &ndash; Частичные обновления EIGRP. Часть 8</p>
	<center><img src="./img/chapter6/6.147.jpg"></center>
	<p class="img">Рисунок 6.147 &ndash; Частичные обновления EIGRP. Часть 9</p>



    <a name="ch3.2.2"></a>
	<p class="title">6.3.2.2 Терминология и таблицы протокола</p>

<p>В целях сохранения сведений о сети из обновлений и обеспечения быстрой конвергенции протокол EIGRP ведет ряд таблиц. Маршрутизаторы EIGRP размещают сведения о маршрутах и топологиях в ОЗУ для быстроты отклика на изменения. Протокол EIGRP ведет три взаимосвязанные таблицы:</p>
<ul type="square">
<li>1 таблицу соседей (одна из трех взаимосвязанных таблиц маршрутизатора EIGRP. Таблица соседей собирает данные и формирует список, содержащий сведения о непосредственно подключенных соседних маршрутизаторах. В строке с порядковым номером записывается число последних полученных приветствий от каждого соседа и устанавливается метка времени в момент поступления пакета приветствия. Если пакет приветствия не получен в течение времени удержания, то срок действия, то срок действия таймера истекает и с помощью алгоритма диффузионного обновления повторно вычисляется топология. Для таблицы маршрутизатора содержат таблицы топологии и маршрутизации);</li>
<li>2 таблицу топологии (одна из тех таблиц маршрутизатора EIGRP. Таблица топологии представляет в виде списка все маршруты, известные от каждого EIGRP-соседа. Алгоритм диффузионного обновления получает эти сведения от соседей и из таблиц топологии и вычисляет к каждой сети маршрут наименьшей стоимости. Таблица топологии идентифицирует до четырех первичных беспетлевых маршрутов для любого одного получателя);</li>
<li>3 таблицу маршрутизации (таблица, хранящаяся в маршрутизаторе или в другом устройстве сетевого взаимодействия, которая содержит сведения о маршрутах к сетевым узлам назначения и метрики, связанные с этими маршрутами).</li>
</ul>
<p>1 Таблица соседей. В таблице соседей отображены сведения о напрямую подключенных соседних маршрутизаторах. EIGRP регистрирует адрес только что обнаруженного соседа и подключенного к нему интерфейса.</p>
<p>Когда сосед отправляет пакет приветствия, он извещает о времени удержания (период времени, в течении которого маршрутизатор рассматривает соседа доступным). Время удержания &#8212; промежуток времени, на протяжении которого маршрутизатор считает соседа достижимым. Если в течение времени удержания пакет приветствия не получен, таймер истекает, и алгоритм DUAL выполняет перерасчет топологии.</p>
<p>Поскольку скорость конвергенции зависит от точности сведений о соседях, эта таблица крайне важна для работы протокола EIGRP.</p>

<center><img src="./img/chapter6/6.148.jpg"></center>
<p class="img">Рисунок 6.148 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 1</p>
<center><img src="./img/chapter6/6.149.jpg"></center>
<p class="img">Рисунок 6.149 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 2</p>
<center><img src="./img/chapter6/6.150.jpg"></center>
<p class="img">Рисунок 6.150 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 3</p>
<center><img src="./img/chapter6/6.151.jpg"></center>
<p class="img">Рисунок 6.151 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 4</p>
<center><img src="./img/chapter6/6.152.jpg"></center>
<p class="img">Рисунок 6.152 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 5</p>
<center><img src="./img/chapter6/6.153.jpg"></center>
<p class="img">Рисунок 6.153 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 6</p>
<center><img src="./img/chapter6/6.154.jpg"></center>
<p class="img">Рисунок 6.154 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 7</p>
<center><img src="./img/chapter6/6.155.jpg"></center>
<p class="img">Рисунок 6.155 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 7</p>
<center><img src="./img/chapter6/6.156.jpg"></center>
<p class="img">Рисунок 6.156 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 7</p>
<center><img src="./img/chapter6/6.157.jpg"></center>
<p class="img">Рисунок 6.157 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 7</p>
<center><img src="./img/chapter6/6.158.jpg"></center>
<p class="img">Рисунок 6.158 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 7</p>
<center><img src="./img/chapter6/6.159.jpg"></center>
<p class="img">Рисунок 6.159 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 8</p>
<center><img src="./img/chapter6/6.160.jpg"></center>
<p class="img">Рисунок 6.160 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 9</p>
<center><img src="./img/chapter6/6.161.jpg"></center>
<p class="img">Рисунок 6.161 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 10</p>
<center><img src="./img/chapter6/6.162.jpg"></center>
<p class="img">Рисунок 6.162 – Обмен пакетами приветствия между соседними устройствами и влияние времени удержания. Часть 11</p>



<p>2 Таблица топологии. В таблице топологии отображаются все маршруты, полученные от каждого из соседей EIGRP. Алгоритм DUAL получает сведения из таблиц соседей и топологий и рассчитывает наиболее выгодные маршруты до каждой из сетей.</p>
<p>В таблице топологии определяются до четырех основных беспетлевых маршрутов к адресу назначения. Эти лучшие маршруты (беспетлевой первичный маршрут равной стоимости с наименьшей метрикой к получателю, определяемый топологией и записываемый в таблицк маршрутизации) отображаются в таблице маршрутизации. Протокол EIGRP выполняет распределение нагрузки (способность маршрутизатора распределять трафик между всеми сетевыми интерфейсными платами, которые расположены на одинаковом расстоянии от адреса назначения. Распределение нагрузки увеличивает степень использования сегментов сети, что улучшает пропускную способность. Алгоритм распределения нагрузки может использовать сведения о скорости канала и его надежности) или отправляет пакеты по адресу назначения с помощью нескольких путей. Распределение нагрузки выполняется с помощью лучших маршрутов, которые одновременно с равной стоимостью (технология распределения пакетов, которая поддерживается протоколом EIGRP для предотвращения перегрузки сетевого маршрутизатора) и с неравной стоимостью (дополнительная полоса пропускания, необходимая для перенаправления пакета по определенному маршруту в сети. Некоторые маршруты могут иметь более высокие значения метрики, чем другие). Эта функция позволяет избежать перегрузки пакетами того или иного маршрута.</p>
<p>Резервные маршруты, называемые возможными преемниками (резервный маршрут, указанный в таблице топологии. Возможный преемник становится активным маршрутом, если первичный маршрут нарушен. Возможный преемник должен обладать более коротким объявленным расстоянием, чем допустимое расстояние текущего лучшего маршрута к получателю), отображаются в таблице топологии, но отсутствуют в таблице маршрутизации. Если не действует основной маршрут, лучшим маршрутом становится возможный преемник. Это замещение происходит при условии, что объявленное расстояние возможного преемника меньше допустимого расстояния текущего преемника до адреса назначения [12].</p>
<center><img src="./img/chapter6/6.163.jpg"></center>
<p class="img">Рисунок 6.163 – Таблица топологии. Статус маршрута</p>
<center><img src="./img/chapter6/6.164.jpg"></center>
<p class="img">Рисунок 6.164 – Таблица топологии. Возможное расстояние</p>
<center><img src="./img/chapter6/6.165.jpg"></center>
<p class="img">Рисунок 6.165 – Таблица топологии. Объявленное расстояние</p>
<center><img src="./img/chapter6/6.166.jpg"></center>
<p class="img">Рисунок 6.166 – Таблица топологии. Адрес следующего перехода или лучший маршрут</p>
<center><img src="./img/chapter6/6.167.jpg"></center>
<p class="img">Рисунок 6.167 – Таблица топологии. Адрес следующего перехода или возможный приемник</p>
<center><img src="./img/chapter6/6.168.jpg"></center>
<p class="img">Рисунок 6.168 – Таблица топологии. Сеть назначения</p>
<center><img src="./img/chapter6/6.169.jpg"></center>
<p class="img">Рисунок 6.169 – Таблица топологии. Исходящие интерфейсы</p>
<center><img src="./img/chapter6/6.170.jpg"></center>
<p class="img">Рисунок 6.170 – Таблица топологии. Число лучших маршрутов</p>
<center><img src="./img/chapter6/6.171.jpg"></center>
<p class="img">Рисунок 6.171 – Таблица топологии. Объявленное расстояние от возможного преемника</p>
<center><img src="./img/chapter6/6.172.jpg"></center>
<p class="img">Рисунок 6.172 – Таблица топологии. Возможное расстояние от возможного преемника</p>

<p>Содержимое таблицы топологии:</p>
<ul type="square">
<li>Статус маршрута. Указывает, является ли данный маршрут стабильным и готовым к использованию (пассивный) или повторно рассчитывается алгоритмом DUAL (активный).</li>
<li>Возможное расстояние. Минимальная рассчитанная метрика до пункта назначения.</li>
<li>Объявленное расстояние. Расстояние до пункта назначения, объявленное соседним устройством.</li>
<li>Адрес следующего перехода или лучший маршрут. IP-адрес маршрутизатора интерфейса следующего перехода.</li>
<li>Адрес следующего перехода или возможный приемник. IP-адрес интерфейса следующего перехода для возможного преемника.</li>
<li>Сеть назначения. Адрес сети назначения.<br />
<li>Исходящие интерфейсы. Интерфейс для исходящего трафика, направляемого маршрутизатором к пункту назначения.</li>
<li>Число лучших маршрутов. Число маршрутов с равной стоимостью с наименьшей метрикой до пункта назначения.</li>
<li>Объявленное расстояние от возможного преемника. Расстояние до пункта назначения, объявленное соседним устройством.</li>
<li>Возможное расстояние от возможного преемника. Рассчитанная метрика до пункта назначения через маршрут возможного приемника.</li>
</ul>



<p>3 Таблица маршрутизации. Если в таблице топологии размещены сведения о множестве различных путей до сети назначения, то в таблице маршрутизации отображаются только оптимальные маршруты, называемые лучшими маршрутами.</p>
<p>Протокол EIGRP отображает сведения об этих путях двумя способами:</p>
<ul type="square">
<li>в таблице маршрутизации пути, полученные по протоколу EIGRP, обозначаются символом D;</li>
<li>EIGRP отмечает динамические и статические протоколы, полученные от других протоколов маршрутизации или не из сети EIGRP, как D EX или внешние, поскольку они поступили не от маршрутизаторов EIGRP этой же автономной системы.</li>
</ul>
<center><img src="./img/chapter6/6.173.jpg"></center>
<p class="img">Рисунок 6.173 –Таблицы маршрутизации EIGRP</p>
<center><img src="./img/chapter6/6.174.jpg"></center>
<p class="img">Рисунок 6.174 –Таблицы маршрутизации EIGRP. Маршрутизатор R1</p>
<center><img src="./img/chapter6/6.175.jpg"></center>
<p class="img">Рисунок 6.175 –Таблицы маршрутизации EIGRP. Маршрутизатор R2</p>
<center><img src="./img/chapter6/6.176.jpg"></center>
<p class="img">Рисунок 6.176 –Таблицы маршрутизации EIGRP. Маршрутизатор R3</p>


<a name="ch3.2.3"></a>
<p class="title">6.3.2.3 Соседи и смежности EIGRP</p>
<p>Для того чтобы протокол EIGRP смог обменять пакеты между маршрутизаторами, ему необходимо сначала обнаружить своих соседей. Соседи EIGRP &#8212; это другие маршрутизаторы, работающие по протоколу EIGRP в напрямую подключенных сетях с общим доступом.</p>
<p>Маршрутизаторы EIGRP используют пакеты приветствий для обнаружения соседей и установления смежностей (связь для обмена информацией о маршруте между соседними маршрутизаторами и оконечными узлами. Смежность основана на использовании общего сегмента среды) с соседними маршрутизаторами. По умолчанию в каналах со скоростью больше T1 происходит многоадресная рассылка пакетов приветствия через каждые 5 секунд, а в каналах со скоростью T1 и меньше &#8212; через каждые 60 секунд.</p>
<p>В IP-сетях (сеть, которая использует IP-протокол, являющийся частью стека протоколов TCP/IP) адресом многоадресной рассылки является 224.0.0.10. В пакет приветствия входят сведения об интерфейсах маршрутизаторов и адресах интерфейсов. Маршрутизатор EIGRP считает, что пока поступают пакеты приветствия от соседа, сосед и его маршруты достижимы.</p>
<p>Время удержания &#8212; это период ожидания протоколом EIGRP пакета приветствия. Обычно время удержания в три раза больше интервала приветствия (период времени, выраженный в секундах, в течение которого маршрутизатор сохраняет пакет приветствия от соседа). По истечении времени удержания, когда EIGRP объявляет маршрут неактивным, алгоритм DUAL выполняет перерасчет топологии и обновляет таблицу маршрутизации.</p>
<p>Сведения, обнаруженные с помощью протокола приветствия, поступают в таблицу соседей. Порядковый номер фиксирует номер последнего полученного приветствия от каждого соседа и ставит отметку о времени прибытия пакета.</p>
<center><img src="./img/chapter6/6.177.jpg"></center>
<p class="img">Рисунок 6.177 &#8212; Обмен пакетами приветствий для обнаружения соседей и установления смежностей с соседними маршрутизаторами</p>

<p>После установки смежности протокол EIGRP использует пакеты разных типов для обмена и обновления сведений в таблицах маршрутизации. Соседи получают извещения о новых, недостижимых и вновь обнаруженных маршрутах путем обмена этими пакетами:</p>
<ul type="square">
<li>Приветствие. Обнаружение и проверка соседних узлов. Обнаружение значений таймеров. Многоадресная рассылка 224.0.0.10. Надежный метод передачи.</li>
<li>Подтверждение. Одноадресная рассылка пакетов приветствия без данных. Отклик на надежную пересылку пакета; обновление, запрос, отклик.</li>
<li>Обновление. При обнаружении нового соседа &#8212; одноадресное. Чтобы указать изменение маршрутизации – многоадресное.</li>
<li>Запрос. Для запроса конкретных сведений о соседе или поиска нового лучшего маршрута для многоадресной рассылки. Может быть многоадресным или одноадресным.</li>
<li>Ответ. Ответ на запрос. Всегда одноадресный.</li>
</ul>
<p>При утере маршрута он переходит в активное состояние, а алгоритм DUAL выполняет поиск нового маршрута до адреса назначения. После обнаружения маршрута он размещается в таблице маршрутизации и переходит в пассивное состояние.</p>
<p>С помощью этих пакетов алгоритм DUAL собирает сведения, необходимые для расчета оптимального маршрута до сети назначения.</p>

<center><img src="./img/chapter6/6.178.jpg"></center>
<p class="img">Рисунок 6.178 – Различные типы пакетов EIRGP</p>
<center><img src="./img/chapter6/6.179.jpg"></center>
<p class="img">Рисунок 6.179 – Различные типы пакетов EIRGP. Приветствие</p>
<center><img src="./img/chapter6/6.180.jpg"></center>
<p class="img">Рисунок 6.180 – Различные типы пакетов EIRGP. Подтверждение</p>
<center><img src="./img/chapter6/6.181.jpg"></center>
<p class="img">Рисунок 6.181 – Различные типы пакетов EIRGP. Обновление</p>
<center><img src="./img/chapter6/6.182.jpg"></center>
<p class="img">Рисунок 6.182 – Различные типы пакетов EIRGP. Запрос</p>
<center><img src="./img/chapter6/6.183.jpg"></center>
<p class="img">Рисунок 6.183 – Различные типы пакетов EIRGP. Ответ</p>



<p>Пакет подтверждения означает получение пакета обновления, запроса или ответа. Пакеты подтверждений &#8212; это небольшие пакеты приветствия без данных. Эти типы пакетов всегда одноадресные.</p>
<p>Пакет обновления (сообщение о топологии сети, пересылаемое соседу. Пакет обновления добавляет в таблицу топологии. Новому соседу часто требуется отправка нескольких обновлений, содержащих все сведения о топологии) отправляет сведения о топологии сети своему соседу. Этот сосед обновляет свою таблицу топологии. Некоторые обновления предусматривают отправку всех сведений о топологии новому соседу.</p>
<p>Каждый раз, когда алгоритм DUAL переводит маршрут в активное состояние, маршрутизатор должен отправить пакет запроса (сообщение, используемое для запроса значения некоторой переменной или набора переменных) всем соседям. Соседи в свою очередь должны отправить ответ, даже если в нем будет указано, что об адресе назначения сведений нет. Сведения каждого ответного пакета (сведения, пересылаемые при получении пакета запроса. Ответный пакет помогает алгоритму диффузионного обновления находить лучший маршрут к месту назначения. Запросы могут быть многоадресными или одноадресными. Ответы могут быть только одноадресными) позволяют алгоритму DUAL обнаружить лучший маршрут до сети назначения. Запросы могут быть многоадресными и одноадресными. Ответы всегда одноадресные.</p>
<p>Типы пакетов EIGRP используют либо службу с установлением соединения (как TCP), либо службу без установления соединения (как UDP). Пакеты обновления, запроса и ответа используют службу типа TCP, а подтверждения и пакеты приветствия &#8212; службу типа UDP [12].</p>

<center><img src="./img/chapter6/6.184.jpg"></center>
<p class="img">Рисунок 6.184 – Основные операции алгоритма DUAL. Часть 1</p>
<center><img src="./img/chapter6/6.185.jpg"></center>
<p class="img">Рисунок 6.185 – Основные операции алгоритма DUAL. Часть 2</p>
<center><img src="./img/chapter6/6.186.jpg"></center>
<p class="img">Рисунок 6.186 – Основные операции алгоритма DUAL. Часть 3</p>
<center><img src="./img/chapter6/6.187.jpg"></center>
<p class="img">Рисунок 6.187 – Основные операции алгоритма DUAL. Часть 4</p>
<center><img src="./img/chapter6/6.188.jpg"></center>
<p class="img">Рисунок 6.188 – Основные операции алгоритма DUAL. Часть 5</p>
<center><img src="./img/chapter6/6.189.jpg"></center>
<p class="img">Рисунок 6.189 – Основные операции алгоритма DUAL. Часть 6</p>
<center><img src="./img/chapter6/6.190.jpg"></center>
<p class="img">Рисунок 6.190 – Основные операции алгоритма DUAL. Часть 7</p>
<center><img src="./img/chapter6/6.191.jpg"></center>
<p class="img">Рисунок 6.191 – Основные операции алгоритма DUAL. Часть 8</p>
<center><img src="./img/chapter6/6.192.jpg"></center>
<p class="img">Рисунок 6.192 – Основные операции алгоритма DUAL. Часть 9</p>
<center><img src="./img/chapter6/6.193.jpg"></center>
<p class="img">Рисунок 6.193 – Основные операции алгоритма DUAL. Часть 10</p>
<center><img src="./img/chapter6/6.194.jpg"></center>
<p class="img">Рисунок 6.194 – Основные операции алгоритма DUAL. Часть 11</p>
<center><img src="./img/chapter6/6.195.jpg"></center>
<p class="img">Рисунок 6.195 – Основные операции алгоритма DUAL. Часть 12</p>
<center><img src="./img/chapter6/6.196.jpg"></center>
<p class="img">Рисунок 6.196 – Основные операции алгоритма DUAL. Часть 13</p>
<center><img src="./img/chapter6/6.197.jpg"></center>
<p class="img">Рисунок 6.197 – Основные операции алгоритма DUAL. Часть 14</p>



<p>Будучи протоколом маршрутизации, EIGRP функционирует независимо от сетевого уровня. Компания Cisco разработала собственный протокол четвертого уровня &#8212; надежный транспортный протокол (RTP) (стандарт для формата пакетов и функционирования, используемый в IP-сетях для передачи данных в режиме реального времени, например, аудио, видео данных или данных моделирования через многоадресные или одноадресные сетевые службы. RTP обеспечивает работу таких служб, как идентификация полезной нагрузки, нумерация последовательности, постановка отметок времени и отслеживание доставки в реальном масштабе времени). RTP гарантирует доставку и получение пакетов EIGRP для всех протоколов сетевого уровня. Поскольку в больших сложных сетях может использоваться ряд протоколов сетевого уровня, этот протокол обеспечивает гибкость и масштабируемость EIGRP.</p>
<p>RTP можно использовать одновременно и как транспортный протокол с гарантированной доставкой, и как транспортный протокол с негарантированной доставкой, подобно TCP и UDP. При RTP с гарантированной доставкой получатель должен отправить отправителю пакет подтверждения. Пакеты обновления, запроса и ответа отправляются в режиме гарантированной доставки, а пакеты приветствия и подтверждения &#8212; в режиме негарантированной доставки и не требуют подтверждения. RTP применяет как одноадресные, так и многоадресные пакеты. Многоадресные пакеты EIGRP используют зарезервированный адрес для многоадресной рассылки 224.0.0.10.</p>
<p>Каждый протокол сетевого уровня работает через протокол-зависимый модуль (PDM) (используется EIGRP для принятия решений при выполнении определенных задач маршрутизации. Каждый PDM поддерживает три таблицы), отвечающий за конкретную задачу маршрутизации. Все модули PDM ведут три таблицы. Например, у маршрутизатора, на котором запущены IP, IPX и AppleTalk, есть три таблицы соседей, три таблицы топологии и три таблицы маршрутизации [12].</p>

<center><img src="./img/chapter6/6.198.jpg"></center>
<p class="img">Рисунок 6.198 – Протокол-зависимый модуль (PDM), отвечающий за конкретную задачу маршрутизации</p>


<a name="ch3.2.4"></a>
<p class="title">6.3.2.4 Метрики и конвергенции протокола EIGRP</p>
<p>Для определения лучшего маршрута до адреса назначения EIGRP использует составное значение метрики. Эта метрика определяется на основе следующих значений:</p>
<ul type="square">
<li>полоса пропускания;</li>
<li>задержка;</li>
<li>надежность;</li>
<li>нагрузка.</li>
</ul>
<p>Максимальный размер передаваемого блока данных (MTU) (максимальный размер пакета, в байтах, который может обработать конкретный интерфейс) &#8212; еще одно значение, входящее в обновления маршрутов, но не являющееся метрикой маршрутизации.</p>
<p>Протокол EIGRP использует масштабированные значения для определения общей стоимости метрики для сети:</p>
<p>Метрика = [K1 * полоса пропускания + (K2 * полоса пропускания) / (256 – нагрузка) + K3 * задержка] * [K5 / (надежность + K4)]</p>
<p>В формулу составной метрики входят коэффициенты K (численное значение в формуле с составной метрики в EIGRP для определения наилучшего маршрута к получателю. K1 и K3 устанавливаются равным 1. K2, K4 и K5 устанавливаются равными 0. Значение равное 1 означает, что полоса пропускания и задержка имеют равный вес): с K1 до K5. По умолчанию для K1 и K3 устанавливается значение 1, а для K2, K4 и K5 &#8212; 0. Коэффициент 1 означает, что пропускная способность и задержка имеют одинаковый вес при расчете составной метрики.</p>
<p>1 Пропускная способность. Метрика пропускной способности является статическим значением, отображаемым в Кбит/с. У большинства серийных интерфейсов значение пропускной способности по умолчанию равно 1544 Кбит/с. Эта метрика отражает пропускную способность подключения T1.</p>
<p>Иногда значение пропускной способности может не отражать фактическую физическую пропускную способность интерфейса. Пропускная способность влияет на расчет метрики и, как следствие, &#8212; на выбор пути EIGRP. Если в соединение с пропускной способностью 56 Кбит/с поступает сообщение со значением 1544 Кбит/с, оно может негативно сказаться на конвергенции, поскольку необходимо будет преодолеть нагрузку трафика.</p>
<center><img src="./img/chapter6/6.199.jpg"></center>
<p class="img">Рисунок 6.199 – Максимальный размер передаваемого блока данных (MTU)</p>
<center><img src="./img/chapter6/6.200.jpg"></center>
<p class="img">Рисунок 6.200 – Значения коэффициентов K по умолчанию</p>


<p>Другими метриками, которые использует EIGRP для расчета стоимости канала, являются задержка, надежность и нагрузка.</p>
<p>2 Метрика задержки &#8212; статическое значение на основе типа выходного интерфейса. Значение по умолчанию равно 20 000 микросекунд для серийных интерфейсов и 100 микросекунд для интерфейсов Fast Ethernet.</p>
<p>Метрика задержки не отражает фактическое количество времени, которое затрачивают пакеты, чтобы достичь адреса назначения. При изменении значения задержки, связанного с определенным интерфейсом, изменяется метрика, но это не оказывает физического воздействия на сеть.</p>
<p>3 Метрика надежности означает частоту ошибок в канале. В отличие от задержки метрика надежности обновляется автоматически в зависимости от условий канала. Ее значение равно от 0 до 255. Надежность, равная 255/255, показывает канал со стопроцентной надежностью.</p>
<p>4 Нагрузка отражает объем трафика в канале. Малое значение нагрузки предпочтительнее высокого. Например, значение 1/255 означает канал с минимальной нагрузкой, а 255/255 &#8212; канал, загруженный на 100% [2].</p>

<center><img src="./img/chapter6/6.201.jpg"></center>
<p class="img">Рисунок 6.201 – Задержки протокола EIGRP</p>

<p>В таблице топологии EIGRP используются метрики для расчета значений возможного расстояния (FD) (наиболее желательный показатель EIGRP вдоль маршрута к месту назначения от маршрутизатора) и объявленное расстояния (AD) (1 – объявленное расстояние. Расстояние, для которого широковещательная рассылка выполняется вышестоящим соседом, 2 – административное расстояние. Степень доверия источнику информации о маршруте. Для маршрутизаторов Cisco административное расстояние выражается в идее числового значения от 0 до 255. Чем выше значение, тем ниже степень доверия) или объявленного расстояния (RD) (расстояние к получателю, сообщенное соседом). Алгоритму DUAL эти значения необходимы для определения лучших путей и возможных преемников.</p>
<p>Возможное расстояние &#8212; это лучшая метрика EIGRP по пути к адресу назначения от маршрутизатора.</p>
<p>Объявленное расстояние &#8212; это лучшая метрика, полученная от соседа.</p>
<p>Беспетлевой маршрут с наименьшим возможным расстоянием становится лучшим маршрутом. Возможно наличие нескольких лучших маршрутов до адреса назначения в зависимости от фактической топологии. Возможным преемником является маршрут, объявленное расстояние которого меньше возможного расстояния лучшего маршрута.</p>
<p>Алгоритм DUAL выполняет конвергенцию сразу же после изменения топологии. Алгоритм DUAL хранит возможных преемников в таблице топологии и отправляет в таблицу маршрутизации лучшего из них в качестве лучшего маршрута, если это исходный маршрут. При отсутствии возможных преемников исходный маршрут переходит в активный режим, и отправляются запросы на поиск нового преемника.</p>
<p>В записи таблицы маршрутизации EIGRP после слова “via” приведен адрес лучшего маршрута. Возможное расстояние &#8212; это метрика, указанная после административного расстояния 90. В приведенной ниже записи лучший маршрут к сети 192.168.1.0/24 &#8212; через интерфейс лучшего маршрута следующего перехода 192.168.10.10, а возможное расстояние -3014400:</p>
<p>D 192.168.1.0/24 [90/3014400] via 192.168.10.10, 00:00:31, Serial0/0/1</p>

<center><img src="./img/chapter6/6.202.jpg"></center>
<p class="img">Рисунок 6.202 – Возможное, заявленное и объявленное расстояния таблицы топологии EIGRP</p>


	<a name="ch3.2.5"></a>
	<p class="title">6.3.2.5 Проблемы и ограничения протокола EIGRP</p>
    <p>Будучи мощным и сложным протоколом маршрутизации, EIGRP, тем не менее, имеет некоторые ограничения:</p>
    <ul type="square">
        <li>не работает в средах различных поставщиков, поскольку является собственным протоколом компании Cisco;</li>
        <li>оптимальнее всего функционирует в сетях плоского типа;</li>
        <li>у маршрутизаторов должна совпадать автономная система, и его невозможно разделить на группы;</li>
        <li>может создавать очень большие таблицы маршрутизации, которые требуют больших пакетов обновлений и пропускной способности;</li>
        <li>использует больший объем памяти и вычислительных ресурсов по сравнению с протоколом RIP;</li>
        <li>работает эффективно, если не изменять параметры по умолчанию;</li>
        <li>для его обслуживания необходимы администраторы с глубокими техническими знаниями протокола и сети.</li>
    </ul>
    <p>Протокол EIGRP обеспечивает оптимальную маршрутизацию на основе векторов расстояния, используя дополнительные функции, обычно характерные для протоколов маршрутизации на основе состояния каналов, в том числе ограниченные обновления и смежности соседей. Для успешного внедрения многих функций протокола EIGRP требуется тщательная настройка, мониторинг, поиск и устранение ошибок.</p>

	<center><img src="./img/chapter6/6.203.jpg"></center>
	<p class="img">Рисунок 6.203 &ndash; Проблемы и ограничения протокола EIGRP</p>


    <a name="ch4"></a>
    <p class="title">6.4 Маршрутизация с помощью протоколов на основе состояния канала</p>
    <a name="ch4.1"></a>
    <p class="title">6.4.1 Протокол OSPF</p>
    <p>Корпоративные сети и поставщики услуг Интернета используют протоколы на базе состояния канала (тип стандартов, например OSPF и IS-IS, используемых при иерархическом проектировании сетей. Протоколы на базе состояния канала помогают управлять процессами коммутации пакетов в больших сетях), что связано с их иерархической конструкцией и возможностью масштабирования для крупных сетей. Протоколы маршрутизации на основе векторов расстояний не являются правильным выбором для сложной корпоративной сети.</p>
    <p>Алгоритм выбора кратчайшего пути (OSPF) (алгоритм маршрутизации для протокола внутреннего шлюза на основе иерархии состояния канала, который заменил протокол маршрутной информации. Протокол OSPF позволяет выполнять маршрутизацию по критерию наименьшей стоимости, маршрутизацию с обходными путями и распределением нагрузки) - пример протокола маршрутизации на базе состояния канала. Протокол OSPF - это открытый стандарт (протокол или правило доступное всем для использования в сетях. Открытые стандарты не являются чьей-то собственностью) протокол маршрутизации, разработанный Инженерная группа по развитию Интернета (IETF) (группа по развитию состоит более чем 80 рабочих групп, отвечающих за развитие стандартов Интернет. IETF является частью Общества Интернет) для поддержки IP-трафика.</p>
    <p>Протокол OSPF является бесклассовым протоколом внутренних шлюзов (IGP) (протокол внутреннего шлюза. Интернет-протокол, использующийся для обмена данными маршрутизации в пределах автономной системы. В качестве примера наиболее распространенных Интернет-протоколов IGP можно назвать EIGRP, OSPF и RIP). Он делит сеть на разные секции, которые называют областями. Данное разделение дает возможность большего масштабирования. Работа с несколькими областями позволяет администратору сети выборочно включать суммирование маршрутов и изолировать проблемы с маршрутизацией в пределах какой-либо одной области.</p>
    <p>Протоколы маршрутизации по состоянию канала, такие как OSPF, не производят частой периодической рассылки полной таблицы маршрутизации. Вместо этого после объединения сети отправка обновления производится протоколом состояния канала только при каком-либо изменении в топологии сети, например, при отключении канала. Кроме этого каждые 30 минут протокол OSPF выполняет полное обновление [12].</p>

    <center><img src="./img/chapter6/6.204.jpg"></center>
	<p class="img">Рисунок 6.204 &ndash; Работа протоколов на основе векторов расстояния. Часть 1</p>
    <center><img src="./img/chapter6/6.205.jpg"></center>
	<p class="img">Рисунок 6.205 &ndash; Работа протоколов на основе векторов расстояния. Часть 2</p>
    <center><img src="./img/chapter6/6.206.jpg"></center>
	<p class="img">Рисунок 6.206 &ndash; Работа протоколов на основе векторов расстояния. Часть 3</p>
    <center><img src="./img/chapter6/6.207.jpg"></center>
	<p class="img">Рисунок 6.207 &ndash; Работа протоколов на основе векторов расстояния. Часть 4</p>
    <center><img src="./img/chapter6/6.208.jpg"></center>
	<p class="img">Рисунок 6.208 &ndash; Работа протоколов на основе векторов расстояния. Часть 5</p>
    <center><img src="./img/chapter6/6.209.jpg"></center>
	<p class="img">Рисунок 6.209 &ndash; Работа протоколов на основе векторов расстояния. Часть 6</p>
    <center><img src="./img/chapter6/6.210.jpg"></center>
	<p class="img">Рисунок 6.210 &ndash; Работа протоколов на основе векторов расстояния. Часть 7</p>
    <center><img src="./img/chapter6/6.211.jpg"></center>
	<p class="img">Рисунок 6.211 &ndash; Работа протоколов на основе векторов расстояния. Часть 8</p>
    <center><img src="./img/chapter6/6.212.jpg"></center>
	<p class="img">Рисунок 6.212 &ndash; Работа протоколов на основе векторов расстояния. Часть 9</p>
    <center><img src="./img/chapter6/6.213.jpg"></center>
	<p class="img">Рисунок 6.213 &ndash; Работа протоколов на основе состояния канала. Часть 1</p>
    <center><img src="./img/chapter6/6.214.jpg"></center>
	<p class="img">Рисунок 6.214 &ndash; Работа протоколов на основе состояния канала. Часть 2</p>
    <center><img src="./img/chapter6/6.215.jpg"></center>
	<p class="img">Рисунок 6.215 &ndash; Работа протоколов на основе состояния канала. Часть 3</p>
    <center><img src="./img/chapter6/6.216.jpg"></center>
	<p class="img">Рисунок 6.216 &ndash; Работа протоколов на основе состояния канала. Часть 4</p>
    <center><img src="./img/chapter6/6.217.jpg"></center>
	<p class="img">Рисунок 6.217 &ndash; Работа протоколов на основе состояния канала. Часть 5</p>
    <center><img src="./img/chapter6/6.218.jpg"></center>
	<p class="img">Рисунок 6.218 &ndash; Работа протоколов на основе состояния канала. Часть 6</p>
    <center><img src="./img/chapter6/6.219.jpg"></center>
	<p class="img">Рисунок 6.219 &ndash; Работа протоколов на основе состояния канала. Часть 7</p>


    <p>Протоколы маршрутизации по состоянию канала, такие как OSPF, работают нормально в сетях с более крупной иерархией, где важна быстрая сходимость.</p>
    <p>По сравнению с протоколами на базе векторов расстояния, для протоколов маршрутизации по состоянию канала требуется следующее:</p>
    <ul type="square">
        <li>более сложный процесс планирования и конфигурации сети;</li>
        <li>увеличенные ресурсы маршрутизатора;</li>
        <li>больший объем памяти для хранения большого количества таблиц;</li>
        <li>более высокая мощность процессора и вычислительная мощность для сложных расчетов маршрутизации.</li>
    </ul>

    <p>Однако при высокой вычислительной мощности маршрутизаторов, доступной в настоящее время, выполнение этих требований обычно не представляет трудностей.</p>
    <p>Маршрутизаторы, на которых выполняются протоколы RIP, получают обновления от маршрутизаторов, находящихся в непосредственном соседстве, но без подробной информации обо всей сети. Маршрутизаторы, на которых выполняются протоколы OSPF, создают полную карту сети со своей точки обзора. Данная карта позволяет им быстро определять беспетлевые альтернативные маршруты в случае отказа какого-либо сетевого канала.</p>
    <p>Протокол OSPF не выполняет автоматического суммирования на границах главной сети. Кроме того, в решениях по протоколам OSPF, предлагаемых компанией Cisco, для определения стоимости канала используется пропускная способность. Эта метрика стоимости используется протоколом OSPF для определения наилучшего маршрута. Канал с более высокой пропускной способностью обеспечивает более низкую стоимость. Самым предпочтительным является путь к месту назначения с наименьшей стоимостью.</p>
    <p>Для установления кратчайшего пути маршрутизатор больше доверяет метрике, основанной на пропускной способности, чем метрике, основанной на числе переходов. Административное расстояние протокола OSPF равно 110, что меньше, чем для RIP, благодаря достоверности, или точности, метрики [12].</p>

    <center><img src="./img/chapter6/6.220.jpg"></center>
	<p class="img">Рисунок 6.220 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 1</p>
    <center><img src="./img/chapter6/6.221.jpg"></center>
	<p class="img">Рисунок 6.221 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 2</p>
    <center><img src="./img/chapter6/6.222.jpg"></center>
	<p class="img">Рисунок 6.222 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 3</p>
    <center><img src="./img/chapter6/6.223.jpg"></center>
	<p class="img">Рисунок 6.223 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 4</p>
    <center><img src="./img/chapter6/6.224.jpg"></center>
	<p class="img">Рисунок 6.224 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 5</p>
    <center><img src="./img/chapter6/6.225.jpg"></center>
	<p class="img">Рисунок 6.225 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 6</p>
    <center><img src="./img/chapter6/6.226.jpg"></center>
	<p class="img">Рисунок 6.226 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 7</p>
    <center><img src="./img/chapter6/6.227.jpg"></center>
	<p class="img">Рисунок 6.227 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 8</p>
    <center><img src="./img/chapter6/6.228.jpg"></center>
	<p class="img">Рисунок 6.228 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 9</p>
    <center><img src="./img/chapter6/6.229.jpg"></center>
	<p class="img">Рисунок 6.229 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 10</p>
    <center><img src="./img/chapter6/6.230.jpg"></center>
	<p class="img">Рисунок 6.230 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 11</p>
    <center><img src="./img/chapter6/6.231.jpg"></center>
	<p class="img">Рисунок 6.231 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 12</p>
    <center><img src="./img/chapter6/6.232.jpg"></center>
	<p class="img">Рисунок 6.232 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 13</p>
    <center><img src="./img/chapter6/6.233.jpg"></center>
	<p class="img">Рисунок 6.233 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 14</p>
    <center><img src="./img/chapter6/6.234.jpg"></center>
	<p class="img">Рисунок 6.234 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 15</p>
    <center><img src="./img/chapter6/6.235.jpg"></center>
	<p class="img">Рисунок 6.235 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 16</p>
    <center><img src="./img/chapter6/6.236.jpg"></center>
	<p class="img">Рисунок 6.236 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 17</p>
    <center><img src="./img/chapter6/6.237.jpg"></center>
	<p class="img">Рисунок 6.237 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 18</p>
    <center><img src="./img/chapter6/6.238.jpg"></center>
	<p class="img">Рисунок 6.238 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 19</p>
    <center><img src="./img/chapter6/6.239.jpg"></center>
	<p class="img">Рисунок 6.239 &ndash; Процесс выбора маршрута с помощью RIP и OSPF. Часть 20</p>


    <a name="ch4.2"></a>
    <p class="title">6.4.2 Метрики и конвергенция протоколов OSPF</p>
    <p>Протокол OSPF основывает метрику стоимости для отдельного канала на его пропускной способности или скорости. Метрикой для конкретной сети назначения является сумма стоимости всех каналов пути. Если существует несколько путей к сети, предпочтительным является путь с наименьшей стоимостью, и он заносится в таблицу маршрутизации.</p>
    <p>Для расчета стоимости канала протокола OSPF используется следующее уравнение:</p>
    <p>Стоимость = 100 000 000 / пропускная способность канала в бит/с.</p>
    <p>Значение пропускной способности для уравнения дает пропускная способность, настраиваемая в интерфейсе.</p>
    <p>При скоростях канала 100 Мбит/с и выше, например, как у каналов Fast Ethernet и Gigabit Ethernet, использование данного уравнения представляет трудность. Независимо от разницы в скорости между этими двумя каналами, они оба рассчитываются до значения 1, поэтому, несмотря на различие этих каналов, они будут обрабатываться одинаково.</p>

    <center><img src="./img/chapter6/6.240.jpg"></center>
	<p class="img">Рисунок 6.240 &ndash; Метрики протокола OSPF</p>

    <p>В пределах одной области маршрутизаторы OSPF сообщают информацию о состоянии своих соединений (канал для сетевой передачи данных, который состоит из цепи или маршрута пересылки и всего связанного с ним оборудования между отправителем и получателем. Соединение также известно под названием “линия” или “канал передачи”) соседним маршрутизаторам. Для объявления информации о состоянии каналов используются сообщения, называемые объявлениями о состоянии канала, или LSA (пакет широковещательной рассылки, используемый протоколом на базе состояния канала. Объявление о состоянии канала содержит сведения о соседях и стоимости маршрута. Эти сведения используются принимающими маршрутизаторами для поддержания таблиц маршрутизации в актуальном состоянии. Объявление о состоянии канала известно также под названием “пакет состояния канала”).</p>
    <p>После получения объявлений LSA с описанием всех каналов в пределах соответствующей области маршрутизатор OSPF использует алгоритм SPF (математический алгоритм, который путем последовательного прохождения всей длины пути, определяет кратчайшее связующее дерево. Алгоритм поиска наикратчайшего пути является алгоритмом маршрутизации на базе состояния канала), также называемый алгоритмом Дейкстры (процесс, используемый  в SPF для идентификации всех маршрутов к каждой конечной точке и определения полной стоимости каждого маршрута), для создания топологической древовидной схемы, или карты сети. Каждый маршрутизатор, на котором выполняется данный алгоритм, определяет себя в качестве корневого элемента своего собственного дерева SPF (все маршруты от источника к каждой конечной точке и полная стоимость каждого маршрута). Начиная от корневого элемента, дерево SPF определяет кратчайший путь к каждому месту назначения и общую стоимость каждого пути.</p>
    <p>Информация о дереве SPF хранится в данных о состоянии канала OSPF или базе данных топологии (место в топологии, которое хранит данные дерева SPF). Маршрутизатор заносит кратчайший путь к каждой сети в таблицу маршрутизации.</p>
    <p>Конвергенция достигается, если все маршрутизаторы выполнят следующие действия:</p>
    <ul type="square">
        <li>получат информацию о каждом месте назначения в сети;</li>
        <li>обработают данную информацию с использованием алгоритма SPF;</li>
        <li>обновят свои таблицы маршрутизации [13].</li>
    </ul>

    <center><img src="./img/chapter6/6.241.jpg"></center>
	<p class="img">Рисунок 6.241 &ndash; Пути и дерево SPF</p>
    <center><img src="./img/chapter6/6.242.jpg"></center>
	<p class="img">Рисунок 6.242 &ndash; Пути и дерево SPF. Маршрутизатор R1</p>
    <center><img src="./img/chapter6/6.243.jpg"></center>
	<p class="img">Рисунок 6.243 &ndash; Пути и дерево SPF. Маршрутизатор R2</p>
    <center><img src="./img/chapter6/6.244.jpg"></center>
	<p class="img">Рисунок 6.244 &ndash; Пути и дерево SPF. Маршрутизатор R3</p>
    <center><img src="./img/chapter6/6.245.jpg"></center>
	<p class="img">Рисунок 6.245 &ndash; Пути и дерево SPF. Маршрутизатор R4</p>


    <a name="ch4.3"></a>
    <p class="title">6.4.3 Соседние маршрутизаторы OSPF и отношения смежности</p>
    <p>При использовании протоколов OSPF обновления информации о состоянии каналов рассылаются при появлении в сети каких-либо изменений. Но каким образом маршрутизатор может узнать об отказе соседнего маршрутизатора. Маршрутизаторы OSPF устанавливают и поддерживают соседские отношения, или отношения смежности (связь для обмена информацией о маршруте между соседними маршрутизаторами и оконечными узлами. Смежность основана на использовании общего сегмента), с другими маршрутизаторами OSPF, подключенными к сети. Смежность - это продвинутая форма соседских отношений между маршрутизаторами, желающими обмениваться информацией о маршрутизации. При инициации маршрутизаторами отношения смежности с соседними маршрутизаторами начинается обмен обновлениями информации о состоянии каналов. Маршрутизаторы достигают состояния смежности FULL (полное), когда они имеют синхронизированные данные в своей базе данных состояний каналов.</p>
    <p>Перед тем как стать полностью смежным с соседним маршрутизатором, тот или иной маршрутизатор проходит через несколько изменений состояния.</p>
    <ul type="square">
        <li>Init (инициация);</li>
        <li>2-Way (двусторонний режим);</li>
        <li>Exstart;</li>
        <li>Exchange (обмен информацией);</li>
        <li>Loading (загрузка);</li>
        <li>Full (полное).</li>
    </ul>

    <p>В протокол OSPF протокол приветствия (стандарт, используемый OSPF-системами для установления и поддержания соединений с соседями. Протокол приветствия является внутренним протоколом, который использует метрику маршрутизации, основанную на периоде времени распространения пакета между источником и получателем) используется для начального установления и ведения отношений смежности. Протокол приветствия посылает очень маленькие пакеты приветствия к подключенным напрямую маршрутизаторам OSPF на адрес многоадресной рассылки 224.0.0.5. Пакеты посылаются каждые 10 секунд по каналам Ethernet и широковещательным каналам и каждые 30 секунд по нешироковещательным каналам. Пакеты приветствия также содержат в себе настройки маршрутизатора. Настройки содержат интервал приветствия (период времени, выраженный в секундах, в течение которого маршрутизатор сохраняет пакет приветствия от соседа), паузу (период времени, выраженный в секундах, в течение которого маршрутизатор ожидает получения приветствия от соседа перед объявлением соседа неработающим), тип сети, а также тип аутентификации и данные аутентификации, если она настроена. Для установления смежности между любыми двумя маршрутизаторами все настройки должны совпадать. Маршрутизатор записывает обнаруженные отношения смежности между соседними маршрутизаторами в базу данных отношений смежности.</p>
    <center><img src="./img/chapter6/6.246.jpg"></center>
	<p class="img">Рисунок 6.246 &ndash; Состояния маршрутизатора OSPF</p>
    <p>Состояние Full является стандартным для маршрутизатора OSPF. Если маршрутизатор длительное время находится в другом состоянии, это указывает на наличие какой-либо проблемы, например, несовпадения настроек. Единственным исключением является состояние 2-way. В широковещательном окружении маршрутизатор достигнет состояния full только с назначенным маршрутизатором (DR) (маршрутизатор, который назначается протоколом приветствия OSPF в OSPF-сети, содержащей, по крайней мере, два присоединенных маршрутизатора. Назначенный маршрутизатор генерирует объявления о состоянии канала связи. Это позволяет сократить число необходимых смежностей, что уменьшает объем трафика протокола маршрутизации и размер топологической базы данных) и резервным назначенным маршрутизатором (BDR) (маршрутизатор, который принимает на себя управление трафиком, если назначенный маршрутизатор выйдет из строя). Все прочие соседние маршрутизаторы будут отображаться в состоянии 2-way.</p>
    <p>Задачей маршрутизаторов DR и BDR является снижение количества посылаемых обновленных данных, ненужного трафика и непроизводительных процессов на всех маршрутизаторах. Это достигается путем отправки на все маршрутизаторы запроса о приеме обновленных данных только от маршрутизатора DR. В широковещательных сегментах сети есть только по одному маршрутизатору DR и BDR. Все прочие маршрутизаторы должны иметь соединение с маршрутизатором DR и BDR. При отказе какого-либо канала маршрутизатор, имеющий информацию о данном канале, посылает информацию на маршрутизатор DR, используя адрес многоадресной рассылки 224.0.0.6. Маршрутизатор DR отвечает за рассылку информации об изменении на все остальные маршрутизаторы OSPF по адресу многоадресной рассылки 224.0.0.5. Кроме снижения количества рассылаемых по сети обновлений этот процесс также обеспечивает получение всеми маршрутизаторами одинаковой информации в одно и то же время и из одного источника.</p>
    <p>Маршрутизатор BDR обеспечивает отсутствие каких-либо критических точек. Как и маршрутизатор DR, маршрутизатор BDR наблюдает за адресом 224.0.0.6 и получает все обновления, которые посылаются на маршрутизатор DR. При отказе маршрутизатора DR маршрутизатор BDR получает функции маршрутизатора DR, и назначается новый маршрутизатор BDR. Любой маршрутизатор, не выбранный в качестве маршрутизатора DR или BDR, называется маршрутизатором DROther (любой маршрутизатор в OSPF-сети, который не является назначенным или резервным).</p>

    <center><img src="./img/chapter6/6.247.jpg"></center>
	<p class="img">Рисунок 6.247 &ndash; Роль назначенного маршрутизатора. Часть 1</p>
    <center><img src="./img/chapter6/6.248.jpg"></center>
	<p class="img">Рисунок 6.248 &ndash; Роль назначенного маршрутизатора. Часть 2</p>
    <center><img src="./img/chapter6/6.249.jpg"></center>
	<p class="img">Рисунок 6.249 &ndash; Роль назначенного маршрутизатора. Часть 3</p>
    <center><img src="./img/chapter6/6.250.jpg"></center>
	<p class="img">Рисунок 6.250 &ndash; Роль назначенного маршрутизатора. Часть 4</p>
    <center><img src="./img/chapter6/6.251.jpg"></center>
	<p class="img">Рисунок 6.251 &ndash; Роль назначенного маршрутизатора. Часть 5</p>
    <center><img src="./img/chapter6/6.252.jpg"></center>
	<p class="img">Рисунок 6.252 &ndash; Роль назначенного маршрутизатора. Часть 6</p>
    <center><img src="./img/chapter6/6.253.jpg"></center>
	<p class="img">Рисунок 6.253 &ndash; Роль назначенного маршрутизатора. Часть 7</p>
    <center><img src="./img/chapter6/6.254.jpg"></center>
	<p class="img">Рисунок 6.254 &ndash; Роль назначенного маршрутизатора. Часть 8</p>
    <center><img src="./img/chapter6/6.255.jpg"></center>
	<p class="img">Рисунок 6.255 &ndash; Роль назначенного маршрутизатора. Часть 9</p>
    <center><img src="./img/chapter6/6.256.jpg"></center>
	<p class="img">Рисунок 6.256 &ndash; Роль назначенного маршрутизатора. Часть 10</p>



    <p>Маршрутизатором DR назначается маршрутизатор с самым высоким в пределах локальной сети идентификатором маршрутизатора (IP-адрес, определяемый значением, настраиваемый с помощью команд, значение наибольшего настраиваемого IP-адреса в петлевом интерфейсе или значением наибольшего IP-адреса в петлевом интерфейсе или значение наибольшего IP-адреса в любом активном физическом интерфейсе). Маршрутизатором BDR назначается маршрутизатор со вторым по величине идентификатором.</p>
    <p>В некоторых случаях в качестве маршрутизаторов DR и BDR администратору может потребоваться назначить какие-либо конкретные маршрутизаторы. Это могут быть маршрутизаторы с большей вычислительной мощностью или меньшей загрузкой трафиком. Администратор может принудительно назначить маршрутизаторы DR и BDR путем настройки приоритета с использованием команды настройки интерфейса.</p>
    <p>По умолчанию маршрутизаторы OSPF имеют значение приоритета 1. При изменении значения приоритета на каком-либо маршрутизаторе в качестве маршрутизатора DR будет выбран маршрутизатор с высшим настроенным значением приоритета независимо от высшего идентификатора маршрутизатора. Высшим значением для настройки приоритета маршрутизатора является значение 255. Значение 0 означает, что маршрутизатор нельзя выбрать в качестве маршрутизатора DR или BDR.</p>
    <center><img src="./img/chapter6/6.257.jpg"></center>
	<p class="img">Рисунок 6.257 &ndash; Выбор назначенного маршрутизатора</p>
    <p>Не для всех типов каналов требуется маршрутизатор DR или BDR. Типы каналов, определяемые протоколом OSPF, включают в себя:</p>
    <ol>
        <li>широковещательную сеть с множественного доступа (тип Ethernet-канала, который поддерживает протокол OSPF, является стандартом для коллективного доступа в сеть и перенаправляет трафик широковещательной рассылки) - Ethernet.</li>
        <li>сети точка-точка (PPP) (протокол точка-точка. Протокол, который обеспечивает соединения типа маршрутизатор-маршрутизатор и узел-сеть по синхронным и асинхронным каналам) –
        <ul type="square">
            <li>последовательные;</li>
            <li>T1/E1.</li>
        </ul>
        </li>
        <li>нешироковещательную сеть множественного доступа (NBMA) (сеть, которая не поддерживает широковещательную трансляцию, например, сеть X.25, или в которой широковещательная трансляция не может быть выполнена, например, сеть SMDS) -
        <ul type="square">
            <li>Frame Relay;</li>
            <li>ATM.</li>
        </ul>
        </li>
    </ol>
    <p>В широковещательных сетях множественного доступа, таких как Ethernet, может появиться большое число отношений соседства, поэтому требуется назначать маршрутизатор DR.</p>
    <p>В сетях типа точка-точка установление отношений полной смежности не представляет сложностей, поскольку, по определению, в этих сетях на канале находится только два маршрутизатора. Назначение маршрутизатора DR не является обязательным и не выполняется.</p>
    <p>В сетях NBMA маршрутизатор OSPF может работать в двух режимах:</p>
    <ul type="square">
        <li>симулированное широковещательное окружение: администратор может назначить тип сети как широковещательный, при этом сеть имитирует широковещательную модель путем назначения маршрутизатора DR или BDR. В данном окружении обычно рекомендуется, чтобы администратор выбирал маршрутизатор DR или BDR путем настройки приоритета маршрутизатора. Это обеспечивает наличие у маршрутизатора DR или BDR возможности полной передачи данных на все соседние маршрутизаторы. Соседние маршрутизаторы также определяются статически при помощи команды neighbor в режиме настройки OSPF;</li>
        <li>многоточечное окружение: в данном окружении каждая нешироковещательная сеть рассматривается как набор двухточечных каналов, при этом маршрутизатор DR не назначается. Для этого окружения также требуется, чтобы соседние маршрутизаторы назначались статически.</li>
    </ul>
    <center><img src="./img/chapter6/6.258.jpg"></center>
	<p class="img">Рисунок 6.258 &ndash; Топология широковещательной сети множественного доступа</p>
    <center><img src="./img/chapter6/6.259.jpg"></center>
	<p class="img">Рисунок 6.259 &ndash; Топология сети точка-точка </p>
    <center><img src="./img/chapter6/6.260.jpg"></center>
	<p class="img">Рисунок 6.260 &ndash; Топология нешироковещательной сети множественного доступа</p>


    <a name="ch4.4"></a>
    <p class="title">6.4.4 Области OSPF</p>
    <p>Все сети OSPF начинаются с области 0 (область в начале OSPF-сети. OSPF-сеть должна обладать, по крайней мере, одной областью, которая является областью 0. При расширении сети другие области создаются рядом с областью 0. Область 0 известна также под называнием “магистральная область”), также называемой областью магистрали. По мере расширения сети могут создаваться другие области, смежные с областью 0. Этим другим областям может назначаться любой номер до 65535. Максимально допустимое число маршрутизаторов в одной области составляет 50.</p>
    <p>Сеть OSPF имеет двухслойную иерархическую конструкцию. Область 0, также называемая областью магистрали, находится наверху, а все прочие области расположены на следующем уровне. Все немагистральные области должны напрямую соединяться с областью 0. Эта группа областей создает автономную систему OSPF (AS) (автономная система. Объединение сетей с общим администрированием и общей стратегией маршрутизации. Автономные системы подразделяются на области. Автономной системе должен быть назначен уникальный 16-битный номер, устанавливаемый Комитетом по цифровым адресам в Интернете (IANA).</p>
    <p>Процесс работы протокола OSPF в пределах какой-либо области отличается от процессов, выполняемых между этой областью и областью магистрали. Например, при каком-либо изменении в топологии получают объявление LSA и выполняют алгоритм SPF только маршрутизаторы, находящиеся в области, где произошло изменение. Обычно между областями происходит суммирование сетевой информации. Это позволяет уменьшить размер таблиц маршрутизации в опорной сети. При помощи суммирования также изолируются изменения и нестабильности, или биение (проблема маршрутизации, при которой в качестве объявленного маршрута между двумя устройствами из-за перемежающихся сбоев в сети попеременно выбирается один из двух каналов), каналов до отдельной области в домене маршрутизации.</p>
    <p>Маршрутизатор, через который какая-либо область соединяется с областью магистрали, называется пограничным маршрутизатором области (ABR) (пограничный маршрутизатор области. Устройство маршрутизации, которое подсоединяет одну или несколько областей OSPF к магистральной сети. Пограничный маршрутизатор области поддерживает таблицы маршрутизации для магистральной сети и присоединенных областей OSPF). Маршрутизатор, через который какая-либо область соединяется с другим протоколом маршрутизации, таким как EIGRP, или статические маршруты перераспределяются в область OSPF, называется пограничным маршрутизатором автономной системы (ASBR) (пограничный маршрутизатор автономной системы. Пограничный маршрутизатор области, расположенный между автономной OSPF-системой и сетью, не поддерживающей OSPF-протокол. Пограничный маршрутизатор автономной системы использует OSPF-протокол маршрутизации и другие протоколы маршрутизации, например, протокол RIP. Пограничный маршрутизатор автономной системы должен постоянно располагаться не в оконечной OSPF-области).</p>

    <center><img src="./img/chapter6/6.261.jpg"></center>
	<p class="img">Рисунок 6.261 &ndash; Области OSPF</p>


    <a name="ch4.5"></a>
    <p class="title">6.4.5 Проблемы и ограничения OSPF</p>
    <p>Протокол OSPF является масштабируемым протоколом маршрутизации. Он обладает возможностью быстрой конвергенции и работы с очень крупными сетями. Однако при его использовании необходимо обращать внимание на некоторые вопросы.</p>
    <p>Протокол OSPF должен вести несколько баз данных и, следовательно, требует больше памяти и вычислительной мощности, чем протоколы маршрутизации на базе векторов расстояния.</p>
    <p>Алгоритм Дейкстры требует большой вычислительной мощности для расчета наилучшего маршрута. Если определенная сеть OSPF является сложной и нестабильной, данный алгоритм потребляет значительные объемы ресурсов при частых перерасчетах. Маршрутизаторы, на которых выполняется протокол OSPF, обычно являются более мощными и более дорогими.</p>
    <p>Чтобы избежать чрезмерного использования ресурсов маршрутизатора, применяйте строгую иерархическую структуру для разделения сети на области меньшего размера. Все области должны поддерживать возможность связи с областью 0. В противном случае они могут потерять связь с другими областями.</p>
    <p>Если сеть имеет большой размер и сложную структуру, процесс настройки протокола OSPF может оказаться непростым. Кроме того, для интерпретации информации, находящейся в базах данных OSPF и таблицах маршрутизации, требуется хорошее понимание процесса.</p>
    <p>Во время процесса начального обнаружения сети протокол OSPF может выполнять лавинную рассылку по сети извещений о состоянии канала, существенно ограничивая объем данных, передаваемых по сети. Лавинная рассылка в крупных сетях с большим числом маршрутизаторов и маленькой полосой пропускания приводит к существенному снижению пропускной способности сети.</p>
    <p>Несмотря на проблемы и ограничения протокола OSPF, он по-прежнему является самым широко применяемым на предприятиях протоколом маршрутизации на базе состояния канала.</p>

    <center><img src="./img/chapter6/6.262.jpg"></center>
	<p class="img">Рисунок 6.262 &ndash; Преимущества и недостатки протокола OSPF</p>
    <a name="ch5"></a>
    <p class="title">6.5 Использование нескольких протоколов маршрутизации на предприятии</p>
    <p>По многим причинам организации могут выбирать несколько протоколов маршрутизации.</p>
    <ul type="square">
        <li>Для разных разделов сети сетевой администратор может выбрать различные протоколы маршрутизации в зависимости от имеющегося устаревшего оборудования (предыдущие модели аппаратных средств или версии программного обеспечения, которые по-прежнему используются) и доступных ресурсов.</li>
        <li>Возможны случаи слияния двух компаний, сети которых были настроены с использованием разных протоколов маршрутизации, при этом им требуется связываться друг с другом по сети.</li>
    </ul>
    <p>Если на одном маршрутизаторе имеется несколько протоколов маршрутизации, то, возможно, что этот маршрутизатор будет узнавать о каком-либо адресате из нескольких источников. Для маршрутизатора необходим предсказуемый способ выбора предпочтительного для просмотра маршрута и его записи в таблицу маршрутизации.</p>


    <center><img src="./img/chapter6/6.263.jpg"></center>
	<p class="img">Рисунок 6.263 &ndash; Использование нескольких протоколов маршрутизации в организации</p>
    <p>Когда маршрутизатор узнает информацию об одной сети из нескольких источников, для определения предпочитаемого ей маршрута он использует административное расстояние (AD) (1 – объявленное расстояние. Расстояние, для которого широковещательная рассылка выполняется вышестоящим соседом. 2 – административное расстояние. Степень доверия источнику информации о маршруте. Для маршрутизаторов Cisco административное расстояние выражается в виде числового значения от 0 до 255. Чем выше значение, тем ниже степень доверия). Всем методам получения информации о маршрутизации программное обеспечение назначает определенное административное расстояние.</p>
    <p>Если маршрутизатор узнает о конкретной подсети посредством протоколов RIP и OSPF, для таблицы маршрутизации он выберет маршрут, сообщенный по протоколу OSPF. Его административное расстояние меньше и поэтому более желательно. Код в начале таблицы маршрутизации указывает источник маршрута, или каким образом он был сообщен. Каждый код ассоциируется с конкретным административным расстоянием.</p>

    <center><img src="./img/chapter6/6.264.jpg"></center>
	<p class="img">Рисунок 6.264 &ndash; Административные расстояния различных протоколов маршрутизации</p>


    <p>Если две сети имеют одинаковый базовый адрес и маску подсети, маршрутизатор рассматривает их как идентичные. Он рассматривает суммированную сеть и отдельную сеть, входящую в эту суммарную сеть, как разные сети.</p>
    <p>Суммированная сеть 192.168.0.0/22 и отдельная сеть 192.168.1.0 /24 являются отдельными записями, несмотря на то что суммированная сеть содержит эту отдельную сеть. При возникновении этой ситуации в таблицу маршрутизации заносятся обе сети. Выбор используемого маршрута падает на запись с самым близким или самым длинным совпадением префикса.</p>
    <p>Например, маршрутизатор получает пакет с IP-адресом назначения 172.16.0.10. Этому пакету подходит три возможных маршрута: 172.16.0.0/12, 172.16.0.0/18 и 172.16.0.0/26. Из всех трех маршрутов маршрут с адресом 172.16.0.0/26 имеет самое длинное совпадение. Чтобы эти маршруты рассматривались как подходящие, в маске подсети маршрута должно быть некоторое количество совпадающих битов.</p>

    <center><img src="./img/chapter6/6.265.jpg"></center>
	<p class="img">Рисунок 6.265 &ndash; Выбор записи в таблице маршрутизации</p>


    <p class="title">Контрольные вопросы для закрепления изученного материала</p>
<ol>
<li> Укажите, для чего используется маршрутизация в вычислительных сетях.</li>
<li> В чем заключается маршрутизация с помощью протоколов на основе векторов расстояния?</li>
<li> Назовите основные отличия протоколов RIP и EIGRP?</li>
<li> Перечислите протоколы на основе состояния канала.</li>
<li> Каковы возможные проблемы и ограничения при использовании протокола OSPF?</li>
</ol>

</BODY>
</HTML>