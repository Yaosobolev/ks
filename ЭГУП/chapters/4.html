<HTML>

	<TITLE>Глава 4. Технологии локальных сетей </TITLE>

<HEAD>

	<link href="../css/style.css" rel="stylesheet" type="text/css">

</HEAD>

<BODY>

	<p class="main-title">4 Технологии локальных сетей</p>

	<p class="title">4.1 Коммутация в вычислительных сетях</p>
	<p class="title">4.1.1 Коммутация и сегментация</p>

	<p>Хотя для создания корпоративной сети используются как коммутаторы, так и маршрутизаторы, архитектура большинства корпоративных сетей в значительной степени основывается на коммутаторах. Стоимость коммутаторов из расчета на порт ниже, чем у маршрутизаторов, и они обеспечивают быструю пересылку кадров со скоростью передачи данных по кабелю (скорость, с которой пакеты передаются по сети).</p>
	<p>Коммутатор - универсальное устройство 2-го уровня. В самом простом варианте использования он заменяет концентратор в качестве центральной точки для соединения нескольких узлов. В более сложном варианте коммутатор подключается к одному или нескольким коммутаторам для создания, контроля и обслуживания резервных каналов и соединений VLAN (виртуальная локальная сеть. Группа устройств в сети, обычно станции конечного пользователя, которые обмениваются данными, как если бы их подключили к одному и тому же сегменту сети, несмотря на то, что они могут быть подключены к различным сегментам. Виртуальные локальные сети настраиваются на основе коммутаторов рабочей группы. Коммутаторы могут взаимодействовать с виртуальными локальными сетями с протоколов магистрального канала VLAN. VLAN  известна также под названием “виртуальная LAN”). Коммутатор одинаково обрабатывает все типы трафика, независимо от их назначения.</p>
	<p>Коммутатор передает трафик в соответствии с MAC-адресами. Каждый коммутатор ведет таблицу MAC-адресов в высокопроизводительной памяти, которая называется ассоциативной памятью (CAM) (ассоциативная память. Таблица MAC-адресов, поддерживаемых коммутатором. Ассоциативная память воссоздается каждый раз при включении коммутатора). Коммутатор заново создает таблицу при каждой активации, используя MAC-адреса источника входящих кадров и номера портов, через которые они получены [7].</p>

	<center><img src="./img/chapter4/4.1.jpg"></center>
	<p class="img">Рисунок 4.1 &ndash; Таблица MAC-адресов коммутатора</p>

	<p>Коммутатор удаляет записи из таблицы MAC-адресов, если они не используются в течение определенного периода времени. Этот период называется таймером устаревания (период времени, в течение которого должна использоваться запись перед тем, как коммутатор удалит ее из таблицы MAC-адресов), удаление записи называется устареванием.</p>
	<p>Как только одноадресный (сообщение, отправляемое по сети одному получателю) кадр прибывает на порт, коммутатор находит MAC-адрес источника в кадре. Затем он выполняет поиск по таблице MAC-адресов и находит запись, соответствующую адресу.</p>
	<p>Если MAC-адрес отсутствует в таблице, коммутатор добавляет MAC-адрес и номер порта и активирует таймер устаревания. Если MAC-адрес источника уже существует, коммутатор сбрасывает таймер устаревания.</p>
	<p>Затем коммутатор ищет MAC-адрес назначения в таблице MAC-адресов. Если запись существует, коммутатор пересылает кадр на порт с соответствующим номером. Если записи нет, коммутатор выполняет лавинную маршрутизацию (технология, используемая коммутаторами для перенаправления полученного трафика интерфейса всем остальным интерфейсам устройства, кроме интерфейса, на котором были первоначально получены пакеты) кадра изо всех портов, кроме порта, на котором он принят.</p>

	<center><img src="./img/chapter4/4.2.jpg"></center>
	<p class="img">Рисунок 4.2 &ndash; Таблица MAC-адресов и процесс устаревания на одном порте. Часть 1</p>
	<center><img src="./img/chapter4/4.3.jpg"></center>
	<p class="img">Рисунок 4.3 &ndash; Таблица MAC-адресов и процесс устаревания на одном порте. Часть 2</p>
	<center><img src="./img/chapter4/4.4.jpg"></center>
	<p class="img">Рисунок 4.4 &ndash; Таблица MAC-адресов и процесс устаревания на одном порте. Часть 3</p>
	<center><img src="./img/chapter4/4.5.jpg"></center>
	<p class="img">Рисунок 4.5 &ndash; Таблица MAC-адресов и процесс устаревания на одном порте. Часть 4</p>
	<center><img src="./img/chapter4/4.6.jpg"></center>
	<p class="img">Рисунок 4.6 &ndash; Таблица MAC-адресов и процесс устаревания на одном порте. Часть 5</p>
	<center><img src="./img/chapter4/4.7.jpg"></center>
	<p class="img">Рисунок 4.7 &ndash; Таблица MAC-адресов и процесс устаревания на одном порте. Часть 6</p>
	<center><img src="./img/chapter4/4.8.jpg"></center>
	<p class="img">Рисунок 4.8 &ndash; Таблица MAC-адресов и процесс устаревания на одном порте. Часть 7</p>
	<center><img src="./img/chapter4/4.9.jpg"></center>
	<p class="img">Рисунок 4.9 &ndash; Таблица MAC-адресов и процесс устаревания на одном порте. Часть 8</p>
	<center><img src="./img/chapter4/4.10.jpg"></center>
	<p class="img">Рисунок 4.10 &ndash; Таблица MAC-адресов и процесс устаревания на одном порте. Часть 9</p>
	<center><img src="./img/chapter4/4.11.jpg"></center>
	<p class="img">Рисунок 4.11 &ndash; Таблица MAC-адресов и процесс устаревания на одном порте. Часть 10</p>



	<p>В корпоративной среде высокая доступность, скорость и полоса пропускания сети имеют первостепенное значение. Размер доменов широковещательной рассылки (организуется устройствами, которые получают кадры широковещательной рассылки, порожденные любым из устройств в границах набора. Границей домена широковещательной рассылки обычно является маршрутизатор, поскольку маршрутизаторы не пересылают широковещательные кадры) и коллизионных доменов (область сети Ethernet, в которой передаются кадры, вызывающие коллизию. Повторители и концентраторы обладают коллизионным доменом. Коммутаторы локальных сетей, мосты и маршрутизаторы коллизионным доменом не обладают) влияет на потоки трафика. Как правило, большие домены широковещательной рассылки и коллизионные домены ухудшают эти критически важные показатели.</p>
	<p>Если коммутатор получает широковещательный кадр, он рассылает его из всех активных интерфейсов, так же как кадр с неизвестным MAC-адресом назначения. Все устройства, получающие широковещательную рассылку, составляют домен широковещательной рассылки. При увеличении числа соединенных коммутаторов размер домена широковещательной рассылки также увеличивается.</p>
	<p>Коллизионные домены создают аналогичную проблему. Чем больше устройств входит в коллизионный домен, тем чаще они возникают.</p>
	<p>Использование концентраторов увеличивает коллизионные домены. Однако коммутаторы используют функцию под названием микросегментация (деление сети на сегменты меньшего размера, обычно с целью увеличения общей полосы пропускания к сетевым устройствам), чтобы уменьшить размер коллизионного домена до одного порта коммутатора.</p>

	<center><img src="./img/chapter4/4.12.jpg"></center>
	<p class="img">Рисунок 4.12 &ndash; Пример использования широковещательных рассылок в сети. Часть 1</p>
	<center><img src="./img/chapter4/4.13.jpg"></center>
	<p class="img">Рисунок 4.13 &ndash; Пример использования широковещательных рассылок в сети. Часть 2</p>
	<center><img src="./img/chapter4/4.14.jpg"></center>
	<p class="img">Рисунок 4.14 &ndash; Пример использования широковещательных рассылок в сети. Часть 3</p>
	<center><img src="./img/chapter4/4.15.jpg"></center>
	<p class="img">Рисунок 4.15 &ndash; Пример использования широковещательных рассылок в сети. Часть 4</p>



	<p>Когда узел подключается к порту коммутатора, создается выделенное подключение. Когда два соединенных узла взаимодействуют друг с другом, коммутатор обращается к таблице коммутации и создает виртуальное подключение или микросегмент (деление сети на сегменты меньшего размера, обычно с целью увеличения общей полосы пропускания к сетевым устройствам) между портами. </p>
	<p>Коммутатор поддерживает виртуальный канал (логические канал, создаваемый для надежного обмена данными между двумя сетевыми устройствами. Виртуальный канал характеризуется парой идентификаторов VPI/VCI и может быть как постоянным (PVC), так и коммутируемым (SVC). Виртуальные каналы используются в сетях Frame Relay и X.25. Термин “виртуальный канал” применяется в ATM; в других сетях он называется виртуальной цепью) до прекращения сеанса. Несколько виртуальных каналов могут быть активны одновременно. Микросегментация улучшает коэффициент использования полосы пропускания за счет уменьшения количества коллизий и поддержки нескольких параллельных подключений. </p>
	<p>Коммутаторы могут поддерживать симметричную и асимметричную коммутацию (случай, когда выполнение некоторой функции в сети занимает большее время, чем обратной ей функции. Примером асимметричной функции является сжатие и распаковка сжатых данных). Коммутаторы, все порты которых работают на одинаковой скорости, называются симметричными. Однако многие коммутаторы имеют два или более высокоскоростных портов. Эти высокоскоростные порты, или порты для каскадирования (высокоскоростной порт, который подключается к областям, которые обладают более высоким требованиями к полосе пропускания, например, к другим коммутаторам, серверным фермам или к другим сетям), используются для подключения к зонам с более высокими требованиями к полосе пропускания. Сферы применения таких портов [8]:</p>

	<ul type="square">
		<li>подключение к другим коммутаторам;</li>
		<li>каналы связи с серверами или серверными фермами;</li>
		<li>подключение к другим сетям.</li>
	</ul>

	<p>Для соединения портов, работающих на разных скоростях, используется асимметричная коммутация. При необходимости коммутатор сохраняет информацию в памяти, чтобы создать буфер между портами с разными скоростями. Асимметричные коммутаторы широко распространены в корпоративных средах.</p>

	<center><img src="./img/chapter4/4.16.jpg"></center>
	<p class="img">Рисунок 4.16 &ndash; Микросегментация сети с помощью коммутаторов</p>


	<p>“FF” - это широковещательный MAC-адрес, который пересылается на все порты, за исключением исходного порта.</p>
	<p>Кадр рассылается по всем портам (за исключением исходного) только в том случае, если таблица MAC-адресов коммутатора не содержит MAC-адрес назначения.</p>
	<p>Коммутатор добавит новый MAC-адрес в таблицу MAC-адресов, основываясь на MAC-адресе источника.   Если MAC-адрес источника уже присутствует в таблице, таблица дополняться не будет.  Если MAC-адрес назначения не присутствует в таблице, таблица дополнится новым адресом.</p>
	<p>Коммутатор сбросит кадр, если устройство назначения и устройство-источник подключены к одному и тому же порту, а MAC-адрес назначения находится в таблице MAC-адресов.  В данном упражнении это происходит на одном порту, подключенном к концентратору с двумя узлами.</p>

	<p class="title">4.1.2 Многоуровневая коммутация</p>

	<p>Традиционно сети состояли из отдельных устройств 2-го и 3-го уровней. Каждое устройство использовало различные методы обработки и пересылки трафика.</p>
	<p>Уровень 2. Коммутаторы уровня 2 являются аппаратными. Они пересылают трафик со скоростью, соответствующей скорости передачи среды, используя внутренние схемы, которые физически соединяют каждый порт со всеми остальными портами. Процесс пересылки использует MAC-адрес и наличие MAC-адреса назначения в таблице MAC-адресов. Коммутатор 2-го уровня пересылает трафик только внутри одного сетевого сегмента или подсети.</p>
	<p>Уровень 3. Маршрутизаторы являются программными устройствами и используют микропроцессоры (микросхемы, которые содержат блок центрального процессора для устройства) для маршрутизации на основе IP-адресов. Маршрутизация 3-го уровня обеспечивает пересылку трафика между разными сетями и подсетями. Когда пакет принимается на интерфейсе маршрутизатора, он использует программное обеспечение для поиска IP-адреса назначения и выбора оптимального пути к сети назначения. Затем маршрутизатор передает пакет на нужный выходной интерфейс.</p>

	<center><img src="./img/chapter4/4.17.jpg"></center>
	<p class="img">Рисунок 4.17 &ndash; Многоуровневая коммутация</p>

	<p>Коммутация 3-го уровня, или многоуровневая коммутация (устройство, которое фильтрует и перенаправляет пакеты, на основе MAC-адресов и сетевых адресов. Коммутатор уровня 2/уровня 3 является многоуровневым коммутатором), объединяет аппаратную коммутацию и аппаратную маршрутизацию в одном устройстве.</p>
	<p>Многоуровневый коммутатор объединяет функции коммутатора 2-го уровня и маршрутизатора 3-го уровня. Коммутация 3-го уровня выполняется в интегральной схеме прикладной ориентации (ASIC) (схема, которая предоставляет точные инструкции для функционирования устройства во время коммутирования на третьем уровне модели OSI.). Для функций пересылки кадров и пакетов используется одна микросхема ASIC.</p>
	<p>Многоуровневые коммутаторы часто сохраняют или добавляют в кэш (процесс хранения данных или место сохраненных данных) данные маршрутизации по источнику и месту назначения, полученные из первого пакета в диалоге. Последующим пакетам не приходится выполнять поиск в таблице маршрутизации, так как они находят данные маршрутизации в памяти. Кэширование еще больше увеличивает производительность этих устройств.</p>

	<center><img src="./img/chapter4/4.18.jpg"></center>
	<p class="img">Рисунок 4.18 &ndash; Коммутаторы 2 и 3 уровня</p>

	<p class="title">4.1.3 Типы коммутации </p>

	<p>Когда коммутация только появилась, коммутаторы поддерживали один из двух методов пересылки кадра с одного порта на другой. Эти методы: пересылка с буферизацией (технология, при которой кадры полностью обрабатываются перед посылкой из соответствующего порта. Коммутация с буферизацией является процессом, при котором происходит вычисление циклической суммы контроля избыточности и проверка адреса назначения) и коммутация без буферизации (процесс, при котором данные передаются через коммутатор таким образом, что передний край пакета выходит из коммутатора на порте вывода перед тем, как пакет закончит передаваться на порт ввода. Коммутация без буферизации позволяет устройству читать, обрабатывать и пересылать пакеты сразу же после обнаружения  адреса назначения и определения исходящего порта). Каждый из методов имеет свои преимущества и недостатки.</p>
	<p>1 Пересылка с буферизацией. При использовании этого типа коммутации полный кадр считывается и сохраняется в памяти перед передачей устройству назначения. Коммутатор проверяет целостность битов в кадре, вычисляя значение циклического контроля четности (CRC) (технология проверки на наличие ошибок при пересылке данных с буферизацией, которая подсчитывает контрольную сумму пакетов, генерируемую оконечным устройством, с ее последующим сравнением с контрольной суммой, вычисленной на основе полученных данных. CRC-ошибка может служить признаком шума, скачков коэффициента усиления или проблем передачи данных в канале или интерфейсе). Если рассчитанное значение CRC совпадает со значением в поле CRC кадра, коммутатор пересылает кадр через порт назначения. Коммутатор не пересылает кадры, если значения CRC не совпадают. Значение CRC находится в поле контрольной последовательности кадра (FCS) (символы, добавленные в кадр с целью контроля ошибок. Поле контрольной суммы используется в HDLC, Frame Relay и в других протоколах канального уровня) в кадре Ethernet.</p>
	<p>Хотя этот метод позволяет предотвратить передачу поврежденных кадров в другие сегменты, он вызывает значительное запаздывание. Из-за этого коммутация с буферизацией в основном используется в средах с высокой вероятностью возникновения ошибок, например в средах, часто подвергающихся воздействию электромагнитных импульсов [9].</p>

	<center><img src="./img/chapter4/4.19.jpg"></center>
	<p class="img">Рисунок 4.19 &ndash; Коммутация с буферизацией и проверкой CRC. Часть 1</p>
	<center><img src="./img/chapter4/4.20.jpg"></center>
	<p class="img">Рисунок 4.20 &ndash; Коммутация с буферизацией и проверкой CRC. Часть 2</p>
	<center><img src="./img/chapter4/4.21.jpg"></center>
	<p class="img">Рисунок 4.21 &ndash; Коммутация с буферизацией и проверкой CRC. Часть 3</p>
	<center><img src="./img/chapter4/4.22.jpg"></center>
	<p class="img">Рисунок 4.22 &ndash; Коммутация с буферизацией и проверкой CRC. Часть 4</p>
	<center><img src="./img/chapter4/4.23.jpg"></center>
	<p class="img">Рисунок 4.23 &ndash; Коммутация с буферизацией и проверкой CRC. Часть 5</p>
	<center><img src="./img/chapter4/4.24.jpg"></center>
	<p class="img">Рисунок 4.24 &ndash; Коммутация с буферизацией и проверкой CRC. Часть 6</p>
	<center><img src="./img/chapter4/4.25.jpg"></center>
	<p class="img">Рисунок 4.25 &ndash; Коммутация с буферизацией и проверкой CRC. Часть 7</p>
	<center><img src="./img/chapter4/4.26.jpg"></center>
	<p class="img">Рисунок 4.26 &ndash; Коммутация с буферизацией и проверкой CRC. Часть 8</p>


	<p>2 Сквозная коммутация. Другой основной метод коммутации - сквозная коммутация. Сквозная коммутация включает два метода: быстрая пересылка (метод коммутации без буферизации, в котором коммутатор перенаправляет кадр до получения всех кадров. С помощью метода быстрой пересылки коммутатор перенаправляет кадр из порта назначения немедленно, после прочтения конечного MAC-адреса. Коммутатор не вычисляет и не проверяет значения контрольной циклической суммы. Метод быстрой пересылки обладает наименьшим запаздыванием, однако может отправить коллизионный фрагмент и поврежденный кадр. Это метод коммутации работает лучше всего в стабильных сетях с малым числом ошибок) и коммутация с исключением фрагментов (исключение частей разбитого в результате коллизии пакета). При использовании обоих методов коммутатор пересылает кадр, не дожидаясь его полного приема. Поскольку коммутатор не вычисляет и не проверяет значение CRC, возможна передача поврежденных кадров.</p>
	<p>Быстрая пересылка - самый быстрый метод коммутации. Коммутатор пересылает кадры из порта назначения сразу после считывания MAC-адреса. Этот метод характеризуется наименьшим запаздыванием, но может пересылать коллизионные и поврежденные фрагменты. Этот метод коммутации лучше всего работает в стабильной сети с небольшим количеством ошибок.</p>
	<p>При коммутации с исключением фрагментов коммутатор считывает первые 64 байта кадра перед началом пересылки этого кадра из порта назначения. Минимальный допустимый кадр Ethernet составляет 64 байта. Кадры меньшего размера, как правило, являются результатом коллизий и называются кадрами с недопустимо малой длиной, или пакет - “коротышка” (кадр с размером меньше 64 байт, который обычно является результатом коллизии. При коммутации с исключением фрагментов коммутатор считывает первые 64 байта кадра перед началом его пересылки в порт назначения. Проверка первых 64 байт гарантирует, что коммутатор не перенаправит коллизионный фрагмент). Проверка первых 64 байт позволяет предотвратить пересылку коллизионных фрагментов коммутатором.</p>
	<p>Коммутация с буферизацией имеет наибольшее запаздывание, быстрая пересылка - наименьшее. Запаздывание коммутации с исключением фрагментов лежит посредине между этими методами. Коммутация с исключением фрагментов является оптимальным методом в средах, в которых возникает много коллизий. В качественно спроектированной коммутируемой сети коллизии не являются проблемой, потому предпочтительным методом является быстрая коммутация [10].</p>

	<center><img src="./img/chapter4/4.27.jpg"></center>
	<p class="img">Рисунок 4.27 &ndash; Пересылка кадров с использованием метода “быстрая пересылка”. Часть 1</p>
	<center><img src="./img/chapter4/4.28.jpg"></center>
	<p class="img">Рисунок 4.28 &ndash; Пересылка кадров с использованием метода “быстрая пересылка”. Часть 2</p>
	<center><img src="./img/chapter4/4.29.jpg"></center>
	<p class="img">Рисунок 4.29 &ndash; Пересылка кадров с использованием метода “быстрая пересылка”. Часть 3</p>


	<center><img src="./img/chapter4/4.30.jpg"></center>
	<p class="img">Рисунок 4.30 &ndash; Пересылка кадров с использованием метода “коммутация с исключением фрагментов”. Часть 1</p>
	<center><img src="./img/chapter4/4.31.jpg"></center>
	<p class="img">Рисунок 4.31 &ndash; Пересылка кадров с использованием метода “коммутация с исключением фрагментов”. Часть 2</p>
	<center><img src="./img/chapter4/4.32.jpg"></center>
	<p class="img">Рисунок 4.32 &ndash; Пересылка кадров с использованием метода “коммутация с исключением фрагментов”. Часть 3</p>
	<center><img src="./img/chapter4/4.33.jpg"></center>
	<p class="img">Рисунок 4.33 &ndash; Пересылка кадров с использованием метода “коммутация с исключением фрагментов”. Часть 4</p>



	<p>В настоящий момент большинство коммутаторов для локальных сетей используют метод с буферизацией. Это связано с тем, что новая технология и низкое время обработки позволяют коммутаторам сохранять и обрабатывать кадры почти так же быстро, как при сквозной коммутации, но без ошибок. Кроме того, многие функции высшего класса, такие как многоуровневая коммутация, используют метод коммутации с буферизацией.</p>
	<p>Кроме того, некоторые новые коммутаторы 2-го и 3-го уровней могут изменять метод коммутации в соответствии с меняющимся состоянием сети.</p>
	<p>Эти коммутаторы выполняют быструю пересылку кадров, чтобы обеспечить минимальное запаздывание. Несмотря на то, что коммутатор не выявляет ошибки перед пересылкой кадра, ошибки распознаются, и их количество сохраняется в памяти. Число обнаруженных ошибок сравнивается с предварительно заданным пороговым значением (максимальное число ошибок, которое может произойти перед тем, как коммутатор переедет в режим коммутации с буферизацией для замедления трафика и устранения проблемы).</p>
	<p>Если количество ошибок превышает пороговое значение, значит коммутатор передал недопустимое число ошибочных кадров. В этом случае коммутатор переключается на метод с буферизацией. Если количество ошибок опускается ниже порогового значения, коммутатор возвращается в режим быстрой пересылки. Этот режим называется адаптивной сквозной коммутацией (тип коммутации, при которой поток возвращается обратно к режиму быстрой пересылки, если число ошибок становится меньше определенно порогового значения).</p>

	<center><img src="./img/chapter4/4.34.jpg"></center>
	<p class="img">Рисунок 4.34 &ndash; Преимущества различных видов коммутации</p>

	<p class="title">4.1.4 Безопасность коммутаторов</p>

	<p>Следует поддерживать безопасность сети, независимо от используемого метода коммутации. Средства сетевой безопасности часто сосредотачиваются на маршрутизаторах и блокировании трафика извне. Коммутаторы являются внутренними устройствами организации и разработаны для простого доступа, поэтому к ним применяются только самые простые меры безопасности или не применяются вообще.</p>
	<p>Следует использовать следующие базовые меры безопасности коммутатора, чтобы доступ к нему могли получить только авторизованные сотрудники:</p>

	<ul type="square">
		<li>Защитить физический доступ к устройству. Коммутаторы формируют критически важный канал в сети. Защитите физический доступ к коммутаторам, смонтировав их в стойке и установив стойку в защищенной комнате. Предоставьте доступ только авторизованному сетевому персоналу.</li>
		<li>Использовать безопасные пароли. Все пароли (пользовательского режима, привилегированного режима и доступа через VTY) должны включать не менее 6 неповторяющихся символов. Регулярно меняйте пароли. Никогда не используйте слова, которые можно найти в словаре . Используйте команду enable secret для защиты пароля доступа к привилегированному режиму, так как она использует сложные методы шифрования. Шифруйте все пароли, которые выводятся с файлом рабочей конфигурации. С помощью команды IOS service password-encryption.</li>
		<li>активировать доступ через SSH. SSH – это протокол с архитектурой “клиент-сервер”, который используется для входа в систему удаленного устройства через сеть. Он обеспечивает строгую аутентификацию и безопасный обмен данными через небезопасные каналы. SSH полностью шифрует сеанс входа в систему, включая передачу пароля.</li>
		<li>отслеживать доступ и трафик. Отслеживайте весь трафик, проходящий через коммутатор, чтобы убедиться в его соответствии политикам корпорации. Кроме того, записывайте MAC-адреса всех устройств, подключающихся к порту коммутатора и попытки входа в систему коммутатора. Если коммутатор обнаруживает вредоносный трафик или несанкционированный доступ, примите меры в соответствие с политикой безопасности организации.</li>
		<li>отключить доступ через http. Отключите HTTP-доступ, чтобы никто не мог войти в систему коммутатора и изменить конфигурацию через Интернет. Для отключения HTTP-доступа используется команда no ip http server.</li>
		<li>отключить неиспользуемые порты. Отключите все неиспользуемые порты на коммутаторе, чтобы предотвратить подключение неизвестных компьютеров и беспроводных устройств к свободному порту коммутатора. Для этого необходимо ввести в интерфейсе команду shutdown.</li>
		<li>включить защиту портов. Защита портов ограничивает доступ к порту коммутатора списком определенных MAC-адресов. Введите MAC-адреса вручную или позвольте коммутатору получить их динамически. Определенный порт коммутатора привязывается к MAC-адресам, разрешая только трафик с соответствующих устройств. Если к порту подключается устройство с другим MAC-адресом, коммутатор автоматически отключает этот порт.</li>
		<li>отключить Telnet. Сеансы Telnet отправляют данные через сети общего доступа в виде незашифрованного текста. Сюда входят имена пользователей, пароли и данные. Отключите Telnet-доступ ко всем сетевым устройствам. Для этого откажитесь от настройки паролей для сеансов VTY при входе.</li>
	</ul>

	<center><img src="./img/chapter4/4.35.jpg"></center>
	<p class="img">Рисунок 4.35 &ndash; Базовые меры безопасности коммутатора</p>
	<center><img src="./img/chapter4/4.36.jpg"></center>
	<p class="img">Рисунок 4.36 &ndash; Базовые меры безопасности коммутатора. Физическая безопасность</p>
	<center><img src="./img/chapter4/4.37.jpg"></center>
	<p class="img">Рисунок 4.37 &ndash; Базовые меры безопасности коммутатора. Безопасные пароли</p>
	<center><img src="./img/chapter4/4.38.jpg"></center>
	<p class="img">Рисунок 4.38 &ndash; Базовые меры безопасности коммутатора. Включение SSH</p>
	<center><img src="./img/chapter4/4.39.jpg"></center>
	<p class="img">Рисунок 4.39 &ndash; Базовые меры безопасности коммутатора. Отслеживание </p>
	<center><img src="./img/chapter4/4.40.jpg"></center>
	<p class="img">Рисунок 4.40 &ndash; Базовые меры безопасности коммутатора. Отключение HTTP</p>
	<center><img src="./img/chapter4/4.41.jpg"></center>
	<p class="img">Рисунок 4.41 &ndash; Базовые меры безопасности коммутатора. Отключение портов</p>
	<center><img src="./img/chapter4/4.42.jpg"></center>
	<p class="img">Рисунок 4.42 &ndash; Базовые меры безопасности коммутатора. Защита портов</p>
	<center><img src="./img/chapter4/4.43.jpg"></center>
	<p class="img">Рисунок 4.43 &ndash; Базовые меры безопасности коммутатора. Отключение Telnet</p>



	<p class="title">4.2 Предотвращение петель коммутации</p>
	<p class="title">4.2.1 Резервирование в коммутируемой сети</p>

	<p>Современные корпорации все больше полагаются на сети, иногда от сетей зависит само их существование. Сеть - жизненно важная коммуникация для многих организаций. Простой сети преобразуется в потенциально катастрофические потери бизнеса, прибыли и доверия заказчиков.</p>
	<p>Отказ одного сетевого канала, одного устройства или важного порта коммутатора может стать причиной простоя сети. Чтобы исключить критические точки отказа и обеспечить высокую надежность, в сетевую архитектуру необходимо ввести резервирование (1 – дублирование компонентов в сети, например устройств, служб и соединений, для поддержки работоспособности при выходе из строя любого из компонентов, 2 – часть данных, содержащихся в сообщении, которые могут быть удалены без потери контекста). Резервирование реализуется путем установки дублированного оборудования и сетевых устройств в важных областях.</p>
	<p>Иногда полное резервирование всех каналов и устройств становится неоправданно дорогим. Сетевые инженеры часто вынуждены искать компромисс между затратами на резервирование и требованиями к доступности сети. Простой сети преобразуется в потенциально катастрофические потери бизнеса, прибыли и доверия заказчиков.</p>

	<center><img src="./img/chapter4/4.44.jpg"></center>
	<p class="img">Рисунок 4.44 &ndash; Резервирование в коммутируемой сети</p>

	<p>Резервирование обозначает наличие двух разных путей к одному месту назначения. Примеры резервирования в несетевых средах: две дороги в один город, два моста через реку или два выхода в здании. Если один путь заблокирован, второй остается доступным.</p>
	<p>Резервирование коммутаторов реализуется путем создания нескольких каналов между ними. Резервные каналы в коммутируемой сети снижают перегрузку (фактический объем трафика превышает номинальное значение пропускной способности сети) и поддерживают высокую доступность (условие доступности) и распределение нагрузки [11].</p>
	<p>Однако соединение коммутаторов может стать причиной проблем. В частности, широковещательная природа трафика Ethernet приводит к образованию петель коммутации (вызывает пересылку по сети дублированных кадров. Петля коммутации возникает при наличии более одного маршрута между коммутаторами). Широковещательные кадры циклически распространяются во всех направлениях, вызывая “шторм” (нежелательное событие в сети, при котором число пакетов широковещательной рассылки, пересылаемых одновременно через все сегменты сети, превышает максимально допустимое значение. “Шторм” широковещательных пакетов использует значительную часть пропускной способности сети и, обычно, приводит к простою сети) широковещательных пакетов. Широковещательные штормы занимают всю доступную полосу пропускания, блокируют создание новых сетевых подключений и разрывают существующие подключения.</p>

	<center><img src="./img/chapter4/4.45.jpg"></center>
	<p class="img">Рисунок 4.45 &ndash; Ход возникновения широковещательного шторма. Часть 1</p>
	<center><img src="./img/chapter4/4.46.jpg"></center>
	<p class="img">Рисунок 4.46 &ndash; Ход возникновения широковещательного шторма. Часть 2</p>
	<center><img src="./img/chapter4/4.47.jpg"></center>
	<p class="img">Рисунок 4.47 &ndash; Ход возникновения широковещательного шторма. Часть 3</p>
	<center><img src="./img/chapter4/4.48.jpg"></center>
	<p class="img">Рисунок 4.48 &ndash; Ход возникновения широковещательного шторма. Часть 4</p>
	<center><img src="./img/chapter4/4.49.jpg"></center>
	<p class="img">Рисунок 4.49 &ndash; Ход возникновения широковещательного шторма. Часть 5</p>
	<center><img src="./img/chapter4/4.50.jpg"></center>
	<p class="img">Рисунок 4.50 &ndash; Ход возникновения широковещательного шторма. Часть 6</p>
	<center><img src="./img/chapter4/4.51.jpg"></center>
	<p class="img">Рисунок 4.51 &ndash; Ход возникновения широковещательного шторма. Часть 7</p>
	<center><img src="./img/chapter4/4.52.jpg"></center>
	<p class="img">Рисунок 4.52 &ndash; Ход возникновения широковещательного шторма. Часть 8</p>
	<center><img src="./img/chapter4/4.53.jpg"></center>
	<p class="img">Рисунок 4.53 &ndash; Ход возникновения широковещательного шторма. Часть 9</p>



	<p>Широковещательные штормы - не единственная проблема, обусловленная резервными каналами в коммутируемой сети. Кадры одноадресной пересылки (сообщение. Отправляемое по сети одному получателю) могут вызывать такие проблемы, как множественная передача кадров и нестабильность базы данных MAC-адресов.</p>
	<p>1 Множественная передача кадров. Если узел посылает одноадресный кадр узлу назначения и MAC-адрес не представлен ни в одной из таблиц MAC-адресов подключенных коммутаторов, все коммутаторы выполняют лавинную рассылку этого кадра из всех портов. В сети с петлями кадр может вернуться к исходному коммутатору. Этот процесс повторяется, что приводит к образованию нескольких копий кадра в сети.</p>
	<p>В результате узел назначения получает несколько копий кадра. Это становится причиной трех проблем: неэффективное расходование полосы пропускания, неэффективное расходование циклов ЦП и потенциальное дублирование транзакционного трафика.</p>
	<p>2 Нестабильность базы данных MAC-адресов. Коммутаторы в резервируемой сети могут получать неверные данные о положении узла. Если в сети присутствует петля, один коммутатор может связать MAC-адрес назначения с двумя портами. Это приведет к путанице и неоптимальной пересылке кадров.</p>

	<center><img src="./img/chapter4/4.54.jpg"></center>
	<p class="img">Рисунок 4.54 &ndash; Множественная передача кадров. Часть 1</p>
	<center><img src="./img/chapter4/4.55.jpg"></center>
	<p class="img">Рисунок 4.55 &ndash; Множественная передача кадров. Часть 2</p>
	<center><img src="./img/chapter4/4.56.jpg"></center>
	<p class="img">Рисунок 4.56 &ndash; Множественная передача кадров. Часть 3</p>
	<center><img src="./img/chapter4/4.57.jpg"></center>
	<p class="img">Рисунок 4.57 &ndash; Множественная передача кадров. Часть 4</p>
	<center><img src="./img/chapter4/4.58.jpg"></center>
	<p class="img">Рисунок 4.58 &ndash; Множественная передача кадров. Часть 5</p>
	<center><img src="./img/chapter4/4.59.jpg"></center>
	<p class="img">Рисунок 4.59 &ndash; Множественная передача кадров. Часть 6</p>

	<center><img src="./img/chapter4/4.60.jpg"></center>
	<p class="img">Рисунок 4.60 &ndash; Нестабильность базы MAC-данных адресов. Часть 1</p>
	<center><img src="./img/chapter4/4.61.jpg"></center>
	<p class="img">Рисунок 4.61 &ndash; Нестабильность базы MAC-данных адресов. Часть 2</p>
	<center><img src="./img/chapter4/4.62.jpg"></center>
	<p class="img">Рисунок 4.62 &ndash; Нестабильность базы MAC-данных адресов. Часть 3</p>
	<center><img src="./img/chapter4/4.63.jpg"></center>
	<p class="img">Рисунок 4.63 &ndash; Нестабильность базы MAC-данных адресов. Часть 4</p>
	<center><img src="./img/chapter4/4.64.jpg"></center>
	<p class="img">Рисунок 4.64 &ndash; Нестабильность базы MAC-данных адресов. Часть 5</p>
	<center><img src="./img/chapter4/4.65.jpg"></center>
	<p class="img">Рисунок 4.65 &ndash; Нестабильность базы MAC-данных адресов. Часть 6</p>
	<center><img src="./img/chapter4/4.66.jpg"></center>
	<p class="img">Рисунок 4.66 &ndash; Нестабильность базы MAC-данных адресов. Часть 7</p>



	<p class="title">4.2.2 Протокол STP (Spanning Tree Protocol)</p>


	<p>Протокол STP (протокол связующего дерева. Стандарты формирования мостового соединения, которые используют древовидный алгоритм и позволяют мосту динамически обойти петли в топологии сети путем создания связующего дерева. Мост обменивается BPDU-сообщениями с другими мостами для обнаружения петель, а затем разрывает петли рутем отключения выбранных мостовых интерфейсов) обеспечивает механизм отключения резервных каналов в коммутируемой сети. STP позволяет использовать резервирование, необходимое для надежной эксплуатации, без создания петель коммутации.</p>
	<p>STP основывается на открытых стандартах и используется для создания логической топологии без петель коммутации. </p>
	<p>Протокол STP относительно самодостаточен и требует минимальной настройки. При первом включении коммутаторы с поддержкой STP проверяют коммутируемую сеть на наличие петель. Коммутаторы, обнаруживающие потенциальную петлю, блокируют некоторые из подключенных портов, оставляя другие порты активными для пересылки кадров.</p>

	<center><img src="./img/chapter4/4.67.jpg"></center>
	<p class="img">Рисунок 4.67 &ndash; Сеть без использования протокола STP</p>
	<center><img src="./img/chapter4/4.68.jpg"></center>
	<p class="img">Рисунок 4.68 &ndash; Сеть с использованием протокола STP</p>


	<p>STP задает дерево, которое охватывает все коммутаторы в топологии “иерархическая звезда”. Коммутаторы постоянно проверяют сеть, чтобы гарантировать отсутствие петель и эффективную работу всех портов.</p>
	<p>Чтобы предотвратить образование петель, протокол STP:</p>

	<ul type="square">
		<li>переводит часть интерфейсов в резервный или заблокированный режим;</li>
		<li>оставляет другие интерфейсы в режиме пересылки;</li>
		<li>перенастраивает сеть, активируя соответствующий резервный путь, если путь пересылки становится недоступным.</li>
	</ul>

	<p>В терминологии STP термин “коммутатор” часто заменяется термином “мост”. Например, корневой мост - это основной мост или центральная точка в топологии STP. Корневой мост взаимодействует с другими коммутаторами с помощью блоков данных протокола моста (BPDU) (протокольный блок данных сопряжения. Пакет приветствия протокола связующего дерева, который через заданный период времени пересылается для обмена данными между мостами в сети). BPDU - это кадры, которые рассылаются другим коммутаторам каждые 2 секунды. BPDU содержат следующие сведения:</p>

	<ul type="square">
		<li>Идентификатор протокола. Всегда 0.</li>
		<li>Версия. Всегда 0.</li>
		<li>Тип сообщения. Определяет тип блока BPDU (конфигурационный или уведомление об изменении топологии), содержащийся в кадре.</li>
		<li>Флаги. Используются для обработки изменений в активной топологии.</li>
		<li>Идентификатор корневого моста. Содержит идентификатор моста корневого моста. После конвергенции содержит то же значение, что и все BPDU в коммутируемой сети.</li>
		<li>Стоимость корневого пути. Совокупная совокупность всех каналов на пути к корневому мосту.</li>
		<li>Идентификатор моста. Идентификатор моста, создавшего текущий BPDU.</li>
		<li>Идентификатор порта. Содержит уникальное значение для каждого порта. Содержит значение 0x8001 для порта 1/1, значение 0x8002 для порта 1/2 и т. д.</li>
		<li>Возраст сообщения. Регистрирует время, прошедшее с момента создания данных, из которых получен текущий BPDU, корневым мостом.</li>
		<li>Максимальный возраст. Максимальное время хранения BPDU. Определяет таймер устаревания таблицы моста во время процесса уведомления об изменениях топологии.</li>
		<li>Время приветствия. Время между периодическими конфигурационными BPDU.</li>
		<li>Задержка при пересылке. Время в режимах прослушивания и обучения. Определяет значения таймеров во время процесса уведомления об изменениях топологии.</li>
	</ul>

	<center><img src="./img/chapter4/4.69.jpg"></center>
	<p class="img">Рисунок 4.69 &ndash; Структура кадра BPDU</p>
	<center><img src="./img/chapter4/4.70.jpg"></center>
	<p class="img">Рисунок 4.70 &ndash; Структура кадра BPDU. Идентификатор протокола</p>
	<center><img src="./img/chapter4/4.71.jpg"></center>
	<p class="img">Рисунок 4.71 &ndash; Структура кадра BPDU. Версия </p>
	<center><img src="./img/chapter4/4.72.jpg"></center>
	<p class="img">Рисунок 4.72 &ndash; Структура кадра BPDU. Тип сообщения</p>
	<center><img src="./img/chapter4/4.73.jpg"></center>
	<p class="img">Рисунок 4.73 &ndash; Структура кадра BPDU. Флаги </p>
	<center><img src="./img/chapter4/4.74.jpg"></center>
	<p class="img">Рисунок 4.74 &ndash; Структура кадра BPDU. Идентификатор корневого моста</p>
	<center><img src="./img/chapter4/4.75.jpg"></center>
	<p class="img">Рисунок 4.75 &ndash; Структура кадра BPDU. Флаги </p>
	<center><img src="./img/chapter4/4.76.jpg"></center>
	<p class="img">Рисунок 4.76 &ndash; Структура кадра BPDU. Идентификатор моста</p>
	<center><img src="./img/chapter4/4.77.jpg"></center>
	<p class="img">Рисунок 4.77 &ndash; Структура кадра BPDU. Идентификатор порта </p>
	<center><img src="./img/chapter4/4.78.jpg"></center>
	<p class="img">Рисунок 4.78 &ndash; Структура кадра BPDU. Возраст сообщения</p>
	<center><img src="./img/chapter4/4.79.jpg"></center>
	<p class="img">Рисунок 4.79 &ndash; Структура кадра BPDU. Максимальный возраст</p>
	<center><img src="./img/chapter4/4.80.jpg"></center>
	<p class="img">Рисунок 4.80 &ndash; Структура кадра BPDU. Время приветствия </p>
	<center><img src="./img/chapter4/4.81.jpg"></center>
	<p class="img">Рисунок 4.81 &ndash; Структура кадра BPDU. Задержка при пересылке </p>



	<p>При включении коммутатора каждый порт проходит через последовательность из 4 режимов: блокировка (1 &ndash; состояние системы, при котором отсутствуют пути для завершения канала, 2 &ndash; состояние, при котором одна операция не может быть начата до завершения выполнения другой операции), прослушивание (одно из четырех состояний, при котором порт проходит при включении электропитания коммутатора в STP-сети. Коммутатор прослушивает BPDU-сигналы от соседних коммутаторов), обучение (одно из четырех состояний, которое порт проходит при включении электропитания коммутатора в STP-сети. Коммутатор использует данные, полученные при обучении, для пересылки пакетов) и пересылка (процесс передачи кадра из порта по направлению к получателю через устройство сетевого взаимодействия. Примерами устройств, которые пересылают кадры, являются узлы, повторители, мосты и маршрутизаторы). Пятый режим, “отключен”, указывает на то, что администратор отключил порт коммутатора.</p>
	<p>По мере того, как порт проходит через эти режимы, цвет светодиодных индикаторов меняется от мигающего оранжевого до немигающего зеленого. Прохождение через режимы STP может занять до 50 секунд, после чего коммутатор будет готов к пересылке кадров.</p>
	<p>При включении коммутатор переходит в блокирующий режим, чтобы предотвратить немедленное образование петли. Затем он переходит в режим прослушивания, который подразумевает прием BPDU от соседних коммутаторов. После обработки этой информации коммутатор определяет, какие порты могут пересылать кадры, не формируя петли. Если порт может пересылать кадры, он переходит в режим обучения, а затем в режим пересылки.</p>
	<p>Порты доступа (маршрут к устройству, который не образует петли в коммутируемой сети и всегда перенаправляется для переадресации, если есть присоединенный узел) не образуют петли в коммутируемой сети и всегда переходят в режим пересылки при подключении узла. Магистральные порты (двухточечный канал, который подключает коммутатор к другому коммутатору, маршрутизатору или серверу. Магистраль передает трафик для нескольких виртуальных локальных сетей через тот же самый канал. Виртуальные локальные сети мультиплексируются через это соединение с помощью протокола магистрального канала) могут образовывать петли и переходить в блокирующий режим или в режим обучения [11].</p>
	<p>Режимы порта коммутатора имеют следующие особенности:</p>
	<p>1 Блокирующий режим:</p>

	<ul type="square">
		<li>немигающий желтый;</li>
		<li>принимает BPDU;</li>
		<li>сбрасывает кадры данных;</li>
		<li>не получает адреса;</li>
		<li>переход в режим прослушивания занимает до 20 секунд.</li>
	</ul>

	<p>2 Режим прослушивания:</p>

	<ul type="square">
		<li>мигающий желтый;</li>
		<li>прослушивает BPDU;</li>
		<li>не пересылает кадры;</li>
		<li>не заучивает MAC-адреса;</li>
		<li>определяет, есть ли у коммутатора более одного магистрального порта, что может привести к образованию петли;</li>
		<li>если петля есть, переходит в блокирующий режим;</li>
		<li>если петли нет, переходит в режим обучения;</li>
		<li>переходи в режим обучения занимает 15 секунд, также называется задержкой при пересылке.</li>
	</ul>

	<p>3 Режим обучения:</p>

	<ul type="square">
		<li>мигающий желтый;
		<li>обрабатывает BPDU;</li>
		<li>получает MAC-адреса из принятого трафика;</li>
		<li>не пересылает кадры;</li>
		<li>переход в режим пересылки занимает 15 секунд.</li>
	</ul>

	<p>4 Режим пересылки:</p>

	<ul type="square">
		<li>мигающий зеленый;</li>
		<li>обрабатывает BPDU;</li>
		<li>получает MAC-адреса;</li>
		<li>пересылает кадры.</li>
	</ul>

	<center><img src="./img/chapter4/4.82.jpg"></center>
	<p class="img">Рисунок 4.82 &ndash; Прохождение порта через режимы STP. Порт отключен </p>
	<center><img src="./img/chapter4/4.83.jpg"></center>
	<p class="img">Рисунок 4.83 &ndash; Прохождение порта через режимы STP. Блокирующий режим </p>
	<center><img src="./img/chapter4/4.84.jpg"></center>
	<p class="img">Рисунок 4.84 &ndash; Прохождение порта через режимы STP. Режим прослушивания</p>
	<center><img src="./img/chapter4/4.85.jpg"></center>
	<p class="img">Рисунок 4.85 &ndash; Прохождение порта через режимы STP. Режим обучения </p>
	<center><img src="./img/chapter4/4.86.jpg"></center>
	<p class="img">Рисунок 4.86 &ndash; Прохождение порта через режимы STP. Режим пересылки </p>



	<p class="title">4.2.3 Корневые мосты</p>

	<p>Коммутаторы в сети определяют коммутатор, который является центральной точкой сети, чтобы протокол STP мог функционировать. STP использует центральную точку сети, которая называется корневым мостом (устройство в древовидной сетевой архитектуре, предназначенное для пересылки пакетов, которое получает информацию о топологии и уведомляет все другие мосты в сети при необходимости изменения топологии. Корневой мост предотвращает формирование петель и предоставляет средства защиты от сбоев в канале. Корневой мост известен также под названием “корневой коммутатор”) или корневым коммутатором (корневой мост), для определения портов, которые необходимо блокировать, и портов, которые следует перевести в режим пересылки. Корневой мост рассылает кадры BPDU с информацией о топологии сети всем остальным коммутаторам. Эта информация обеспечивает перенастройку сети в случае отказа.</p>
	<p>В каждой сети работает только один корневой мост, который выбирается на основании идентификатора моста (BID) (идентификатор моста. Идентификационный код корневого моста, который является центральным узлом в STP-сети). BID равняется сумме значения приоритета моста и его MAC-адреса.</p>
	<p>Значение приоритета моста по умолчанию равняется 32 768. Если MAC-адрес коммутатора AA-11-BB-22-CC-33, BID будет равен 32768: AA-11-BB-22-CC-33.</p>

	<center><img src="./img/chapter4/4.87.jpg"></center>
	<p class="img">Рисунок 4.87 &ndash; Идентификатор моста</p>

	<p>Мост с наименьшим значением BID становится корневым. Поскольку коммутаторы, как правило, используют одинаковое значение приоритета по умолчанию, коммутатор с наименьшим MAC-адресом становится корневым мостом. </p>
	<p>При включении коммутатор предполагает, что является корневым мостом, и рассылает кадры BPDU со своим идентификатором BID. Например, если коммутатор S2 объявляет корневой идентификатор меньше, чем идентификатор S1, S1 прекращает объявление своего идентификатора моста и принимает корневой идентификатор S2. S2 становится корневым мостом. </p>
	<p>STP использует три типа портов: корневые порты (STP назначенный порт, который обеспечивает маршрут оптимальной стоимости к корневому мосту), назначенные порты (интерфейс устройства, который перенаправляет трафик к корневому мосту, но не подключается к маршруту оптимальной стоимости) и заблокированные порты (1 – состояние системы коммутации, при котором отсутствуют пути для завершения канала, 2 – состояние, при котором одна операция не может быть начата до завершения выполнения другой операции). </p>
	<p>1 Корневой порт. Порт с маршрутом оптимальной стоимости (вычисление, выполняемое коммутатором для поиска маршрута, который использует наименьшую полосу пропускания для каждого соединения, необходимого для достижения корневого моста) к корневому мосту назначается корневым. Коммутаторы вычисляют путь с наименьшей стоимостью, используя стоимость полосы пропускания каждого канала на пути к корневому мосту. </p>
	<p>2 Назначенный порт. Назначенный порт пересылает трафик к корневому мосту, но не подключен к пути с наименьшей стоимостью.</p>
	<p>3 Заблокированный порт. Заблокированный порт не пересылает трафик.</p>

	<center><img src="./img/chapter4/4.88.jpg"></center>
	<p class="img">Рисунок 4.88 &ndash; Различные типы портов протокола STP</p>

	<p>Перед настройкой STP сетевой техник планирует и оценивает сеть, чтобы выбрать коммутатор, который будет оптимальным корневым мостом STP. Если корневой мост будет выбран по минимальному MAC-адресу, пересылка может быть неоптимальной.</p>
	<p>В качестве корневого моста лучше всего будет работать коммутатор, расположенный в центре сети. Блокировка порта, расположенного на периферии сети, приведет к тому, что трафик будет передаваться к месту назначения по более длинному маршруту, чем при использовании коммутатора в центре сети.</p>
	<p>Чтобы задать корневой мост, для BID выбранного коммутатора настраивается минимальный приоритет. Значение приоритета может находиться в диапазоне от 0 до 65 535, но шаг между значениями составляет 4 096. Значение по умолчанию - 32 768.</p>

	<center><img src="./img/chapter4/4.89.jpg"></center>
	<p class="img">Рисунок 4.89 &ndash; Выбор корневого моста</p>

	<p>После задания корневого моста, а также корневых, назначенных и заблокированных портов, STP рассылает кадры BPDU по коммутируемой сети с 2-секундным интервалом. STP продолжает отслеживать эти BPDU, чтобы убедиться в отсутствии отказавших каналов и новых петель.</p>
	<p>Если происходит отказ канала, STP перерассчитывается путем:</p>

	<ul type="square">
		<li>перевода некоторых портов из блокирующего режима в режим пересылки;</li>
		<li>перевода некоторых портов из режима пересылки в блокирующий режим;</li>
		<li>формирования нового дерева STP для предотвращения образования петель в сети.</li>
	</ul>

	<p>Протокол STP не является мгновенным. Когда канал отключается, STP обнаруживает отказ и перерассчитывает наилучшие пути через сеть. Этот расчет и процесс перехода занимают от 30 до 50 секунд для каждого коммутатора. Пользовательские данные не проходят через порты, для которых выполняется перерасчет.</p>
	<p>Время ожидания некоторых пользовательских приложений может истечь во время перерасчета, что может привести к снижению производительности и потере прибыли. Частый перерасчет STP негативно влияет на время работы систем.</p>

	<center><img src="./img/chapter4/4.90.jpg"></center>
	<p class="img">Рисунок 4.90 &ndash; Процесс повторного расчета связующего дерева. Часть 1</p>
	<center><img src="./img/chapter4/4.91.jpg"></center>
	<p class="img">Рисунок 4.91 &ndash; Процесс повторного расчета связующего дерева. Часть 2</p>
	<center><img src="./img/chapter4/4.92.jpg"></center>
	<p class="img">Рисунок 4.92 &ndash; Процесс повторного расчета связующего дерева. Часть 3</p>
	<center><img src="./img/chapter4/4.93.jpg"></center>
	<p class="img">Рисунок 4.93 &ndash; Процесс повторного расчета связующего дерева. Часть 4</p>
	<center><img src="./img/chapter4/4.94.jpg"></center>
	<p class="img">Рисунок 4.94 &ndash; Процесс повторного расчета связующего дерева. Часть 5</p>
	<center><img src="./img/chapter4/4.95.jpg"></center>
	<p class="img">Рисунок 4.95 &ndash; Процесс повторного расчета связующего дерева. Часть 6</p>
	<center><img src="./img/chapter4/4.96.jpg"></center>
	<p class="img">Рисунок 4.96 &ndash; Процесс повторного расчета связующего дерева. Часть 7</p>
	<center><img src="./img/chapter4/4.97.jpg"></center>
	<p class="img">Рисунок 4.97 &ndash; Процесс повторного расчета связующего дерева. Часть 8</p>
	<center><img src="./img/chapter4/4.98.jpg"></center>
	<p class="img">Рисунок 4.98 &ndash; Процесс повторного расчета связующего дерева. Часть 9</p>
	<center><img src="./img/chapter4/4.99.jpg"></center>
	<p class="img">Рисунок 4.99 &ndash; Процесс повторного расчета связующего дерева. Часть 10</p>
	<center><img src="./img/chapter4/4.100.jpg"></center>
	<p class="img">Рисунок 4.100 &ndash; Процесс повторного расчета связующего дерева. Часть 11</p>
	<center><img src="./img/chapter4/4.101.jpg"></center>
	<p class="img">Рисунок 4.101 &ndash; Процесс повторного расчета связующего дерева. Часть 12</p>
	<center><img src="./img/chapter4/4.102.jpg"></center>
	<p class="img">Рисунок 4.102 &ndash; Процесс повторного расчета связующего дерева. Часть 13</p>
	<center><img src="./img/chapter4/4.103.jpg"></center>
	<p class="img">Рисунок 4.103 &ndash; Процесс повторного расчета связующего дерева. Часть 14</p>
	<center><img src="./img/chapter4/4.104.jpg"></center>
	<p class="img">Рисунок 4.104 &ndash; Процесс повторного расчета связующего дерева. Часть 15</p>
	<center><img src="./img/chapter4/4.105.jpg"></center>
	<p class="img">Рисунок 4.105 &ndash; Процесс повторного расчета связующего дерева. Часть 16</p>



	<p>Крупный корпоративный сервер подключен к порту коммутатора. Если для этого порта выполняется перерасчет из-за STP, сервер будет недоступен в течение 50 секунд. Трудно представить, какое количество транзакций будет потеряно за это время.</p>
	<p>В стабильной сети перерасчеты STP редки. Если сеть нестабильна, необходимо проверить стабильность коммутаторов и изменения их конфигураций. Одна из самых распространенных причин перерасчетов STP - неисправный источник питания или кабель питания коммутатора. Неисправность источника питания вызывает неожиданную перезагрузку устройства.</p>
	<p>Ряд усовершенствований STP сводит к минимуму время простоев, вызванных перерасчетом STP.</p>
	<p>1 PortFast. STP PortFast (модернизация STP, которая немедленно перевести порта доступа в состояние пересылки, путем пропуска состояний прослушивания и обучения. Использование PortFast в портах доступа, подключенных к одиночной рабочей станции или к серверу, позволяет этим устройствам без задержек подключиться к сети) немедленно переводит порт доступа в режим пересылки, минуя режимы прослушивания и обучения. Применение PortFast на портах доступа, подключенных к одной рабочей станции или серверу, позволит им немедленно подключаться к сети, не ожидая конвергенции STP.</p>
	<p>2 UplinkFast. STP UplinkFast (модернизация STP для минимизации коэффициента простоя во время пересчета. STP UplinkFast ускоряет выбор нового корневого порта при разрыве соединения или выхода из строя коммутатора, или в случае перенастройки STP. Переход корневого порта в состояние пересылки происходит немедленно без выполнения стандартных STP-процедур прослушивания и обучения) ускоряет выбор нового корневого порта при отказе коммутатора или канала, а также при перерасчете STP. Корневой порт немедленно переходит в режим пересылки, минуя режимы прослушивания и обучения, которые подразумеваются обычными процедурами STP. </p>
	<p>3 BackboneFast. BackboneFast (функция коммутаторов мостовой сети, которая обеспечивает быструю конвергенцию после изменения топологии связующего дерева. Функция BackboneFast используется на распределительном и центральном уровнях для восстановления соединения магистральной сети. Функция BackboneFast является запатентованной наработкой компании Cisco) обеспечивает быструю конвергенцию после изменений топологии STP. Эта функция позволяет быстро восстанавливать подключение к магистрали. Функция BackboneFast используется на уровне распределения и центральном уровне, на которых соединяется несколько коммутаторов. </p>
	<p>PortFast, UplinkFast и BackboneFast - это функции, правами на которые владеет компания Cisco, поэтому их нельзя использовать в сетях, включающих коммутаторы других производителей. Кроме того, все эти функции требуют настройки.</p>

	<center><img src="./img/chapter4/4.106.jpg"></center>
	<p class="img">Рисунок 4.106 &ndash; Преимущества PortFast. Часть 1</p>
	<center><img src="./img/chapter4/4.107.jpg"></center>
	<p class="img">Рисунок 4.107 &ndash; Преимущества PortFast. Часть 2</p>
	<center><img src="./img/chapter4/4.108.jpg"></center>
	<p class="img">Рисунок 4.108 &ndash; Преимущества PortFast. Часть 3</p>
	<center><img src="./img/chapter4/4.109.jpg"></center>
	<p class="img">Рисунок 4.109 &ndash; Преимущества PortFast. Часть 4</p>
	<center><img src="./img/chapter4/4.110.jpg"></center>
	<p class="img">Рисунок 4.110 &ndash; Преимущества PortFast. Часть 5</p>
	<center><img src="./img/chapter4/4.111.jpg"></center>
	<p class="img">Рисунок 4.111 &ndash; Преимущества PortFast. Часть 6</p>
	<center><img src="./img/chapter4/4.112.jpg"></center>
	<p class="img">Рисунок 4.112 &ndash; Преимущества PortFast. Часть 7</p>



	<p class="title">4.2.4 Протокол RSTP (Rapid Spanning Tree Protocol)</p>

	<p>Когда институт IEEE разработал оригинальный протокол STP (Spanning Tree Protocol) 802.1D, период восстановления 1 или 2 минуты был допустимым. Сегодня коммутация уровня 3 (процесс в маршрутизаторе, который использует технологии сквозной коммутации для увеличения скорости проверки и перенаправления пакетов) и усовершенствованные протоколы маршрутизации обеспечивают более быстрые альтернативные пути к месту назначения. Из-за потребности в передаче трафика, чувствительного к задержкам, например голоса и видео, коммутируемые сети должны поддерживать быструю конвергенцию, чтобы удовлетворять требованиям новых технологий.</p>
	<p>Протокол Rapid Spanning Tree Protocol (RSTP) (усовершенствованный протокол связующего дерева. Тип протокола связующего дерева с увеличенной скоростью конвергенции), определенный в стандарте IEEE 802.1w, значительно ускоряет перерасчет STP. В отличие от функций PortFast, UplinkFast и BackboneFast, протокол RSTP не является собственным.</p>
	<p>Для обеспечения максимальной скорости переконфигурации протокол RSTP требует полнодуплексного соединения “точка-точка” между коммутаторами. Переконфигурация связующего дерева при использовании протокола RSTP занимает менее одной секунды, аналогичный процесс протокола STP занимает 50 секунд.</p>
	<p>RSTP устраняет потребность в таких функциях, как PortFast и UplinkFast. RSTP может переключаться в режим STP для обслуживания старого оборудования.</p>
	<p>Для ускорения перерасчета число режимов портов протокола RSTP уменьшено до трех: отклонение (состояние порта в RSTP-сети, когда сервер не посылает ответ. Постоянно горящий желтый светодиод свидетельствует об активности процесса отклонения), обучение и пересылка. Режим отбрасывания аналогичен трем оригинальным режимам STP: блокировки, обучения и “отключен”.</p>
	<p>Кроме того, в RSTP добавлена концепция активная топология (топология сети на основе протокола RSTP, в которой порты переходят в состояние пересылки, если они не находятся в состоянии сбрасывания или не блокируются). Все порты, которые не находятся в режиме сброса (не заблокированы), считаются частью активной топологии и немедленно переходят в режим пересылки.</p>

	<center><img src="./img/chapter4/4.113.jpg"></center>
	<p class="img">Рисунок 4.113 &ndash; Разница в скорости между протоколами STP и RSTP. Часть 1</p>
	<center><img src="./img/chapter4/4.114.jpg"></center>
	<p class="img">Рисунок 4.114 &ndash; Разница в скорости между протоколами STP и RSTP. Часть 2</p>
	<center><img src="./img/chapter4/4.115.jpg"></center>
	<p class="img">Рисунок 4.115 &ndash; Разница в скорости между протоколами STP и RSTP. Часть 3</p>
	<center><img src="./img/chapter4/4.116.jpg"></center>
	<p class="img">Рисунок 4.116 &ndash; Разница в скорости между протоколами STP и RSTP. Часть 4</p>
	<center><img src="./img/chapter4/4.117.jpg"></center>
	<p class="img">Рисунок 4.117 &ndash; Разница в скорости между протоколами STP и RSTP. Часть 5</p>
	<center><img src="./img/chapter4/4.118.jpg"></center>
	<p class="img">Рисунок 4.118 &ndash; Разница в скорости между протоколами STP и RSTP. Часть 6</p>
	<center><img src="./img/chapter4/4.119.jpg"></center>
	<p class="img">Рисунок 4.119 &ndash; Разница в скорости между протоколами STP и RSTP. Часть 7</p>
	<center><img src="./img/chapter4/4.120.jpg"></center>
	<p class="img">Рисунок 4.120 &ndash; Разница в скорости между протоколами STP и RSTP. Часть 8</p>
	<center><img src="./img/chapter4/4.121.jpg"></center>
	<p class="img">Рисунок 4.121 &ndash; Разница в скорости между протоколами STP и RSTP. Часть 9</p>



	<p class="title">4.3 Виртуальные локальные сети VLAN</p>
	<p class="title">4.3.1 Назначение VLAN</p>

	<p>Узлы и серверы, подключенные к коммутаторам 2-го уровня, считаются частью сетевого сегмента. Такая организация характеризуется двумя серьезными проблемами:</p>

	<ul type="square">
		<li>коммутаторы выполняют лавинную рассылку широковещательных кадров из всех портов, что приводит к неоправданному потреблению полосы пропускания. С увеличением числа устройств, подключенных к коммутатору, генерируется больше широковещательного трафика, который занимает большую полосу пропускания;</li>
		<li>все устройства, подключенные к коммутатору, могут пересылать и получать кадры от всех остальных устройств на этом коммутаторе.</li>
	</ul>

	<p>При проектировании сети рекомендуется ограничивать широковещательный трафик областью сети, в которой он необходим. Существуют причины организационного характера, по которым одни узлы могут получать доступ друг к другу, а другие нет. Например, в доступе к бухгалтерскому серверу могут нуждаться только сотрудники бухгалтерии. В коммутируемой сети для ограничения широковещательных рассылок и объединения узлов в группы по интересам создаются виртуальные локальные сети (VLAN) (группа устройств в сети, обычно станции конечного пользователя, которые обмениваются данными, как если бы их подключили к одному и тому быть подключены к различным сегментам. Виртуальные локальные сети настраиваются на основе коммутаторов рабочей группы. Коммутаторы могут взаимодействовать с виртуальными локальными сетями с помощью протоколов магистрального канала VLAN. VLAN известна также под названием “виртуальная LAN”) [11].</p>
	<p>VLAN &ndash; это логический домен широковещательной рассылки, который может охватывать несколько физических сегментов LAN. Она позволяет администратору объединять станции по логической функции, проектной группе или приложению независимо от физического положения пользователей.</p>

	<center><img src="./img/chapter4/4.122.jpg"></center>
	<p class="img">Рисунок 4.122 &ndash; Разделение локальной вычислительной сети на три виртуальные сети (VLAN)</p>

	<p>Разница между физической и виртуальной (логической) сетями продемонстрирована в следующем примере:</p>
	<p>Ученики школы разделены на две группы. Каждому ученику первой группы дана красная карточка для идентификации. Каждому ученику второй группы дана синяя карточка. Директор объявляет, что ученики с красными карточками могут говорить только с другими обладателями красных карточек, а ученики с синими карточками - только с другими обладателями синих карточек. Таким образом, ученики логически разделены на две виртуальные группы или VLAN.</p>
	<p>Благодаря такому логическому объединению широковещательный кадр рассылается только группе с красными карточками, несмотря на то, что группа с красными карточками и группа с синими карточками физически находятся в одной школе.</p>
	<p>Этот пример также демонстрирует другую функцию VLAN. Широковещательные кадры не пересылаются между VLAN, они остаются внутри одной VLAN.</p>

	<center><img src="./img/chapter4/4.123.jpg"></center>
	<p class="img">Рисунок 4.123 &ndash; Широковещательный трафик VLAN. Часть 1</p>
	<center><img src="./img/chapter4/4.124.jpg"></center>
	<p class="img">Рисунок 4.124 &ndash; Широковещательный трафик VLAN. Часть 2</p>
	<center><img src="./img/chapter4/4.125.jpg"></center>
	<p class="img">Рисунок 4.125 &ndash; Широковещательный трафик VLAN. Часть 3</p>
	<center><img src="./img/chapter4/4.126.jpg"></center>
	<p class="img">Рисунок 4.126 &ndash; Широковещательный трафик VLAN. Часть 4</p>
	<center><img src="./img/chapter4/4.127.jpg"></center>
	<p class="img">Рисунок 4.127 &ndash; Широковещательный трафик VLAN. Часть 5</p>
	<center><img src="./img/chapter4/4.128.jpg"></center>
	<p class="img">Рисунок 4.128 &ndash; Широковещательный трафик VLAN. Часть 6</p>
	<center><img src="./img/chapter4/4.129.jpg"></center>
	<p class="img">Рисунок 4.129 &ndash; Широковещательный трафик VLAN. Часть 7</p>

	<p>Каждая VLAN функционирует как отдельная локальная сеть. VLAN может охватывать один или несколько коммутаторов, что позволяет узлам работать так, как если бы они находились в одном сегменте.</p>
	<p>VLAN выполняют две основные функции:</p>

	<ul type="square">
		<li>ограничение широковещательных рассылок;</li>
		<li>объединение устройств в группы; устройства, расположенные в одной VLAN, невидимы для устройств, расположенных в другой VLAN.</li>
	</ul>

	<p>Для передачи трафика между VLAN необходимо устройство 3-го уровня.</p>
	<p>В коммутируемой сети устройство можно назначить во VLAN в соответствии с его положением, MAC-адресом, IP-адресом или приложениями, которые оно использует чаще всего. Администраторы задают принадлежность устройства VLAN статически или динамически.</p>
	<p>Для задания статической принадлежности VLAN администратор должен вручную назначить каждый порт коммутатора в определенную VLAN. Например, порт fa0/3 можно назначить во VLAN 20. Любое устройство, подключающееся к порту fa0/3, автоматически становится членом VLAN 20.</p>
	<p>Этот тип принадлежности VLAN проще всего настраивать и он самый популярный, но добавление, перемещение и изменение устройств потребует значительного вмешательства администратора. Например, перемещение узла из одной VLAN в другую потребует либо ручного переназначения порта коммутатора в новую VLAN, либо переключения кабеля рабочей станции в другой порт коммутатора, относящегося к новой VLAN.</p>
	<p>Принадлежность устройства сети VLAN полностью прозрачна для пользователей. Пользователи, которые работают с устройством, подключенным к порту коммутатора, не знают, что являются членами VLAN.</p>



	<center><img src="./img/chapter4/4.130.jpg"></center>
	<p class="img">Рисунок 4.130 &ndash; Порты и узлы, подключенные к каждой VLAN. VLAN 1</p>
	<center><img src="./img/chapter4/4.131.jpg"></center>
	<p class="img">Рисунок 4.131 &ndash; Порты и узлы, подключенные к каждой VLAN. VLAN 8</p>
	<center><img src="./img/chapter4/4.132.jpg"></center>
	<p class="img">Рисунок 4.132 &ndash; Порты и узлы, подключенные к каждой VLAN. VLAN 12</p>
	<center><img src="./img/chapter4/4.133.jpg"></center>
	<p class="img">Рисунок 4.133 &ndash; Порты и узлы, подключенные к каждой VLAN. VLAN 5</p>



	<p>Динамическая принадлежность VLAN требует наличия сервера управления политикой VLAN (VMPS) (сервер, содержащий базу данных, который сопоставляет MAC-адреса с назначениями VLAN. При подключении устройства к порту коммутатора север управления политикой VLAN просматривает базу данных для поиска совпадения MAC-адреса и временно назначает этот порт соответствующей VLAN). VMPS содержит базу данных, которая сопоставляет MAC-адреса с сетями VLAN. Когда устройство подключается к порту, VMPS ищет его MAC-адрес в своей базе данных и временно назначает порт в соответствующую VLAN.</p>
	<p>Динамическая принадлежность VLAN требует более сложной настройки и организации, но формирует более гибкую структуру, чем статическая принадлежность VLAN. Перемещение, добавление и изменение компонентов в динамической VLAN выполняется автоматически и не требует вмешательства администратора.</p>

	<center><img src="./img/chapter4/4.134.jpg"></center>
	<p class="img">Рисунок 4.134 &ndash; Добавление узла в динамическую VLAN. Часть 1</p>
	<center><img src="./img/chapter4/4.135.jpg"></center>
	<p class="img">Рисунок 4.135 &ndash; Добавление узла в динамическую VLAN. Часть 2</p>
	<center><img src="./img/chapter4/4.136.jpg"></center>
	<p class="img">Рисунок 4.136 &ndash; Добавление узла в динамическую VLAN. Часть 3</p>
	<center><img src="./img/chapter4/4.137.jpg"></center>
	<p class="img">Рисунок 4.137 &ndash; Добавление узла в динамическую VLAN. Часть 4</p>
	<center><img src="./img/chapter4/4.138.jpg"></center>
	<p class="img">Рисунок 4.138 &ndash; Добавление узла в динамическую VLAN. Часть 5</p>
	<center><img src="./img/chapter4/4.139.jpg"></center>
	<p class="img">Рисунок 4.139 &ndash; Добавление узла в динамическую VLAN. Часть 6</p>
	<center><img src="./img/chapter4/4.140.jpg"></center>
	<p class="img">Рисунок 4.140 &ndash; Добавление узла в динамическую VLAN. Часть 7</p>
	<center><img src="./img/chapter4/4.141.jpg"></center>
	<p class="img">Рисунок 4.141 &ndash; Добавление узла в динамическую VLAN. Часть 8</p>
	<center><img src="./img/chapter4/4.142.jpg"></center>
	<p class="img">Рисунок 4.142 &ndash; Добавление узла в динамическую VLAN. Часть 9</p>
	<center><img src="./img/chapter4/4.143.jpg"></center>
	<p class="img">Рисунок 4.143 &ndash; Добавление узла в динамическую VLAN. Часть 10</p>


	<p>Максимальное общее число статических и динамических VLAN зависит от типа коммутатора и версии IOS. По умолчанию в качестве VLAN управления (виртуальная локальная сеть управления. VLAN1 на каком-либо коммутаторе. IP-адрес VLAN1 используется для доступа и удаленной настройки коммутатора, а также для обмена данными с другими сетевыми устройствами) применяется VLAN1.</p>
	<p>Администраторы используют IP-адрес VLAN управления для удаленной настройки коммутатора. Удаленный доступ к коммутатору позволяет администратору сети настраивать и обслуживать все конфигурации VLAN.</p>
	<p>Кроме того, VLAN управления используется для обмена данными, например трафиком протоколов CDP (Cisco Discovery Protocol) и VTP (VLAN Trunking Protocol), с другими сетевыми устройствами.</p>
	<p>При создании сети VLAN назначается номер и имя. Номер VLAN (число, назначаемое при создании виртуальной локальной сети. Номером VLAN может являться любое число их диапазона, доступного в коммутаторе, кроме VLAN1. Для удобства управления сетью рекомендуется присвоение VLAN не номеров, а имен) - это любое число из диапазона, доступного коммутатору, кроме VLAN1. Некоторые коммутаторы поддерживают примерно 1000 VLAN, другие - более 4000. Именование VLAN считается рекомендуемым методом управления сетью.</p>

	<center><img src="./img/chapter4/4.144.jpg"></center>
	<p class="img">Рисунок 4.144 &ndash; VLAN1 – VLAN управления</p>

	<p class="title">4.3.2 Идентификация VLAN</p>
    <p>Устройства, подключенные к VLAN, взаимодействуют только с другими устройствами в этой VLAN, при этом устройства могут быть подключены как к одному, так и к разным коммутаторам.</p>
    <p>Коммутатор связывает каждый порт с определенным номером VLAN. При приеме кадра на порте коммутатор добавляет идентификатор VLAN (VLAN ID - VID) (идентификатор виртуальной локальной сети, вставляемый в кадр Ethernet при его поступлении в порт коммутатора) в кадр Ethernet. Добавление идентификатора VLAN в кадр Ethernet называется маркировкой кадра (метод, используемый коммутаторами для идентификации принадлежности кадров виртуальной локальной сети. При поступлении кадра на коммутатор, ему добавляется заголовок с меткой идентификации). Самый распространенный стандарт маркировки кадра - IEEE 802.1q (стандарт IEEE, который разработан для обеспечения передачи данных между виртуальными локальными сетями. Стандарт IEEE 802.1 q использует механизм внутренней маркировки, который вставляет четырехбайтное поле метки в исходный кадр Ethernet между полем адреса источника и полем тип/длина. Так как кадр изменяется, то устройство коммутации пакетов повторно вычисляет контрольную последовательность кадра измененного кадра).</p>
    <center><img src="./img/chapter4/4.145.jpg"></center>
	<p class="img">Рисунок 4.145 &ndash;Взаимодействие между VLAN. Часть 1</p>
    <center><img src="./img/chapter4/4.146.jpg"></center>
	<p class="img">Рисунок 4.146 &ndash;Взаимодействие между VLAN. Часть 2</p>
    <center><img src="./img/chapter4/4.147.jpg"></center>
	<p class="img">Рисунок 4.147 &ndash;Взаимодействие между VLAN. Часть 3</p>
    <center><img src="./img/chapter4/4.148.jpg"></center>
	<p class="img">Рисунок 4.148 &ndash;Взаимодействие между VLAN. Часть 4</p>
    <center><img src="./img/chapter4/4.149.jpg"></center>
	<p class="img">Рисунок 4.149 &ndash;Взаимодействие между VLAN. Часть 5</p>
    <center><img src="./img/chapter4/4.150.jpg"></center>
	<p class="img">Рисунок 4.150 &ndash;Взаимодействие между VLAN. Часть 6</p>
    <center><img src="./img/chapter4/4.151.jpg"></center>
	<p class="img">Рисунок 4.151 &ndash;Взаимодействие между VLAN. Часть 7</p>
    <center><img src="./img/chapter4/4.152.jpg"></center>
	<p class="img">Рисунок 4.152 &ndash;Взаимодействие между VLAN. Часть 8</p>


    <p>Стандарт 802.1Q, который иногда сокращается до dot1q (стандарт IEEE, который разработан для обеспечения передачи данных между виртуальными локальными сетями. Стандарт IEEE 802.1 q использует механизм внутренней маркировки, который вставляет четырехбайтное поле метки в исходный кадр Ethernet между адресом источника и полями тип/длина. Так как кадр изменяется, то устройство коммутации пакетов повторно вычисляет контрольную последовательность кадра измененного кадра), подразумевает вставку 4-байтного поля метки в кадр Ethernet. Эта метка находится между адресом источника и полем type/length (тип/длина).</p>
    <p>Минимальный размер кадров Ethernet составляет 64 байта, максимальный - 1518 байта, однако размер маркированного кадра Ethernet может достигать 1522 байта.</p>
    <p>Кадры включают следующие поля:</p>
    <ul type="square">
        <li>MAC-адреса источника и назначения;</li>
        <li>длина кадра;</li>
        <li>полезные данные;</li>
        <li>контрольная последовательность кадра (FCS) (символы, добавленные в кадр с целью контроля ошибок. Поле контрольной суммы используется в HDLC, Frame Relay и в других протоколах канального уровня).</li>
    </ul>
    <p>Поле FCS обеспечивает выявление ошибок и гарантирует целостность всех битов в кадре.</p>
    <p>Метка увеличивает минимальный размер кадра Ethernet с 64 до 68 байт. Максимальный размер увеличивается с 1518 до 1522 байт. Коммутатор перерассчитывает FCS, так как количество битов в кадре увеличивается.</p>
    <p>Если порт, совместимый с 802.1Q, подключен к другому порту, также совместимому с 802.1Q, данные маркировки VLAN передаются между ними.</p>
    <p>Если подключенный порт несовместим с 802.1Q, метка VLAN будет удалена, прежде чем кадр достигнет среды.</p>
    <p>Устройства без поддержки 802.1Q будут воспринимать маркированный кадр Ethernet как слишком большой. Они отбросят кадр и сообщат об ошибке “большой кадр (англ.: baby giant)” (Ethernet-кадр в сети, который помечен как слишком длинный. Большой кадр не обрабатывается, а в журнале ошибок делается соответствующая запись) [10].</p>
    <p>Метка кадра DOT1Q включает следующие поля:</p>
    <ul type="square">
        <li>TPID - идентификатор протокола маркировки – это 16-битное поле. Оно имеет значение 0х8100, которое означает, что кадр маркирован с использованием протокола IEEE 802.1 q.</li>
        <li>Приоритет - также известно, как приоритет пользователя. Это 3-битное поле означает приоритет IEEE 802.1 q. Поле означает уровень приоритета трафика кадра, используемый при определении приоритета трафика.</li>
        <li>CFI - идентификатор стандартного формата – это однобитное поле. Если значение поля равно 1, MAC-адрес имеет нестандартный формат. Если значение равно 0, MAC-адрес имеет стандартный формат.</li>
    </ul>
	<p>VID - идентификатор VLAN – это 12-битное поле. Он однозначно идентифицирует VLAN, к которой относится кадр. Значение поля лежит в диапазоне 0-4095.</p>

	<center><img src="./img/chapter4/4.153.jpg"></center>
	<p class="img">Рисунок 4.153 &ndash;Структура кадра 802.1 q</p>
    <center><img src="./img/chapter4/4.154.jpg"></center>
	<p class="img">Рисунок 4.154 &ndash;Структура кадра 802.1 q. Поле TPID</p>
    <center><img src="./img/chapter4/4.155.jpg"></center>
	<p class="img">Рисунок 4.155 &ndash;Структура кадра 802.1 q. Поле приоритет</p>
    <center><img src="./img/chapter4/4.156.jpg"></center>
	<p class="img">Рисунок 4.156 &ndash;Структура кадра 802.1 q. CFI</p>
    <center><img src="./img/chapter4/4.157.jpg"></center>
	<p class="img">Рисунок 4.157 &ndash;Структура кадра 802.1 q. VID</p>



    <p class="title">4.4 Транкинг и маршрутизация между VLAN</p>
    <p class="title">4.4.1 Магистральные порты</p>
    <p>VLAN выполняют три основные функции:</p>
    <ul type="square">
        <li>ограничение размера широковещательных рассылок;</li>
        <li>улучшение производительности сети;</li>
        <li>повышение безопасности.</li>
    </ul>
    <p>Чтобы в полной мере воспользоваться преимуществами VLAN, необходимо распространить их на несколько коммутаторов.</p>
    <p>Для портов коммутатора можно задать две разные роли. Порт может быть определен как порт доступа (маршрут к устройству, который не образует петли в коммутируемой сети и всегда перенаправляется для переадресации, если есть присоединенный узел) или как магистральный порт (канал точка-точка, который подключает коммутатор к другому коммутатору, маршрутизатору или серверу. Магистраль передает трафик для нескольких виртуальных локальных сетей через тот же самый канал. Виртуальные локальные сети мультиплексируются через это соелинение с помощью протокола магистрального канала).</p>
    <p>1 Порт доступа. Порт доступа принадлежит только одной VLAN. Как правило, отдельные устройства, такие как компьютеры и серверы, подключаются к портам такого типа. Если несколько компьютеров подключаются к одному порту доступа через концентратор, все устройства, подключенные к концентратору, будут принадлежать к одной VLAN.</p>
    <p>2 Магистральный порт. Магистральный порт - это канал типа “точка-точка” между коммутатором и другим сетевым устройством. Магистральные подключения служат для передачи трафика нескольких VLAN через один канал и обеспечивают им доступ ко всей сети. Магистральные порты необходимы для передачи трафика нескольких VLAN между устройствами при соединении двух коммутаторов, коммутатора и маршрутизатора или коммутатора и сетевого адаптера узла с поддержкой транкинга 802.1Q.</p>

    <center><img src="./img/chapter4/4.158.jpg"></center>
	<p class="img">Рисунок 4.158 &ndash;Порты доступа и магистральные порты коммутатора</p>

    <p>Без магистральных портов для каждой VLAN требовалось бы отдельное соединение между коммутаторами. Например, корпорации со 100 VLAN потребуется 100 каналов связи. При такой организации сеть не масштабируется должным образом и очень дорога. Магистральные каналы позволяют решить эту проблему за счет передачи трафика нескольких VLAN через один канал.</p>
    <p>Для передачи трафика нескольких VLAN через один канал необходима их идентификация. Магистральный порт поддерживает маркировку кадров. Маркировка кадров позволяет добавить к кадру данные VLAN.</p>
    <p>IEEE 802.1Q - стандартный и утвержденный метод маркировки кадров. Корпорация Cisco разработала собственный протокол маркировки кадров под названием межкоммутаторный канал (ISL) (протокол Cisco для маркировки сети, соответствующей стандарту IEEE 802.1q). Коммутаторы более высокого класса, такие как Catalyst 6500, поддерживают оба протокола маркировки, однако большинство коммутаторов LAN, таких как 2960, поддерживают только 802.1Q.</p>

    <center><img src="./img/chapter4/4.159.jpg"></center>
	<p class="img">Рисунок 4.159 &ndash;Потоки трафика без транкинга. Часть 1</p>
    <center><img src="./img/chapter4/4.160.jpg"></center>
	<p class="img">Рисунок 4.160 &ndash;Потоки трафика без транкинга. Часть 2</p>
    <center><img src="./img/chapter4/4.161.jpg"></center>
	<p class="img">Рисунок 4.161 &ndash;Потоки трафика без транкинга. Часть 3</p>
    <center><img src="./img/chapter4/4.162.jpg"></center>
	<p class="img">Рисунок 4.162 &ndash;Потоки трафика с транкингом. Часть 1</p>
    <center><img src="./img/chapter4/4.163.jpg"></center>
	<p class="img">Рисунок 4.163 &ndash;Потоки трафика с транкингом. Часть 2</p>
    <center><img src="./img/chapter4/4.164.jpg"></center>
	<p class="img">Рисунок 4.164 &ndash;Потоки трафика с транкингом. Часть 3</p>




    <p class="title">4.4.2 Распределение VLAN на несколько коммутаторов</p>
    <p>Транкинг позволяет нескольким VLAN пересылать трафик между коммутаторами, используя один порт.</p>
    <p>Магистральный канал пропускает трафик с 4-байтным полем метки в кадре, если на обеих сторонах настроен протокол 802.1Q. Метка кадра содержит идентификатор VLAN ID.</p>
    <p>Когда коммутатор получает маркированный кадр на магистральном порту, он удаляет метку, прежде чем переслать кадр из порта доступа. Коммутатор пересылает кадр, только если порт доступа относится к той же VLAN, что и маркированный кадр.</p>
    <p>Однако некоторые типы трафика должны проходить через канал 802.1Q без идентификатора VLAN. Трафик без идентификатора VLAN называется немаркированным (трафик без идентификатора VLAN, который необходим для печати через 802.1 q. Примерами немаркированного трафика являются протокол обнаружения устройств Cisco, VTP и связанную с проверкой метки идентификатора VLAN). Примеры немаркированного трафика: CDP (Cisco Discovery Protocol), VTP и определенные типы голосового трафика. Немаркированный трафик сводит к минимуму задержки, связанные с проверкой метки идентификатора VLAN [11].</p>

    <center><img src="./img/chapter4/4.165.jpg"></center>
	<p class="img">Рисунок 4.165 &ndash;Процесс маркировки кадра. Часть 1</p>
    <center><img src="./img/chapter4/4.166.jpg"></center>
	<p class="img">Рисунок 4.166 &ndash;Процесс маркировки кадра. Часть 2</p>
    <center><img src="./img/chapter4/4.167.jpg"></center>
	<p class="img">Рисунок 4.167 &ndash;Процесс маркировки кадра. Часть 3</p>
    <center><img src="./img/chapter4/4.168.jpg"></center>
	<p class="img">Рисунок 4.168 &ndash;Процесс маркировки кадра. Часть 4</p>
    <center><img src="./img/chapter4/4.169.jpg"></center>
	<p class="img">Рисунок 4.169 &ndash;Процесс маркировки кадра. Часть 5</p>
    <center><img src="./img/chapter4/4.170.jpg"></center>
	<p class="img">Рисунок 4.170 &ndash;Процесс маркировки кадра. Часть 6</p>
    <center><img src="./img/chapter4/4.171.jpg"></center>
	<p class="img">Рисунок 4.171 &ndash;Процесс маркировки кадра. Часть 7</p>
    <center><img src="./img/chapter4/4.172.jpg"></center>
	<p class="img">Рисунок 4.172 &ndash;Процесс маркировки кадра. Часть 8</p>
    <center><img src="./img/chapter4/4.173.jpg"></center>
	<p class="img">Рисунок 4.173 &ndash;Процесс маркировки кадра. Часть 9</p>


    <p>Для поддержки немаркированного трафика используется специальная VLAN, которая называется собственной VLAN (специальная виртуальная локальная сеть, которая работает с немаркированным трафиком. Магистральные канала передают немаркированный трафик черех собственную VLAN. Для коммутаторов Cisco Catalyst сеть VLAN1 является собственной VLAN). Немаркированные кадры, принятые на порте 802.1Q, передаются в собственную VLAN. На коммутаторах Cisco Catalyst в качестве собственной VLAN по умолчанию используется VLAN 1.</p>
    <p>Любую VLAN можно настроить в качестве собственной. Убедитесь, что собственная VLAN для магистрального подключения 802.1Q одинакова на обеих сторонах канала. В противном случае в топологии STP могут возникнуть петли.</p>
    <center><img src="./img/chapter4/4.174.jpg"></center>
	<p class="img">Рисунок 4.174 &ndash;Собственная VLAN</p>

    <p class="title">4.4.3 Маршрутизация между VLAN</p>
    <p>Хотя VLAN могут охватывать несколько коммутаторов, только устройства, относящиеся к одной VLAN, могут взаимодействовать друг с другом.</p>
    <p>Для соединения между VLAN необходимо устройство 3-го уровня. Такая организация позволяет администратору сети осуществлять строгий контроль над типами трафика, которые передаются из одной VLAN в другую.</p>
    <p>Один из методов маршрутизации между VLAN требует отдельного подключения интерфейса к устройству 3-го уровня для каждой VLAN.</p>

     <center><img src="./img/chapter4/4.175.jpg"></center>
	<p class="img">Рисунок 4.175 &ndash;Взаимодействие между VLAN через маршрутизатор</p>
    <p>Другой метод соединения между VLAN требует функции, которая называется подынтерфейсами (один из виртуальных интерфейсов на одном физическом интерфейсе). Подынтерфейсы позволяют логически разделить один физический интерфейс на несколько логических путей. Для каждой VLAN настраивается отдельный путь или подынтерфейс.</p>
    <p>Взаимодействие между VLAN (маршрутизация в рамках виртуальной локальной сети. Необходимо выполнить определенную настройку коммутаторов и маршрутизаторов) с использованием подынтерфейсов требует настройки как маршрутизатора, так и коммутатора.</p>
    <p>Коммутатор:</p>
    <ul type="square">
        <li>настройте интерфейс коммутатора в качестве магистрального канала 802.1Q.</li>
    </ul>
    <p>Маршрутизатор:</p>
    <ul type="square">
        <li>выберите интерфейс маршрутизатора не ниже FastEthernet 100 Мбит/с;</li>
        <li>настройте подынтерфейсы с поддержкой инкапсуляции 802.1Q;</li>
        <li>для каждой VLAN настраивается один подынтерфейс.</li>
    </ul>
    <p>Подынтерфейс позволяет каждой VLAN иметь собственный логический путь и шлюз по умолчанию к маршрутизатору.</p>
    <p>Узел из передающей VLAN пересылает трафик маршрутизатору, используя шлюз по умолчанию. Подынтерфейс VLAN определяет шлюз по умолчанию для всех узлов этой VLAN. Маршрутизатор определяет IP-адрес назначения и выполняет поиск по таблице маршрутизации.</p>
    <p>Если VLAN назначения относится к тому же коммутатору, что и исходная VLAN, маршрутизатор пересылает трафик назад к исходному коммутатору, используя параметры подынтерфейса и идентификатора VLAN назначения. Такая конфигурация часто называется каскадом маршрутизаторов (“маршрутизатор на палочке”) (конфигурация в маршрутизаторе, которая определяет, находится ли конечная VLAN подключенной к том уже самому коммутатору, что и исходная VLAN; при этом маршрутизатор перенаправляет трафик обратно исходному коммутатору с помощью параметров подынтерфейса конечного идентификатора VLAN) (от англ.: router-on-a-stick).</p>
    <p>Если выходной интерфейс маршрутизатора совместим с 802.1Q, кадр сохраняет 4-байтную метку VLAN. Если выходной интерфейс несовместим с 802.1Q, маршрутизатор отделяет метку от кадра и возвращает кадр в оригинальный формат Ethernet.</p>

     <center><img src="./img/chapter4/4.176.jpg"></center>
	<p class="img">Рисунок 4.176 &ndash;Маршрутизация между VLAN. Часть 1</p>
     <center><img src="./img/chapter4/4.177.jpg"></center>
	<p class="img">Рисунок 4.177 &ndash;Маршрутизация между VLAN. Часть 2</p>
     <center><img src="./img/chapter4/4.178.jpg"></center>
	<p class="img">Рисунок 4.178 &ndash;Маршрутизация между VLAN. Часть 3</p>
     <center><img src="./img/chapter4/4.179.jpg"></center>
	<p class="img">Рисунок 4.179 &ndash;Маршрутизация между VLAN. Часть 4</p>
     <center><img src="./img/chapter4/4.180.jpg"></center>
	<p class="img">Рисунок 4.180 &ndash;Маршрутизация между VLAN. Часть 5</p>
     <center><img src="./img/chapter4/4.181.jpg"></center>
	<p class="img">Рисунок 4.181 &ndash;Маршрутизация между VLAN. Часть 6</p>
     <center><img src="./img/chapter4/4.182.jpg"></center>
	<p class="img">Рисунок 4.182 &ndash;Маршрутизация между VLAN. Часть 7</p>
     <center><img src="./img/chapter4/4.183.jpg"></center>
	<p class="img">Рисунок 4.183 &ndash;Маршрутизация между VLAN. Часть 8</p>


    <p class="title">4.5 Обслуживание VLAN в корпоративной сети</p>
    <p class="title">4.5.1 Протокол VTP (VLAN Trunking Protocol)</p>
    <p>С увеличением размера и сложности сети централизованное управление структурой VLAN становится критически важным. Протокол VTP (VLAN Trunking Protocol) - это протокол обмена сообщениями 2-го уровня, который предоставляет метод управления базой данных VLAN с центрального сервера в сетевом сегменте. Маршрутизаторы не пересылают обновления VTP.</p>
    <p>Без автоматизированного метода управления корпоративной сетью с сотнями VLAN потребовалась бы ручная настройка каждой VLAN на каждом коммутаторе. Любое изменение структуры VLAN потребовало дополнительной ручной настройки. Один неверно набранный номер может стать причиной неустойчивости соединений по всей сети.</p>
    <p>Чтобы решить эту проблему, корпорация Cisco создала протокол VTP, который автоматизирует многие задачи конфигурации VLAN. VTP гарантирует согласованное обслуживание конфигурации VLAN по всей сети и уменьшает необходимость в управлении и мониторинге VLAN.</p>

     <center><img src="./img/chapter4/4.184.jpg"></center>
	<p class="img">Рисунок 4.184 &ndash;Управление VLAN без VTP. Часть 1</p>
     <center><img src="./img/chapter4/4.185.jpg"></center>
	<p class="img">Рисунок 4.185 &ndash;Управление VLAN без VTP. Часть 2</p>
     <center><img src="./img/chapter4/4.186.jpg"></center>
	<p class="img">Рисунок 4.186 &ndash;Управление VLAN без VTP. Часть 3</p>
     <center><img src="./img/chapter4/4.187.jpg"></center>
	<p class="img">Рисунок 4.187 &ndash;Управление VLAN без VTP. Часть 4</p>
     <center><img src="./img/chapter4/4.188.jpg"></center>
	<p class="img">Рисунок 4.188 &ndash;Управление VLAN без VTP. Часть 5</p>
     <center><img src="./img/chapter4/4.189.jpg"></center>
	<p class="img">Рисунок 4.189 &ndash;Управление VLAN с VTP. Часть 1</p>
     <center><img src="./img/chapter4/4.190.jpg"></center>
	<p class="img">Рисунок 4.190 &ndash;Управление VLAN с VTP. Часть 2</p>
     <center><img src="./img/chapter4/4.191.jpg"></center>
	<p class="img">Рисунок 4.191 &ndash;Управление VLAN с VTP. Часть 3</p>
     <center><img src="./img/chapter4/4.192.jpg"></center>
	<p class="img">Рисунок 4.192 &ndash;Управление VLAN с VTP. Часть 4</p>
     <center><img src="./img/chapter4/4.193.jpg"></center>
	<p class="img">Рисунок 4.193 &ndash;Управление VLAN с VTP. Часть 5</p>


    <p>VTP - это протокол обмена сообщениями с архитектурой “клиент-сервер”, который добавляет, удаляет и переименовывает VLAN в одном домене VTP. Все коммутаторы под общим управлением являются частью домена. У каждого домена есть уникальное имя. Коммутаторы VTP обмениваются сообщениями VTP только с другими коммутаторами в домене.</p>
    <p>Существует две разные версии VTP: 1 и 2. Версия 1 - версия по умолчанию и она несовместима с версией 2. На всех коммутаторах необходимо настроить одну версию протокола.</p>
    <p>VTP использует три режима: серверный (программное обеспечение или узел, который обеспечивает обработку данных или работу служб при выполнении запросов клиента), клиентский (устройство, запрашивающее службы или сведения) и прозрачный (невидимое или скрытое представление объекта или процесса. В области сетевых технологий данное понятие соответствует случаю, когда протокол нижнего уровня может принимать решение, которое не повлияет или не затронет верхние уровни, поэтому действие является невидимым или прозрачным для верхних уровней). По умолчанию все коммутаторы являются серверами. Рекомендуется настроить хотя бы два коммутатора в сети в качестве серверов, чтобы обеспечить резервирование.</p>
    <p>Характеристики режимов VTP:</p>
    <ul type="square">
        <li>Серверный - создает, изменяет и удаляет VLAN и параметры конфигурации VLAN во всем домене. Сохраняет данные конфигурации VLAN в NVRAM коммутатора. Рассылает сообщения VTP со всех магистральных портов.</li>
        <li>Клиентский - Не создает, не изменяет и не удаляет данные VLAN. Изменяет свою базу данных при получении изменений VLAN от сервера. Рассылает сообщения VTP со всех магистральных портов.</li>
        <li>-	Прозрачный - пересылает объявления VTP. Игнорирует данные в сообщении VTP. Не изменяет базу данных при получении обновлений. Не рассылает объявления при изменении своей базы данных VLAN [5].</li>
    </ul>
    <center><img src="./img/chapter4/4.194.jpg"></center>
	<p class="img">Рисунок 4.194 &ndash;Режимы VTP. Серверный</p>
     <center><img src="./img/chapter4/4.195.jpg"></center>
	<p class="img">Рисунок 4.195 &ndash;Режимы VTP. Клиентский</p>
     <center><img src="./img/chapter4/4.196.jpg"></center>
	<p class="img">Рисунок 4.196 &ndash;Режимы VTP. Прозрачный</p>


    <p>При использовании VTP каждый сервер объявляет сообщения через свои магистральные порты. Сообщения включают домен управления, номер версии конфигурации, известные VLAN и параметры каждой VLAN. Кадры объявлений отправляются по адресу многоадресной рассылки, поэтому их получают все соседние узлы.</p>
    <p>Каждый коммутатор VTP сохраняет базу данных VLAN, включающую номер версии конфигурации, в энергонезависимой памяти (NVRAM). Если VTP получает обновление с более высоким номером версии, чем номер в базе данных, коммутатор добавляет новые данные в свою базу данных VLAN.</p>
    <p>Номер изменения конфигурации VTP (номер изменения конфигурации протокола магистрального канала VLAN. Порядковый номер многоадресного сообщения в сети. Нумерация изменения конфигурации VTP начинается с нуля. При возникновении изменения конфигурации сети происходит увеличение номера изменения конфигурации на единицу. Номер непрерывно увеличивается до достижения значения равного 2147483648. Если сообщение имеет более высокое значение номера изменения конфигурации VTP, чем хранимое в базе данных, то коммутатор обновляет свою базу данных VLAN в соответствии с новым значением) начинается с нуля. При внесении изменений номер версии конфигурации увеличивается на единицу. Номер версии продолжает увеличиваться, пока не достигает 2 147 483 648. При достижении этого значения счетчик сбрасывается в ноль. Кроме того, номер версии сбрасывается при перезагрузке коммутатора.</p>
    <p>Проблема, связанная с номером версии, может возникнуть, если кто-то добавит в сеть коммутатор с более высоким номером версии, не перезагрузив его. Поскольку по умолчанию коммутатор находится в серверном режиме, новые, но неверные данные могут перезаписать корректные данные VLAN на всех остальных коммутаторах.</p>
    <p>Один из способов обеспечить защиту от этой критической ситуации состоит в задании паролей VTP для проверки коммутаторов. Перед добавлением нового коммутатора в существующую сеть всегда перезагружайте его, чтобы сбросить номер версии. Кроме того, при добавлении коммутатора в сеть, в которой уже есть коммутатор в серверном режиме, убедитесь, что новый коммутатор настроен в прозрачном или клиентском режиме.</p>

     <center><img src="./img/chapter4/4.197.jpg"></center>
	<p class="img">Рисунок 4.197 &ndash;Обновление базы данных VTP</p>
    <p>Существует три типа сообщений VTP: сводные объявления (текущее время VTP-домена и номера изменения конфигурации, посылаемые периодически коммутатором Catalyst), сокращенные объявления (VTP-сообщение, которое содержит новые сведения о виртуальной сети, полученные на основе итогового оповещения) и запросы объявлений (сведения о виртуальной локальной сети, которые необходимы VTP-клиенту в случае сброса настроек коммутатора или изменения имени VTP-домена).</p>
    <p>1 Сводные объявления. Коммутаторы Catalyst рассылают сводные объявления каждые 5 минут, а также при изменении базы данных VLAN. Сводные объявления содержат текущее имя домена VTP и номер версии конфигурации.</p>
    <p>При добавлении, удалении или изменении VLAN сервер увеличивает номер версии конфигурации и отправляет сводное объявление.</p>
    <p>При получении пакета сводного объявления коммутатор сравнивает имя домена VTP со своим именем домена VTP. Если имена домена совпадают, коммутатор сравнивает номер версии конфигурации со своим номером. Если полученный номер ниже, коммутатор игнорирует пакет. Если номер версии выше, отправляется запрос объявления.</p>
    <p>2 Сокращенные объявления. Сокращенное объявление отправляется после сводного объявления. Сокращенное объявление содержит список данных VLAN.</p>
    <p>Сокращенное объявление содержит новые данные VLAN, основанные на сводном объявлении. Если в сети несколько VLAN, потребуется несколько сокращенных объявлений.</p>
    <p>3 Запросы объявлений. VTP-клиенты используют запросы объявлений, чтобы запросить информацию о VLAN. Запросы объявлений необходимы, если коммутатор сброшен или изменено имя домена VTP. Коммутатор получает сводное объявление VTP с более высоким номером версии конфигурации, чем его собственный.</p>

     <center><img src="./img/chapter4/4.198.jpg"></center>
	<p class="img">Рисунок 4.198 &ndash;Обмен данными VTP. Часть 1</p>
     <center><img src="./img/chapter4/4.199.jpg"></center>
	<p class="img">Рисунок 4.199 &ndash;Обмен данными VTP. Часть 2</p>
     <center><img src="./img/chapter4/4.200.jpg"></center>
	<p class="img">Рисунок 4.200 &ndash;Обмен данными VTP. Часть 3</p>
     <center><img src="./img/chapter4/4.201.jpg"></center>
	<p class="img">Рисунок 4.201 &ndash;Обмен данными VTP. Часть 4</p>
     <center><img src="./img/chapter4/4.202.jpg"></center>
	<p class="img">Рисунок 4.202 &ndash;Обмен данными VTP. Часть 5</p>
     <center><img src="./img/chapter4/4.203.jpg"></center>
	<p class="img">Рисунок 4.203 &ndash;Обмен данными VTP. Часть 6</p>
     <center><img src="./img/chapter4/4.204.jpg"></center>
	<p class="img">Рисунок 4.204 &ndash;Обмен данными VTP. Часть 7</p>
     <center><img src="./img/chapter4/4.205.jpg"></center>
	<p class="img">Рисунок 4.205 &ndash;Обмен данными VTP. Часть 8</p>
     <center><img src="./img/chapter4/4.206.jpg"></center>
	<p class="img">Рисунок 4.206 &ndash;Обмен данными VTP. Часть 9</p>
     <center><img src="./img/chapter4/4.207.jpg"></center>
	<p class="img">Рисунок 4.207 &ndash;Обмен данными VTP. Часть 10</p>
     <center><img src="./img/chapter4/4.208.jpg"></center>
	<p class="img">Рисунок 4.208 &ndash;Обмен данными VTP. Часть 11</p>
     <center><img src="./img/chapter4/4.209.jpg"></center>
	<p class="img">Рисунок 4.209 &ndash;Обмен данными VTP. Часть 12</p>


    <p class="title">4.5.2 Поддержка VLAN для IP-телефонии и беспроводного доступа</p>
    <p>Главное назначение VLAN - разделение трафика на логические группы. Трафик из одной VLAN не оказывает влияния на трафик в другой VLAN. Среда VLAN идеальна для трафика, чувствительного к временным задержкам, например голосового.</p>
    <p>Голосовой трафик должен получать приоритет над обычным трафиком данных, чтобы избежать перерывов и джиттера при разговоре. Предоставление выделенной VLAN для голосового трафика позволяет голосовому трафику не конкурировать с данными за доступную полосу пропускания.</p>
    <p>IP-телефон, как правило, включает два порта - один для голоса, другой для данных. Пакеты, передаваемые между IP-телефоном и компьютером, используют тот же физический канал и тот же порт коммутатора. Для сегментации голосового трафика активируйте голосовую VLAN на коммутаторе.</p>
    <p>Беспроводной доступ - другой тип трафика, который использует преимущества VLAN. Беспроводной доступ по своей природе небезопасен и уязвим к хакерским атакам. VLAN, созданные для беспроводного доступа, изолируют некоторые из потенциальных проблем. Угроза целостности беспроводной VLAN не повлияет на другие VLAN в организации.</p>
    <p>Большинство беспроводных сред помещают пользователей во VLAN за пределами брандмауэра для повышенной безопасности. Пользователи должны пройти аутентификацию, чтобы получить доступ к внутренней сети из беспроводной сети.</p>
    <p>Кроме того, многие организации предоставляют гостевой доступ в свою беспроводную сеть. Гостевые учетные записи предоставляют временные беспроводные услуги, такие как веб-доступ, электронная почта, FTP и SSH, всем. Количество активных учетных записей ограничивается. Гостевые учетные записи включаются в беспроводную VLAN или группируются в собственной VLAN.</p>

    <center><img src="./img/chapter4/4.210.jpg"></center>
	<p class="img">Рисунок 4.210 &ndash;Поддержка VLAN для IP-телефонии и беспроводного доступа</p>

    <p class="title">4.5.3 Рекомендуемые методы работы с VLAN</p>
    <p>При качественном планировании и проектировании VLAN обеспечивают безопасность, экономят полосу пропускания и локализуют трафик в корпоративной сети. Все эти функции объединяются для улучшения производительности сети.</p>
    <p>Некоторые из рекомендуемых методов настройки VLAN в корпоративной сети приводятся ниже:</p>
    <ul type="square">
        <li>Размещение серверов. Убедитесь, что все серверы, необходимые определенной группе, входят в одну VLAN.</li>
        <li>Неиспользуемые порты. Отключите неиспользуемые порты. Поместите неиспользуемые порты в неиспользуемую VLAN. Обеспечьте защиту от несанкционированного доступа, запретив подключение или поместите устройство в неиспользуемую VLAN.</li>
        <li>VLAN управления. По умолчанию в качестве VLAN управления и собственной VLAN используется VLAN1. Не используйте VLAN1 для трафика внутриполосного управления. Выберите другую выделенную VLAN, чтобы отделить трафик управления от пользовательского трафика и трафика протоколов.</li>
        <li>Протокол VTP. Стандартизирует конфигурацию VLAN по всему предприятию. Обеспечивает простое управление и обслуживание VLAN. Уменьшает время, необходимое на администрирование и обслуживание VLAN.</li>
        <li>Домены VTP. Снижают вероятность неверной настройки. Распространяют и синхронизируют данные VLAN среди коммутаторов-участников.</li>
        <li>Номер версии VTP. Убедитесь, что номер версии конфигурации коммутатора, добавляемого в сеть, равен нулю. Переустановите номер версии одним из следующих способов (1 – переведите коммутатор в прозрачный режим, а затем обратно в режим клиента или сервера, 2 – поменяйте имя домена на другое. Верните старое имя).</li>
    </ul>
    <p>В то же время VLAN не являются ответом на все проблемы. Неправильное внедрение VLAN может привести к излишнему усложнению сети, которое станет причиной неустойчивого соединения и снижения производительности сети.</p>
    <p>VLAN изолируют определенные типы трафика по соображениям безопасности. Для перемещения трафика между VLAN необходимо устройство 3-го уровня, которое увеличивает стоимость внедрения и повышает уровень запаздывания в сети.</p>

    <center><img src="./img/chapter4/4.211.jpg"></center>
	<p class="img">Рисунок 4.211 &ndash;Методы настройки VLAN в корпоративной сети. Размещение серверов</p>
    <center><img src="./img/chapter4/4.212.jpg"></center>
	<p class="img">Рисунок 4.212 &ndash;Методы настройки VLAN в корпоративной сети. Неиспользуемые порты</p>
    <center><img src="./img/chapter4/4.213.jpg"></center>
	<p class="img">Рисунок 4.213 &ndash;Методы настройки VLAN в корпоративной сети. VLAN управления</p>
    <center><img src="./img/chapter4/4.214.jpg"></center>
	<p class="img">Рисунок 4.214 &ndash;Методы настройки VLAN в корпоративной сети. Протокол VTP</p>
    <center><img src="./img/chapter4/4.215.jpg"></center>
	<p class="img">Рисунок 4.215 &ndash;Методы настройки VLAN в корпоративной сети. Домены VTP</p>
    <center><img src="./img/chapter4/4.216.jpg"></center>
	<p class="img">Рисунок 4.216 &ndash;Методы настройки VLAN в корпоративной сети. Номер версии VTP</p>

    <p class="title">Контрольные вопросы для закрепления изученного материала</p>
<ol>
<li> Перечислите типы коммутации локальных сетей.</li>
<li>Укажите, как реализовать безопасность коммутаторов?</li>
<li>Назовите основные способы предотвращение петель коммутации в локальных сетях. Особенности протокола STP.</li>
<li> Каковы преимущества использования виртуальных локальных сетей -VLAN?</li>
<li> Назовите функции протокола VTP?</li>
</ol>
</BODY>
</HTML>